import{S as xa,i as Ma,s as wa,a as we,k as L,c as ve,l as z,m as Z,h as W,n as v,b as ci,B as xs,o as va,T as Ta,q as Bn,r as In,p as Rn,J as Pe,L as Ms,H as N,M as Ce,U as Oa,N as Na,R as Fa}from"./index-9e047c9c.js";function ee(r){this.content=r}ee.prototype={constructor:ee,find:function(r){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===r)return e;return-1},get:function(r){var e=this.find(r);return e==-1?void 0:this.content[e+1]},update:function(r,e,t){var n=t&&t!=r?this.remove(t):this,i=n.find(r),s=n.content.slice();return i==-1?s.push(t||r,e):(s[i+1]=e,t&&(s[i]=t)),new ee(s)},remove:function(r){var e=this.find(r);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new ee(t)},addToStart:function(r,e){return new ee([r,e].concat(this.remove(r).content))},addToEnd:function(r,e){var t=this.remove(r).content.slice();return t.push(r,e),new ee(t)},addBefore:function(r,e,t){var n=this.remove(e),i=n.content.slice(),s=n.find(r);return i.splice(s==-1?i.length:s,0,e,t),new ee(i)},forEach:function(r){for(var e=0;e<this.content.length;e+=2)r(this.content[e],this.content[e+1])},prepend:function(r){return r=ee.from(r),r.size?new ee(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=ee.from(r),r.size?new ee(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var e=this;r=ee.from(r);for(var t=0;t<r.content.length;t+=2)e=e.remove(r.content[t]);return e},toObject:function(){var r={};return this.forEach(function(e,t){r[e]=t}),r},get size(){return this.content.length>>1}};ee.from=function(r){if(r instanceof ee)return r;var e=[];if(r)for(var t in r)e.push(t,r[t]);return new ee(e)};function Lo(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let i=r.child(n),s=e.child(n);if(i==s){t+=i.nodeSize;continue}if(!i.sameMarkup(s))return t;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)t++;return t}if(i.content.size||s.content.size){let o=Lo(i.content,s.content,t+1);if(o!=null)return o}t+=i.nodeSize}}function zo(r,e,t,n){for(let i=r.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:t,b:n};let o=r.child(--i),l=e.child(--s),a=o.nodeSize;if(o==l){t-=a,n-=a;continue}if(!o.sameMarkup(l))return{a:t,b:n};if(o.isText&&o.text!=l.text){let u=0,c=Math.min(o.text.length,l.text.length);for(;u<c&&o.text[o.text.length-u-1]==l.text[l.text.length-u-1];)u++,t--,n--;return{a:t,b:n}}if(o.content.size||l.content.size){let u=zo(o.content,l.content,t-1,n-1);if(u)return u}t-=a,n-=a}}class D{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,i=0,s){for(let o=0,l=0;l<t;o++){let a=this.content[o],u=l+a.nodeSize;if(u>e&&n(a,i+l,s||null,o)!==!1&&a.content.size){let c=l+1;a.nodesBetween(Math.max(0,e-c),Math.min(a.content.size,t-c),n,i+c)}l=u}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,i){let s="",o=!0;return this.nodesBetween(e,t,(l,a)=>{l.isText?(s+=l.text.slice(Math.max(e,a)-a,t-a),o=!n):l.isLeaf?(i?s+=typeof i=="function"?i(l):i:l.type.spec.leafText&&(s+=l.type.spec.leafText(l)),o=!n):!o&&l.isBlock&&(s+=n,o=!0)},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,i=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(i[i.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new D(i,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],i=0;if(t>e)for(let s=0,o=0;o<t;s++){let l=this.content[s],a=o+l.nodeSize;a>e&&((o<e||a>t)&&(l.isText?l=l.cut(Math.max(0,e-o),Math.min(l.text.length,t-o)):l=l.cut(Math.max(0,e-o-1),Math.min(l.content.size,t-o-1))),n.push(l),i+=l.nodeSize),o=a}return new D(n,i)}cutByIndex(e,t){return e==t?D.empty:e==0&&t==this.content.length?this:new D(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let i=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return i[e]=t,new D(i,s)}addToStart(e){return new D([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new D(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let i=this.content[t];e(i,n,t),n+=i.nodeSize}}findDiffStart(e,t=0){return Lo(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return zo(this,e,t,n)}findIndex(e,t=-1){if(e==0)return Pn(0,e);if(e==this.size)return Pn(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,i=0;;n++){let s=this.child(n),o=i+s.nodeSize;if(o>=e)return o==e||t>0?Pn(n+1,o):Pn(n,i);i=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return D.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new D(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return D.empty;let t,n=0;for(let i=0;i<e.length;i++){let s=e[i];n+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(t||(t=e.slice(0,i)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new D(t||e,n)}static from(e){if(!e)return D.empty;if(e instanceof D)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new D([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}D.empty=new D([],0);const Vr={index:0,offset:0};function Pn(r,e){return Vr.index=r,Vr.offset=e,Vr}function Kn(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!Kn(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!Kn(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let R=class{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,i)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Kn(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);return n.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return R.none;if(e instanceof R)return[e];let t=e.slice();return t.sort((n,i)=>n.type.rank-i.type.rank),t}};R.none=[];class Wn extends Error{}class C{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=Vo(this.content,e+this.openStart,t);return n&&new C(n,this.openStart,this.openEnd)}removeBetween(e,t){return new C(_o(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return C.empty;let n=t.openStart||0,i=t.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new C(D.fromJSON(e,t.content),n,i)}static maxOpen(e,t=!0){let n=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)i++;return new C(e,n,i)}}C.empty=new C(D.empty,0,0);function _o(r,e,t){let{index:n,offset:i}=r.findIndex(e),s=r.maybeChild(n),{index:o,offset:l}=r.findIndex(t);if(i==e||s.isText){if(l!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,s.copy(_o(s.content,e-i-1,t-i-1)))}function Vo(r,e,t,n){let{index:i,offset:s}=r.findIndex(e),o=r.maybeChild(i);if(s==e||o.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));let l=Vo(o.content,e-s-1,t);return l&&r.replaceChild(i,o.copy(l))}function Ba(r,e,t){if(t.openStart>r.depth)throw new Wn("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new Wn("Inconsistent open depths");return Ho(r,e,t,0)}function Ho(r,e,t,n){let i=r.index(n),s=r.node(n);if(i==e.index(n)&&n<r.depth-t.openStart){let o=Ho(r,e,t,n+1);return s.copy(s.content.replaceChild(i,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,l=o.content;return vt(o,l.cut(0,r.parentOffset).append(t.content).append(l.cut(e.parentOffset)))}else{let{start:o,end:l}=Ia(t,r);return vt(s,$o(r,o,l,e,n))}else return vt(s,Jn(r,e,n))}function jo(r,e){if(!e.type.compatibleContent(r.type))throw new Wn("Cannot join "+e.type.name+" onto "+r.type.name)}function di(r,e,t){let n=r.node(t);return jo(n,e.node(t)),n}function wt(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function bn(r,e,t,n){let i=(e||r).node(t),s=0,o=e?e.index(t):i.childCount;r&&(s=r.index(t),r.depth>t?s++:r.textOffset&&(wt(r.nodeAfter,n),s++));for(let l=s;l<o;l++)wt(i.child(l),n);e&&e.depth==t&&e.textOffset&&wt(e.nodeBefore,n)}function vt(r,e){return r.type.checkContent(e),r.copy(e)}function $o(r,e,t,n,i){let s=r.depth>i&&di(r,e,i+1),o=n.depth>i&&di(t,n,i+1),l=[];return bn(null,r,i,l),s&&o&&e.index(i)==t.index(i)?(jo(s,o),wt(vt(s,$o(r,e,t,n,i+1)),l)):(s&&wt(vt(s,Jn(r,e,i+1)),l),bn(e,t,i,l),o&&wt(vt(o,Jn(t,n,i+1)),l)),bn(n,null,i,l),new D(l)}function Jn(r,e,t){let n=[];if(bn(null,r,t,n),r.depth>t){let i=di(r,e,t+1);wt(vt(i,Jn(r,e,t+1)),n)}return bn(e,null,t,n),new D(n)}function Ia(r,e){let t=e.depth-r.openStart,i=e.node(t).copy(r.content);for(let s=t-1;s>=0;s--)i=e.node(s).copy(D.from(i));return{start:i.resolveNoCache(r.openStart+t),end:i.resolveNoCache(i.content.size-r.openEnd-t)}}class wn{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=e.child(t);return n?e.child(t).cut(n):i}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],i=t==0?0:this.path[t*3-1]+1;for(let s=0;s<e;s++)i+=n.child(s).nodeSize;return i}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return R.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),i=e.maybeChild(t);if(!n){let l=n;n=i,i=l}let s=n.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)n[s].type.spec.inclusive===!1&&(!i||!n[s].isInSet(i.marks))&&(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new qn(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],i=0,s=t;for(let o=e;;){let{index:l,offset:a}=o.content.findIndex(s),u=s-a;if(n.push(o,l,i+a),!u||(o=o.child(l),o.isText))break;s=u-1,i+=a+1}return new wn(t,n,s)}static resolveCached(e,t){for(let i=0;i<Hr.length;i++){let s=Hr[i];if(s.pos==t&&s.doc==e)return s}let n=Hr[jr]=wn.resolve(e,t);return jr=(jr+1)%Ra,n}}let Hr=[],jr=0,Ra=12;class qn{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Pa=Object.create(null);let Ge=class{constructor(e,t,n,i=R.none){this.type=e,this.attrs=t,this.marks=i,this.content=n||D.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,i=0){this.content.nodesBetween(e,t,n,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,i){return this.content.textBetween(e,t,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Kn(this.attrs,t||e.defaultAttrs||Pa)&&R.sameSet(this.marks,n||R.none)}copy(e=null){return e==this.content?this:new Ge(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new Ge(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return C.empty;let i=this.resolve(e),s=this.resolve(t),o=n?0:i.sharedDepth(t),l=i.start(o),u=i.node(o).content.cut(i.pos-l,s.pos-l);return new C(u,i.depth-o,s.depth-o)}replace(e,t,n){return Ba(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:i}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(i==e||t.isText)return t;e-=i+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let i=this.content.child(t-1);return{node:i,index:t-1,offset:n-i.nodeSize}}resolve(e){return wn.resolveCached(this,e)}resolveNoCache(e){return wn.resolve(this,e)}rangeHasMark(e,t,n){let i=!1;return t>e&&this.nodesBetween(e,t,s=>(n.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Ko(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=D.empty,i=0,s=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,i,s),l=o&&o.matchFragment(this.content,t);if(!l||!l.validEnd)return!1;for(let a=i;a<s;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(e,t,n,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(n),o=s&&s.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=R.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!R.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let i=D.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,i,n)}};Ge.prototype.text=void 0;class Un extends Ge{constructor(e,t,n,i){if(super(e,t,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Ko(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Un(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Un(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Ko(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}class Nt{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new La(e,t);if(n.next==null)return Nt.empty;let i=Wo(n);n.next&&n.err("Unexpected trailing text");let s=Ka($a(i));return Wa(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let i=this;for(let s=t;i&&s<n;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let i=[this];function s(o,l){let a=o.matchFragment(e,n);if(a&&(!t||a.validEnd))return D.from(l.map(u=>u.createAndFill()));for(let u=0;u<o.next.length;u++){let{type:c,next:d}=o.next[u];if(!(c.isText||c.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let f=s(d,l.concat(c));if(f)return f}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let l=i;l.type;l=l.via)o.push(l.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:l,next:a}=s.next[o];!l.isLeaf&&!l.hasRequiredAttrs()&&!(l.name in t)&&(!i.type||a.validEnd)&&(n.push({match:l.contentMatch,type:l,via:i}),t[l.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let i=0;i<n.next.length;i++)e.indexOf(n.next[i].next)==-1&&t(n.next[i].next)}return t(this),e.map((n,i)=>{let s=i+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)s+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return s}).join(`
`)}}Nt.empty=new Nt(!0);class La{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Wo(r){let e=[];do e.push(za(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function za(r){let e=[];do e.push(_a(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function _a(r){let e=ja(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=Va(r,e);else break;return e}function ws(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function Va(r,e){let t=ws(r),n=t;return r.eat(",")&&(r.next!="}"?n=ws(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function Ha(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let i=[];for(let s in t){let o=t[s];o.groups.indexOf(e)>-1&&i.push(o)}return i.length==0&&r.err("No node type or group '"+e+"' found"),i}function ja(r){if(r.eat("(")){let e=Wo(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=Ha(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function $a(r){let e=[[]];return i(s(r,0),t()),e;function t(){return e.push([])-1}function n(o,l,a){let u={term:a,to:l};return e[o].push(u),u}function i(o,l){o.forEach(a=>a.to=l)}function s(o,l){if(o.type=="choice")return o.exprs.reduce((a,u)=>a.concat(s(u,l)),[]);if(o.type=="seq")for(let a=0;;a++){let u=s(o.exprs[a],l);if(a==o.exprs.length-1)return u;i(u,l=t())}else if(o.type=="star"){let a=t();return n(l,a),i(s(o.expr,a),a),[n(a)]}else if(o.type=="plus"){let a=t();return i(s(o.expr,l),a),i(s(o.expr,a),a),[n(a)]}else{if(o.type=="opt")return[n(l)].concat(s(o.expr,l));if(o.type=="range"){let a=l;for(let u=0;u<o.min;u++){let c=t();i(s(o.expr,a),c),a=c}if(o.max==-1)i(s(o.expr,a),a);else for(let u=o.min;u<o.max;u++){let c=t();n(a,c),i(s(o.expr,a),c),a=c}return[n(a)]}else{if(o.type=="name")return[n(l,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Jo(r,e){return e-r}function vs(r,e){let t=[];return n(e),t.sort(Jo);function n(i){let s=r[i];if(s.length==1&&!s[0].term)return n(s[0].to);t.push(i);for(let o=0;o<s.length;o++){let{term:l,to:a}=s[o];!l&&t.indexOf(a)==-1&&n(a)}}}function Ka(r){let e=Object.create(null);return t(vs(r,0));function t(n){let i=[];n.forEach(o=>{r[o].forEach(({term:l,to:a})=>{if(!l)return;let u;for(let c=0;c<i.length;c++)i[c][0]==l&&(u=i[c][1]);vs(r,a).forEach(c=>{u||i.push([l,u=[]]),u.indexOf(c)==-1&&u.push(c)})})});let s=e[n.join(",")]=new Nt(n.indexOf(r.length-1)>-1);for(let o=0;o<i.length;o++){let l=i[o][1].sort(Jo);s.next.push({type:i[o][0],next:e[l.join(",")]||t(l)})}return s}}function Wa(r,e){for(let t=0,n=[r];t<n.length;t++){let i=n[t],s=!i.validEnd,o=[];for(let l=0;l<i.next.length;l++){let{type:a,next:u}=i.next[l];o.push(a.name),s&&!(a.isText||a.hasRequiredAttrs())&&(s=!1),n.indexOf(u)==-1&&n.push(u)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function qo(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function Uo(r,e){let t=Object.create(null);for(let n in r){let i=e&&e[n];if(i===void 0){let s=r[n];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=i}return t}function Go(r){let e=Object.create(null);if(r)for(let t in r)e[t]=new Ja(r[t]);return e}let fi=class{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Go(n.attrs),this.defaultAttrs=qo(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Nt.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Uo(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Ge(this,this.computeAttrs(e),D.from(t),R.setFrom(n))}createChecked(e=null,t,n){return t=D.from(t),this.checkContent(t),new Ge(this,this.computeAttrs(e),t,R.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=D.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let i=this.contentMatch.matchFragment(t),s=i&&i.fillBefore(D.empty,!0);return s?new Ge(this,e,t.append(s),R.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:R.none:e}static compile(e,t){let n=Object.create(null);e.forEach((s,o)=>n[s]=new fi(s,t,o));let i=t.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};class Ja{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}}class Ar{constructor(e,t,n,i){this.name=e,this.rank=t,this.schema=n,this.spec=i,this.attrs=Go(i.attrs),this.excluded=null;let s=qo(this.attrs);this.instance=s?new R(this,s):null}create(e=null){return!e&&this.instance?this.instance:new R(this,Uo(this.attrs,e))}static compile(e,t){let n=Object.create(null),i=0;return e.forEach((s,o)=>n[s]=new Ar(s,i++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}excludes(e){return this.excluded.indexOf(e)>-1}}class qa{constructor(e){this.cached=Object.create(null);let t=this.spec={};for(let i in e)t[i]=e[i];t.nodes=ee.from(e.nodes),t.marks=ee.from(e.marks||{}),this.nodes=fi.compile(this.spec.nodes,this),this.marks=Ar.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",l=s.spec.marks;s.contentMatch=n[o]||(n[o]=Nt.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.markSet=l=="_"?null:l?Ts(this,l.split(" ")):l==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:Ts(this,o.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof fi){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,i)}text(e,t){let n=this.nodes.text;return new Un(n,n.defaultAttrs,e,R.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return Ge.fromJSON(this,e)}markFromJSON(e){return R.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Ts(r,e){let t=[];for(let n=0;n<e.length;n++){let i=e[n],s=r.marks[i],o=s;if(s)t.push(s);else for(let l in r.marks){let a=r.marks[l];(i=="_"||a.spec.group&&a.spec.group.split(" ").indexOf(i)>-1)&&t.push(o=a)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}class en{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach(n=>{n.tag?this.tags.push(n):n.style&&this.styles.push(n)}),this.normalizeLists=!this.tags.some(n=>{if(!/^(ul|ol)\b/.test(n.tag)||!n.node)return!1;let i=e.nodes[n.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let n=new Ns(this,t,!1);return n.addAll(e,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new Ns(this,t,!0);return n.addAll(e,t.from,t.to),C.maxOpen(n.finish())}matchTag(e,t,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(Ya(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||t.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,t,n,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],l=o.style;if(!(l.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||l.length>e.length&&(l.charCodeAt(e.length)!=61||l.slice(e.length+1)!=t))){if(o.getAttrs){let a=o.getAttrs(t);if(a===!1)continue;o.attrs=a||void 0}return o}}}static schemaRules(e){let t=[];function n(i){let s=i.priority==null?50:i.priority,o=0;for(;o<t.length;o++){let l=t[o];if((l.priority==null?50:l.priority)<s)break}t.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{n(o=Fs(o)),o.mark=i})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{n(o=Fs(o)),o.node=i})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new en(e,en.schemaRules(e)))}}const Yo={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ua={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Qo={ol:!0,ul:!0},Gn=1,Yn=2,kn=4;function Os(r,e,t){return e!=null?(e?Gn:0)|(e==="full"?Yn:0):r&&r.whitespace=="pre"?Gn|Yn:t&~kn}class Ln{constructor(e,t,n,i,s,o,l){this.type=e,this.attrs=t,this.marks=n,this.pendingMarks=i,this.solid=s,this.options=l,this.content=[],this.activeMarks=R.none,this.stashMarks=[],this.match=o||(l&kn?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(D.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(e.type))?(this.match=n,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Gn)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let s=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let t=D.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(D.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,n=this.pendingMarks;t<n.length;t++){let i=n[t];(this.type?this.type.allowsMarkType(i.type):Xa(i.type,e))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Yo.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Ns{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0;let i=t.topNode,s,o=Os(null,t.preserveWhitespace,0)|(n?kn:0);i?s=new Ln(i.type,i.attrs,R.none,R.none,!0,t.topMatch||i.type.contentMatch,o):n?s=new Ln(null,null,R.none,R.none,!0,null,o):s=new Ln(e.schema.topNodeType,null,R.none,R.none,!0,null,o),this.nodes=[s],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){let t=e.getAttribute("style"),n=t?this.readStyles(Qa(t)):null,i=this.top;if(n!=null)for(let s=0;s<n.length;s++)this.addPendingMark(n[s]);if(this.addElement(e),n!=null)for(let s=0;s<n.length;s++)this.removePendingMark(n[s],i)}}addTextNode(e){let t=e.nodeValue,n=this.top;if(n.options&Yn||n.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(n.options&Gn)n.options&Yn?t=t.replace(/\r\n?/g,`
`):t=t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let i=n.content[n.content.length-1],s=e.previousSibling;(!i||s&&s.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let n=e.nodeName.toLowerCase(),i;Qo.hasOwnProperty(n)&&this.parser.normalizeLists&&Ga(e);let s=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,t));if(s?s.ignore:Ua.hasOwnProperty(n))this.findInside(e),this.ignoreFallback(e);else if(!s||s.skip||s.closeParent){s&&s.closeParent?this.open=Math.max(0,this.open-1):s&&s.skip.nodeType&&(e=s.skip);let o,l=this.top,a=this.needsBlock;if(Yo.hasOwnProperty(n))l.content.length&&l.content[0].isInline&&this.open&&(this.open--,l=this.top),o=!0,l.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),o&&this.sync(l),this.needsBlock=a}else this.addElementByRule(e,s,s.consuming===!1?i:void 0)}leafFallback(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))}ignoreFallback(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=R.none;e:for(let n=0;n<e.length;n+=2)for(let i=void 0;;){let s=this.parser.matchStyle(e[n],e[n+1],this,i);if(!s)continue e;if(s.ignore)return null;if(t=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(t),s.consuming===!1)i=s;else break}return t}addElementByRule(e,t,n){let i,s,o;t.node?(s=this.parser.schema.nodes[t.node],s.isLeaf?this.insertNode(s.create(t.attrs))||this.leafFallback(e):i=this.enter(s,t.attrs||null,t.preserveWhitespace)):(o=this.parser.schema.marks[t.mark].create(t.attrs),this.addPendingMark(o));let l=this.top;if(s&&s.isLeaf)this.findInside(e);else if(n)this.addElement(e,n);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(a=>this.insertNode(a));else{let a=e;typeof t.contentElement=="string"?a=e.querySelector(t.contentElement):typeof t.contentElement=="function"?a=t.contentElement(e):t.contentElement&&(a=t.contentElement),this.findAround(e,a,!0),this.addAll(a)}i&&this.sync(l)&&this.open--,o&&this.removePendingMark(o,l)}addAll(e,t,n){let i=t||0;for(let s=t?e.childNodes[t]:e.firstChild,o=n==null?null:e.childNodes[n];s!=o;s=s.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(s);this.findAtPoint(e,i)}findPlace(e){let t,n;for(let i=this.open;i>=0;i--){let s=this.nodes[i],o=s.findWrapping(e);if(o&&(!t||t.length>o.length)&&(t=o,n=s,!o.length)||s.solid)break}if(!t)return!1;this.sync(n);for(let i=0;i<t.length;i++)this.enterInner(t[i],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let n=t.activeMarks;for(let i=0;i<e.marks.length;i++)(!t.type||t.type.allowsMarkType(e.marks[i].type))&&(n=e.marks[i].addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n){let i=this.findPlace(e.create(t));return i&&this.enterInner(e,t,!0,n),i}enterInner(e,t=null,n=!1,i){this.closeExtra();let s=this.top;s.applyPending(e),s.match=s.match&&s.match.matchType(e);let o=Os(e,i,s.options);s.options&kn&&s.content.length==0&&(o|=kn),this.nodes.push(new Ln(e,t,s.activeMarks,s.pendingMarks,n,null,o)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let i=n.length-1;i>=0;i--)e+=n[i].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&t.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(i?0:1),o=(l,a)=>{for(;l>=0;l--){let u=t[l];if(u==""){if(l==t.length-1||l==0)continue;for(;a>=s;a--)if(o(l-1,a))return!0;return!1}else{let c=a>0||a==0&&i?this.nodes[a].type:n&&a>=s?n.node(a-s).type:null;if(!c||c.name!=u&&c.groups.indexOf(u)==-1)return!1;a--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}addPendingMark(e){let t=Za(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let n=this.open;n>=0;n--){let i=this.nodes[n];if(i.pendingMarks.lastIndexOf(e)>-1)i.pendingMarks=e.removeFromSet(i.pendingMarks);else{i.activeMarks=e.removeFromSet(i.activeMarks);let o=i.popFromStashMark(e);o&&i.type&&i.type.allowsMarkType(o.type)&&(i.activeMarks=o.addToSet(i.activeMarks))}if(i==t)break}}}function Ga(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Qo.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function Ya(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function Qa(r){let e=/\s*([\w-]+)\s*:\s*([^;]+)/g,t,n=[];for(;t=e.exec(r);)n.push(t[1],t[2].trim());return n}function Fs(r){let e={};for(let t in r)e[t]=r[t];return e}function Xa(r,e){let t=e.schema.nodes;for(let n in t){let i=t[n];if(!i.allowsMarkType(r))continue;let s=[],o=l=>{s.push(l);for(let a=0;a<l.edgeCount;a++){let{type:u,next:c}=l.edge(a);if(u==e||s.indexOf(c)<0&&o(c))return!0}};if(o(i.contentMatch))return!0}}function Za(r,e){for(let t=0;t<e.length;t++)if(r.eq(e[t]))return e[t]}class He{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=$r(t).createDocumentFragment());let i=n,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let l=0,a=0;for(;l<s.length&&a<o.marks.length;){let u=o.marks[a];if(!this.marks[u.type.name]){a++;continue}if(!u.eq(s[l][0])||u.type.spec.spanning===!1)break;l++,a++}for(;l<s.length;)i=s.pop()[1];for(;a<o.marks.length;){let u=o.marks[a++],c=this.serializeMark(u,o.isInline,t);c&&(s.push([u,i]),i.appendChild(c.dom),i=c.contentDOM||c.dom)}}i.appendChild(this.serializeNodeInner(o,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:i}=He.renderSpec($r(t),this.nodes[e.type.name](e));if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,i)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,t);s&&((s.contentDOM||s.dom).appendChild(n),n=s.dom)}return n}serializeMark(e,t,n={}){let i=this.marks[e.type.name];return i&&He.renderSpec($r(n),i(e,t))}static renderSpec(e,t,n=null){if(typeof t=="string")return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let i=t[0],s=i.indexOf(" ");s>0&&(n=i.slice(0,s),i=i.slice(s+1));let o,l=n?e.createElementNS(n,i):e.createElement(i),a=t[1],u=1;if(a&&typeof a=="object"&&a.nodeType==null&&!Array.isArray(a)){u=2;for(let c in a)if(a[c]!=null){let d=c.indexOf(" ");d>0?l.setAttributeNS(c.slice(0,d),c.slice(d+1),a[c]):l.setAttribute(c,a[c])}}for(let c=u;c<t.length;c++){let d=t[c];if(d===0){if(c<t.length-1||c>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:h}=He.renderSpec(e,d,n);if(l.appendChild(f),h){if(o)throw new RangeError("Multiple content holes");o=h}}}return{dom:l,contentDOM:o}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new He(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Bs(e.nodes);return t.text||(t.text=n=>n.text),t}static marksFromSchema(e){return Bs(e.marks)}}function Bs(r){let e={};for(let t in r){let n=r[t].spec.toDOM;n&&(e[t]=n)}return e}function $r(r){return r.document||window.document}const Xo=65535,Zo=Math.pow(2,16);function eu(r,e){return r+e*Zo}function Is(r){return r&Xo}function tu(r){return(r-(r&Xo))/Zo}const el=1,tl=2,Vn=4,nl=8;class hi{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&nl)>0}get deletedBefore(){return(this.delInfo&(el|Vn))>0}get deletedAfter(){return(this.delInfo&(tl|Vn))>0}get deletedAcross(){return(this.delInfo&Vn)>0}}class Ae{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Ae.empty)return Ae.empty}recover(e){let t=0,n=Is(e);if(!this.inverted)for(let i=0;i<n;i++)t+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+t+tu(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?i:0);if(a>e)break;let u=this.ranges[l+s],c=this.ranges[l+o],d=a+u;if(e<=d){let f=u?e==a?-1:e==d?1:t:t,h=a+i+(f<0?0:c);if(n)return h;let p=e==(t<0?a:d)?null:eu(l/3,e-a),m=e==a?tl:e==d?el:Vn;return(t<0?e!=a:e!=d)&&(m|=nl),new hi(h,m,p)}i+=c-u}return n?e+i:new hi(e+i,0,null)}touches(e,t){let n=0,i=Is(t),s=this.inverted?2:1,o=this.inverted?1:2;for(let l=0;l<this.ranges.length;l+=3){let a=this.ranges[l]-(this.inverted?n:0);if(a>e)break;let u=this.ranges[l+s],c=a+u;if(e<=c&&l==i*3)return!0;n+=this.ranges[l+o]-u}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],l=o-(this.inverted?s:0),a=o+(this.inverted?0:s),u=this.ranges[i+t],c=this.ranges[i+n];e(l,l+u,a,a+c),s+=c-u}}invert(){return new Ae(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Ae.empty:new Ae(e<0?[0,-e,0]:[0,0,e])}}Ae.empty=new Ae([]);class Yt{constructor(e=[],t,n=0,i=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=i}slice(e=0,t=this.maps.length){return new Yt(this.maps,this.mirror,e,t)}copy(){return new Yt(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let i=e.getMirror(t);this.appendMap(e.maps[t],i!=null&&i<t?n+i:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let i=e.getMirror(t);this.appendMap(e.maps[t].invert(),i!=null&&i>t?n-i-1:void 0)}}invert(){let e=new Yt;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let i=0;for(let s=this.from;s<this.to;s++){let o=this.maps[s],l=o.mapResult(e,t);if(l.recover!=null){let a=this.getMirror(s);if(a!=null&&a>s&&a<this.to){s=a,e=this.maps[a].recover(l.recover);continue}}i|=l.delInfo,e=l.pos}return n?e:new hi(e,i,null)}}const Kr=Object.create(null);class ye{getMap(){return Ae.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=Kr[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in Kr)throw new RangeError("Duplicate use of step JSON ID "+e);return Kr[e]=t,t.prototype.jsonID=e,t}}class U{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new U(e,null)}static fail(e){return new U(null,e)}static fromReplace(e,t,n,i){try{return U.ok(e.replace(t,n,i))}catch(s){if(s instanceof Wn)return U.fail(s.message);throw s}}}function Fi(r,e,t){let n=[];for(let i=0;i<r.childCount;i++){let s=r.child(i);s.content.size&&(s=s.copy(Fi(s.content,e,s))),s.isInline&&(s=e(s,t,i)),n.push(s)}return D.fromArray(n)}class rt extends ye{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new C(Fi(t.content,(o,l)=>!o.isAtom||!l.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),t.openStart,t.openEnd);return U.fromReplace(e,this.from,this.to,s)}invert(){return new je(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new rt(t.pos,n.pos,this.mark)}merge(e){return e instanceof rt&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new rt(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new rt(t.from,t.to,e.markFromJSON(t.mark))}}ye.jsonID("addMark",rt);class je extends ye{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new C(Fi(t.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),t.openStart,t.openEnd);return U.fromReplace(e,this.from,this.to,n)}invert(){return new rt(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new je(t.pos,n.pos,this.mark)}merge(e){return e instanceof je&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new je(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new je(t.from,t.to,e.markFromJSON(t.mark))}}ye.jsonID("removeMark",je);class it extends ye{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return U.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return U.fromReplace(e,this.pos,this.pos+1,new C(D.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let i=0;i<t.marks.length;i++)if(!t.marks[i].isInSet(n))return new it(this.pos,t.marks[i]);return new it(this.pos,this.mark)}}return new tn(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new it(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new it(t.pos,e.markFromJSON(t.mark))}}ye.jsonID("addNodeMark",it);class tn extends ye{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return U.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return U.fromReplace(e,this.pos,this.pos+1,new C(D.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new it(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new tn(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new tn(t.pos,e.markFromJSON(t.mark))}}ye.jsonID("removeNodeMark",tn);class le extends ye{constructor(e,t,n,i=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=i}apply(e){return this.structure&&pi(e,this.from,this.to)?U.fail("Structure replace would overwrite content"):U.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Ae([this.from,this.to-this.from,this.slice.size])}invert(e){return new le(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new le(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof le)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?C.empty:new C(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new le(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?C.empty:new C(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new le(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new le(t.from,t.to,C.fromJSON(e,t.slice),!!t.structure)}}ye.jsonID("replace",le);class Q extends ye{constructor(e,t,n,i,s,o,l=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=i,this.slice=s,this.insert=o,this.structure=l}apply(e){if(this.structure&&(pi(e,this.from,this.gapFrom)||pi(e,this.gapTo,this.to)))return U.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return U.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?U.fromReplace(e,this.from,this.to,n):U.fail("Content does not fit in gap")}getMap(){return new Ae([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new Q(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),i=e.map(this.gapFrom,-1),s=e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||i<t.pos||s>n.pos?null:new Q(t.pos,n.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Q(t.from,t.to,t.gapFrom,t.gapTo,C.fromJSON(e,t.slice),t.insert,!!t.structure)}}ye.jsonID("replaceAround",Q);function pi(r,e,t){let n=r.resolve(e),i=t-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let o=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function nu(r,e,t,n){let i=[],s=[],o,l;r.doc.nodesBetween(e,t,(a,u,c)=>{if(!a.isInline)return;let d=a.marks;if(!n.isInSet(d)&&c.type.allowsMarkType(n.type)){let f=Math.max(u,e),h=Math.min(u+a.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==f&&o.mark.eq(d[m])?o.to=h:i.push(o=new je(f,h,d[m])));l&&l.to==f?l.to=h:s.push(l=new rt(f,h,n))}}),i.forEach(a=>r.step(a)),s.forEach(a=>r.step(a))}function ru(r,e,t,n){let i=[],s=0;r.doc.nodesBetween(e,t,(o,l)=>{if(!o.isInline)return;s++;let a=null;if(n instanceof Ar){let u=o.marks,c;for(;c=n.isInSet(u);)(a||(a=[])).push(c),u=c.removeFromSet(u)}else n?n.isInSet(o.marks)&&(a=[n]):a=o.marks;if(a&&a.length){let u=Math.min(l+o.nodeSize,t);for(let c=0;c<a.length;c++){let d=a[c],f;for(let h=0;h<i.length;h++){let p=i[h];p.step==s-1&&d.eq(i[h].style)&&(f=p)}f?(f.to=u,f.step=s):i.push({style:d,from:Math.max(l,e),to:u,step:s})}}}),i.forEach(o=>r.step(new je(o.from,o.to,o.style)))}function iu(r,e,t,n=t.contentMatch){let i=r.doc.nodeAt(e),s=[],o=e+1;for(let l=0;l<i.childCount;l++){let a=i.child(l),u=o+a.nodeSize,c=n.matchType(a.type);if(!c)s.push(new le(o,u,C.empty));else{n=c;for(let d=0;d<a.marks.length;d++)t.allowsMarkType(a.marks[d].type)||r.step(new je(o,u,a.marks[d]))}o=u}if(!n.validEnd){let l=n.fillBefore(D.empty,!0);r.replace(o,o,new C(l,0,0))}for(let l=s.length-1;l>=0;l--)r.step(s[l])}function su(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function un(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth;;--n){let i=r.$from.node(n),s=r.$from.index(n),o=r.$to.indexAfter(n);if(n<r.depth&&i.canReplace(s,o,t))return n;if(n==0||i.type.spec.isolating||!su(i,s,o))break}return null}function ou(r,e,t){let{$from:n,$to:i,depth:s}=e,o=n.before(s+1),l=i.after(s+1),a=o,u=l,c=D.empty,d=0;for(let p=s,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,c=D.from(n.node(p).copy(c)),d++):a--;let f=D.empty,h=0;for(let p=s,m=!1;p>t;p--)m||i.after(p+1)<i.end(p)?(m=!0,f=D.from(i.node(p).copy(f)),h++):u++;r.step(new Q(a,u,o,l,new C(c.append(f),d,h),c.size-d,!0))}function Bi(r,e,t=null,n=r){let i=lu(r,e),s=i&&au(n,e);return s?i.map(Rs).concat({type:e,attrs:t}).concat(s.map(Rs)):null}function Rs(r){return{type:r,attrs:null}}function lu(r,e){let{parent:t,startIndex:n,endIndex:i}=r,s=t.contentMatchAt(n).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return t.canReplaceWith(n,i,o)?s:null}function au(r,e){let{parent:t,startIndex:n,endIndex:i}=r,s=t.child(n),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let a=(o.length?o[o.length-1]:e).contentMatch;for(let u=n;a&&u<i;u++)a=a.matchType(t.child(u).type);return!a||!a.validEnd?null:o}function uu(r,e,t){let n=D.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let l=t[o].type.contentMatch.matchFragment(n);if(!l||!l.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=D.from(t[o].type.create(t[o].attrs,n))}let i=e.start,s=e.end;r.step(new Q(i,s,i,s,new C(n,0,0),t.length,!0))}function cu(r,e,t,n,i){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=r.steps.length;r.doc.nodesBetween(e,t,(o,l)=>{if(o.isTextblock&&!o.hasMarkup(n,i)&&du(r.doc,r.mapping.slice(s).map(l),n)){r.clearIncompatible(r.mapping.slice(s).map(l,1),n);let a=r.mapping.slice(s),u=a.map(l,1),c=a.map(l+o.nodeSize,1);return r.step(new Q(u,c,u+1,c-1,new C(D.from(n.create(i,null,o.marks)),0,0),1,!0)),!1}})}function du(r,e,t){let n=r.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,t)}function fu(r,e,t,n,i){let s=r.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");t||(t=s.type);let o=t.create(n,null,i||s.marks);if(s.isLeaf)return r.replaceWith(e,e+s.nodeSize,o);if(!t.validContent(s.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new Q(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new C(D.from(o),0,0),1,!0))}function Qt(r,e,t=1,n){let i=r.resolve(e),s=i.depth-t,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let u=i.depth-1,c=t-2;u>s;u--,c--){let d=i.node(u),f=i.index(u);if(d.type.spec.isolating)return!1;let h=d.content.cutByIndex(f,d.childCount),p=n&&n[c]||d;if(p!=d&&(h=h.replaceChild(0,p.type.create(p.attrs))),!d.canReplace(f+1,d.childCount)||!p.type.validContent(h))return!1}let l=i.indexAfter(s),a=n&&n[0];return i.node(s).canReplaceWith(l,l,a?a.type:i.node(s+1).type)}function hu(r,e,t=1,n){let i=r.doc.resolve(e),s=D.empty,o=D.empty;for(let l=i.depth,a=i.depth-t,u=t-1;l>a;l--,u--){s=D.from(i.node(l).copy(s));let c=n&&n[u];o=D.from(c?c.type.create(c.attrs,o):i.node(l).copy(o))}r.step(new le(e,e,new C(s.append(o),t,t),!0))}function dt(r,e){let t=r.resolve(e),n=t.index();return rl(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function rl(r,e){return!!(r&&e&&!r.isLeaf&&r.canAppend(e))}function il(r,e,t=-1){let n=r.resolve(e);for(let i=n.depth;;i--){let s,o,l=n.index(i);if(i==n.depth?(s=n.nodeBefore,o=n.nodeAfter):t>0?(s=n.node(i+1),l++,o=n.node(i).maybeChild(l)):(s=n.node(i).maybeChild(l-1),o=n.node(i+1)),s&&!s.isTextblock&&rl(s,o)&&n.node(i).canReplace(l,l+1))return e;if(i==0)break;e=t<0?n.before(i):n.after(i)}}function pu(r,e,t){let n=new le(e-t,e+t,C.empty,!0);r.step(n)}function mu(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let i=n.depth-1;i>=0;i--){let s=n.index(i);if(n.node(i).canReplaceWith(s,s,t))return n.before(i+1);if(s>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let s=n.indexAfter(i);if(n.node(i).canReplaceWith(s,s,t))return n.after(i+1);if(s<n.node(i).childCount)return null}return null}function sl(r,e,t){let n=r.resolve(e);if(!t.content.size)return e;let i=t.content;for(let s=0;s<t.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(t.openStart==0&&t.size?2:1);s++)for(let o=n.depth;o>=0;o--){let l=o==n.depth?0:n.pos<=(n.start(o+1)+n.end(o+1))/2?-1:1,a=n.index(o)+(l>0?1:0),u=n.node(o),c=!1;if(s==1)c=u.canReplace(a,a,i);else{let d=u.contentMatchAt(a).findWrapping(i.firstChild.type);c=d&&u.canReplaceWith(a,a,d[0])}if(c)return l==0?n.pos:l<0?n.before(o+1):n.after(o+1)}return null}function Ii(r,e,t=e,n=C.empty){if(e==t&&!n.size)return null;let i=r.resolve(e),s=r.resolve(t);return ol(i,s,n)?new le(e,t,n):new gu(i,s,n).fit()}function ol(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}class gu{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=D.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=D.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let u=this.findFittable();u?this.placeNodes(u):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,l=i.depth;for(;o&&l&&s.childCount==1;)s=s.firstChild.content,o--,l--;let a=new C(s,o,l);return e>-1?new Q(n.pos,e,this.$to.pos,this.$to.end(),a,t):a.size||n.pos!=this.$to.pos?new le(n.pos,i.pos,a):null}findFittable(){for(let e=1;e<=2;e++)for(let t=this.unplaced.openStart;t>=0;t--){let n,i=null;t?(i=Wr(this.unplaced.content,t-1).firstChild,n=i.content):n=this.unplaced.content;let s=n.firstChild;for(let o=this.depth;o>=0;o--){let{type:l,match:a}=this.frontier[o],u,c=null;if(e==1&&(s?a.matchType(s.type)||(c=a.fillBefore(D.from(s),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:t,frontierDepth:o,parent:i,inject:c};if(e==2&&s&&(u=a.findWrapping(s.type)))return{sliceDepth:t,frontierDepth:o,parent:i,wrap:u};if(i&&a.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=Wr(e,t);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new C(e,t+1,Math.max(n,i.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,i=Wr(e,t);if(i.childCount<=1&&t>0){let s=e.size-t<=t+i.size;this.unplaced=new C(gn(e,t-1,1),t-1,s?t-1:n)}else this.unplaced=new C(gn(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:i,wrap:s}){for(;this.depth>t;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,l=n?n.content:o.content,a=o.openStart-e,u=0,c=[],{match:d,type:f}=this.frontier[t];if(i){for(let m=0;m<i.childCount;m++)c.push(i.child(m));d=d.matchFragment(i)}let h=l.size+e-(o.content.size-o.openEnd);for(;u<l.childCount;){let m=l.child(u),g=d.matchType(m.type);if(!g)break;u++,(u>1||a==0||m.content.size)&&(d=g,c.push(ll(m.mark(f.allowedMarks(m.marks)),u==1?a:0,u==l.childCount?h:-1)))}let p=u==l.childCount;p||(h=-1),this.placed=yn(this.placed,t,D.from(c)),this.frontier[t].match=d,p&&h<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=l;m<h;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?C.empty:new C(gn(o.content,e-1,1),e-1,h<0?o.openEnd:e-1):new C(gn(o.content,e,u),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Jr(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,i=this.$to.after(n);for(;n>1&&i==this.$to.end(--n);)++i;return i}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:i}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=Jr(e,t,i,n,s);if(o){for(let l=t-1;l>=0;l--){let{match:a,type:u}=this.frontier[l],c=Jr(e,l,u,a,!0);if(!c||c.childCount)continue e}return{depth:t,fit:o,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=yn(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let i=e.node(n),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(n));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,t=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=yn(this.placed,this.depth,D.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(D.empty,!0);t.childCount&&(this.placed=yn(this.placed,this.frontier.length,t))}}function gn(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(gn(r.firstChild.content,e-1,t)))}function yn(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(yn(r.lastChild.content,e-1,t)))}function Wr(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function ll(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,ll(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(D.empty,!0)))),r.copy(n)}function Jr(r,e,t,n,i){let s=r.node(e),o=i?r.indexAfter(e):r.index(e);if(o==s.childCount&&!t.compatibleContent(s.type))return null;let l=n.fillBefore(s.content,!0,o);return l&&!yu(t,s.content,o)?l:null}function yu(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function Du(r){return r.spec.defining||r.spec.definingForContent}function bu(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let i=r.doc.resolve(e),s=r.doc.resolve(t);if(ol(i,s,n))return r.step(new le(e,t,n));let o=ul(i,r.doc.resolve(t));o[o.length-1]==0&&o.pop();let l=-(i.depth+1);o.unshift(l);for(let f=i.depth,h=i.pos-1;f>0;f--,h--){let p=i.node(f).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(f)>-1?l=f:i.before(f)==h&&o.splice(1,0,-f)}let a=o.indexOf(l),u=[],c=n.openStart;for(let f=n.content,h=0;;h++){let p=f.firstChild;if(u.push(p),h==n.openStart)break;f=p.content}for(let f=c-1;f>=0;f--){let h=u[f].type,p=Du(h);if(p&&i.node(a).type!=h)c=f;else if(p||!h.isTextblock)break}for(let f=n.openStart;f>=0;f--){let h=(f+c+1)%(n.openStart+1),p=u[h];if(p)for(let m=0;m<o.length;m++){let g=o[(m+a)%o.length],y=!0;g<0&&(y=!1,g=-g);let b=i.node(g-1),x=i.index(g-1);if(b.canReplaceWith(x,x,p.type,p.marks))return r.replace(i.before(g),y?s.after(g):t,new C(al(n.content,0,n.openStart,h),h,n.openEnd))}}let d=r.steps.length;for(let f=o.length-1;f>=0&&(r.replace(e,t,n),!(r.steps.length>d));f--){let h=o[f];h<0||(e=i.before(h),t=s.after(h))}}function al(r,e,t,n,i){if(e<t){let s=r.firstChild;r=r.replaceChild(0,s.copy(al(s.content,e+1,t,n,s)))}if(e>n){let s=i.contentMatchAt(0),o=s.fillBefore(r).append(r);r=o.append(s.matchFragment(o).fillBefore(D.empty,!0))}return r}function ku(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let i=mu(r.doc,e,n.type);i!=null&&(e=t=i)}r.replaceRange(e,t,new C(D.from(n),0,0))}function Cu(r,e,t){let n=r.doc.resolve(e),i=r.doc.resolve(t),s=ul(n,i);for(let o=0;o<s.length;o++){let l=s[o],a=o==s.length-1;if(a&&l==0||n.node(l).type.contentMatch.validEnd)return r.delete(n.start(l),i.end(l));if(l>0&&(a||n.node(l-1).canReplace(n.index(l-1),i.indexAfter(l-1))))return r.delete(n.before(l),i.after(l))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&i.end(o)-t!=i.depth-o)return r.delete(n.before(o),t);r.delete(e,t)}function ul(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let i=n;i>=0;i--){let s=r.start(i);if(s<r.pos-(r.depth-i)||e.end(i)>e.pos+(e.depth-i)||r.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==r.depth&&i==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&t.push(i)}return t}class Xt extends ye{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return U.fail("No node at attribute step's position");let n=Object.create(null);for(let s in t.attrs)n[s]=t.attrs[s];n[this.attr]=this.value;let i=t.type.create(n,null,t.marks);return U.fromReplace(e,this.pos,this.pos+1,new C(D.from(i),0,t.isLeaf?0:1))}getMap(){return Ae.empty}invert(e){return new Xt(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Xt(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Xt(t.pos,t.attr,t.value)}}ye.jsonID("attr",Xt);let nn=class extends Error{};nn=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};nn.prototype=Object.create(Error.prototype);nn.prototype.constructor=nn;nn.prototype.name="TransformError";class cl{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Yt}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new nn(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=C.empty){let i=Ii(this.doc,e,t,n);return i&&this.step(i),this}replaceWith(e,t,n){return this.replace(e,t,new C(D.from(n),0,0))}delete(e,t){return this.replace(e,t,C.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return bu(this,e,t,n),this}replaceRangeWith(e,t,n){return ku(this,e,t,n),this}deleteRange(e,t){return Cu(this,e,t),this}lift(e,t){return ou(this,e,t),this}join(e,t=1){return pu(this,e,t),this}wrap(e,t){return uu(this,e,t),this}setBlockType(e,t=e,n,i=null){return cu(this,e,t,n,i),this}setNodeMarkup(e,t,n=null,i=[]){return fu(this,e,t,n,i),this}setNodeAttribute(e,t,n){return this.step(new Xt(e,t,n)),this}addNodeMark(e,t){return this.step(new it(e,t)),this}removeNodeMark(e,t){if(!(t instanceof R)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t=t.isInSet(n.marks),!t)return this}return this.step(new tn(e,t)),this}split(e,t=1,n){return hu(this,e,t,n),this}addMark(e,t,n){return nu(this,e,t,n),this}removeMark(e,t,n){return ru(this,e,t,n),this}clearIncompatible(e,t,n){return iu(this,e,t,n),this}}const qr=Object.create(null);class O{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new Eu(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=C.empty){let n=t.content.lastChild,i=null;for(let l=0;l<t.openEnd;l++)i=n,n=n.lastChild;let s=e.steps.length,o=this.ranges;for(let l=0;l<o.length;l++){let{$from:a,$to:u}=o[l],c=e.mapping.slice(s);e.replaceRange(c.map(a.pos),c.map(u.pos),l?C.empty:t),l==0&&zs(e,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:l}=i[s],a=e.mapping.slice(n),u=a.map(o.pos),c=a.map(l.pos);s?e.deleteRange(u,c):(e.replaceRangeWith(u,c,t),zs(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let i=e.parent.inlineContent?new F(e):_t(e.node(0),e.parent,e.pos,e.index(),t,n);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=t<0?_t(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):_t(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Ne(e.node(0))}static atStart(e){return _t(e,e,0,0,1)||new Ne(e)}static atEnd(e){return _t(e,e,e.content.size,e.childCount,-1)||new Ne(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=qr[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in qr)throw new RangeError("Duplicate use of selection JSON ID "+e);return qr[e]=t,t.prototype.jsonID=e,t}getBookmark(){return F.between(this.$anchor,this.$head).getBookmark()}}O.prototype.visible=!0;class Eu{constructor(e,t){this.$from=e,this.$to=t}}let Ps=!1;function Ls(r){!Ps&&!r.parent.inlineContent&&(Ps=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}class F extends O{constructor(e,t=e){Ls(e),Ls(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return O.near(n);let i=e.resolve(t.map(this.anchor));return new F(i.parent.inlineContent?i:n,n)}replace(e,t=C.empty){if(super.replace(e,t),t==C.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof F&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new xr(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new F(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let i=e.resolve(t);return new this(i,n==t?i:e.resolve(n))}static between(e,t,n){let i=e.pos-t.pos;if((!n||i)&&(n=i>=0?1:-1),!t.parent.inlineContent){let s=O.findFrom(t,n,!0)||O.findFrom(t,-n,!0);if(s)t=s.$head;else return O.near(t,n)}return e.parent.inlineContent||(i==0?e=t:(e=(O.findFrom(e,-n,!0)||O.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=i<0&&(e=t))),new F(e,t)}}O.jsonID("text",F);class xr{constructor(e,t){this.anchor=e,this.head=t}map(e){return new xr(e.map(this.anchor),e.map(this.head))}resolve(e){return F.between(e.resolve(this.anchor),e.resolve(this.head))}}class M extends O{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:i}=t.mapResult(this.anchor),s=e.resolve(i);return n?O.near(s):new M(s)}content(){return new C(D.from(this.node),0,0)}eq(e){return e instanceof M&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Ri(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new M(e.resolve(t.anchor))}static create(e,t){return new M(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}M.prototype.visible=!1;O.jsonID("node",M);class Ri{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new xr(n,n):new Ri(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&M.isSelectable(n)?new M(t):O.near(t)}}class Ne extends O{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=C.empty){if(t==C.empty){e.delete(0,e.doc.content.size);let n=O.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ne(e)}map(e){return new Ne(e)}eq(e){return e instanceof Ne}getBookmark(){return Su}}O.jsonID("all",Ne);const Su={map(){return this},resolve(r){return new Ne(r)}};function _t(r,e,t,n,i,s=!1){if(e.inlineContent)return F.create(r,t);for(let o=n-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let l=e.child(o);if(l.isAtom){if(!s&&M.isSelectable(l))return M.create(r,t-(i<0?l.nodeSize:0))}else{let a=_t(r,l,t+i,i<0?l.childCount:0,i,s);if(a)return a}t+=l.nodeSize*i}return null}function zs(r,e,t){let n=r.steps.length-1;if(n<e)return;let i=r.steps[n];if(!(i instanceof le||i instanceof Q))return;let s=r.mapping.maps[n],o;s.forEach((l,a,u,c)=>{o==null&&(o=c)}),r.setSelection(O.near(r.doc.resolve(o),t))}const _s=1,zn=2,Vs=4;class Au extends cl{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|_s)&~zn,this.storedMarks=null,this}get selectionSet(){return(this.updated&_s)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=zn,this}ensureMarks(e){return R.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&zn)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~zn,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||R.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let i=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(n==null&&(n=t),n=n??t,!e)return this.deleteRange(t,n);let s=this.storedMarks;if(!s){let o=this.doc.resolve(t);s=n==t?o.marks():o.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,i.text(e,s)),this.selection.empty||this.setSelection(O.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Vs,this}get scrolledIntoView(){return(this.updated&Vs)>0}}function Hs(r,e){return!e||!r?r:r.bind(e)}class Dn{constructor(e,t,n){this.name=e,this.init=Hs(t.init,n),this.apply=Hs(t.apply,n)}}const xu=[new Dn("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new Dn("selection",{init(r,e){return r.selection||O.atStart(e.doc)},apply(r){return r.selection}}),new Dn("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new Dn("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}})];class Ur{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=xu.slice(),t&&t.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Dn(n.key,n.spec.state,n))})}}class Ht{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let l=this.config.plugins[o];if(l.spec.appendTransaction){let a=i?i[o].n:0,u=i?i[o].state:this,c=a<t.length&&l.spec.appendTransaction.call(l,a?t.slice(a):t,u,n);if(c&&n.filterTransaction(c,o)){if(c.setMeta("appendedTransaction",e),!i){i=[];for(let d=0;d<this.config.plugins.length;d++)i.push(d<o?{state:n,n:t.length}:{state:this,n:0})}t.push(c),n=n.applyInner(c),s=!0}i&&(i[o]={state:n,n:t.length})}}if(!s)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new Ht(this.config),n=this.config.fields;for(let i=0;i<n.length;i++){let s=n[i];t[s.name]=s.apply(e,this[s.name],this,t)}return t}get tr(){return new Au(this)}static create(e){let t=new Ur(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new Ht(t);for(let i=0;i<t.fields.length;i++)n[t.fields[i].name]=t.fields[i].init(e,n);return n}reconfigure(e){let t=new Ur(this.schema,e.plugins),n=t.fields,i=new Ht(t);for(let s=0;s<n.length;s++){let o=n[s].name;i[o]=this.hasOwnProperty(o)?this[o]:n[s].init(e,i)}return i}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[n],s=i.spec.state;s&&s.toJSON&&(t[n]=s.toJSON.call(i,this[i.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new Ur(e.schema,e.plugins),s=new Ht(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=Ge.fromJSON(e.schema,t.doc);else if(o.name=="selection")s.selection=O.fromJSON(s.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(s.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let l in n){let a=n[l],u=a.spec.state;if(a.key==o.name&&u&&u.fromJSON&&Object.prototype.hasOwnProperty.call(t,l)){s[o.name]=u.fromJSON.call(a,e,t[l],s);return}}s[o.name]=o.init(e,s)}}),s}}function dl(r,e,t){for(let n in r){let i=r[n];i instanceof Function?i=i.bind(e):n=="handleDOMEvents"&&(i=dl(i,e,{})),t[n]=i}return t}class fe{constructor(e){this.spec=e,this.props={},e.props&&dl(e.props,this,this.props),this.key=e.key?e.key.key:fl("plugin")}getState(e){return e[this.key]}}const Gr=Object.create(null);function fl(r){return r in Gr?r+"$"+ ++Gr[r]:(Gr[r]=0,r+"$")}class Ie{constructor(e="key"){this.key=fl(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const be=function(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e},vn=function(r){let e=r.assignedSlot||r.parentNode;return e&&e.nodeType==11?e.host:e};let js=null;const Je=function(r,e,t){let n=js||(js=document.createRange());return n.setEnd(r,t??r.nodeValue.length),n.setStart(r,e||0),n},Ft=function(r,e,t,n){return t&&($s(r,e,t,n,-1)||$s(r,e,t,n,1))},Mu=/^(img|br|input|textarea|hr)$/i;function $s(r,e,t,n,i){for(;;){if(r==t&&e==n)return!0;if(e==(i<0?0:_e(r))){let s=r.parentNode;if(!s||s.nodeType!=1||vu(r)||Mu.test(r.nodeName)||r.contentEditable=="false")return!1;e=be(r)+(i<0?0:1),r=s}else if(r.nodeType==1){if(r=r.childNodes[e+(i<0?-1:0)],r.contentEditable=="false")return!1;e=i<0?_e(r):0}else return!1}}function _e(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function wu(r,e,t){for(let n=e==0,i=e==_e(r);n||i;){if(r==t)return!0;let s=be(r);if(r=r.parentNode,!r)return!1;n=n&&s==0,i=i&&s==_e(r)}}function vu(r){let e;for(let t=r;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==r||e.contentDOM==r)}const Mr=function(r){return r.focusNode&&Ft(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function jt(r,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=r,t.key=t.code=e,t}function Tu(r){let e=r.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}const ut=typeof navigator<"u"?navigator:null,Ks=typeof document<"u"?document:null,ft=ut&&ut.userAgent||"",mi=/Edge\/(\d+)/.exec(ft),hl=/MSIE \d/.exec(ft),gi=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ft),pe=!!(hl||gi||mi),ot=hl?document.documentMode:gi?+gi[1]:mi?+mi[1]:0,Be=!pe&&/gecko\/(\d+)/i.test(ft);Be&&+(/Firefox\/(\d+)/.exec(ft)||[0,0])[1];const yi=!pe&&/Chrome\/(\d+)/.exec(ft),he=!!yi,Ou=yi?+yi[1]:0,ue=!pe&&!!ut&&/Apple Computer/.test(ut.vendor),rn=ue&&(/Mobile\/\w+/.test(ft)||!!ut&&ut.maxTouchPoints>2),Se=rn||(ut?/Mac/.test(ut.platform):!1),Ve=/Android \d/.test(ft),wr=!!Ks&&"webkitFontSmoothing"in Ks.documentElement.style,Nu=wr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Fu(r){return{left:0,right:r.documentElement.clientWidth,top:0,bottom:r.documentElement.clientHeight}}function Qe(r,e){return typeof r=="number"?r:r[e]}function Bu(r){let e=r.getBoundingClientRect(),t=e.width/r.offsetWidth||1,n=e.height/r.offsetHeight||1;return{left:e.left,right:e.left+r.clientWidth*t,top:e.top,bottom:e.top+r.clientHeight*n}}function Ws(r,e,t){let n=r.someProp("scrollThreshold")||0,i=r.someProp("scrollMargin")||5,s=r.dom.ownerDocument;for(let o=t||r.dom;o;o=vn(o)){if(o.nodeType!=1)continue;let l=o,a=l==s.body,u=a?Fu(s):Bu(l),c=0,d=0;if(e.top<u.top+Qe(n,"top")?d=-(u.top-e.top+Qe(i,"top")):e.bottom>u.bottom-Qe(n,"bottom")&&(d=e.bottom-u.bottom+Qe(i,"bottom")),e.left<u.left+Qe(n,"left")?c=-(u.left-e.left+Qe(i,"left")):e.right>u.right-Qe(n,"right")&&(c=e.right-u.right+Qe(i,"right")),c||d)if(a)s.defaultView.scrollBy(c,d);else{let f=l.scrollLeft,h=l.scrollTop;d&&(l.scrollTop+=d),c&&(l.scrollLeft+=c);let p=l.scrollLeft-f,m=l.scrollTop-h;e={left:e.left-p,top:e.top-m,right:e.right-p,bottom:e.bottom-m}}if(a)break}}function Iu(r){let e=r.dom.getBoundingClientRect(),t=Math.max(0,e.top),n,i;for(let s=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let l=r.root.elementFromPoint(s,o);if(!l||l==r.dom||!r.dom.contains(l))continue;let a=l.getBoundingClientRect();if(a.top>=t-20){n=l,i=a.top;break}}return{refDOM:n,refTop:i,stack:pl(r.dom)}}function pl(r){let e=[],t=r.ownerDocument;for(let n=r;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),r!=t);n=vn(n));return e}function Ru({refDOM:r,refTop:e,stack:t}){let n=r?r.getBoundingClientRect().top:0;ml(t,n==0?0:n-e)}function ml(r,e){for(let t=0;t<r.length;t++){let{dom:n,top:i,left:s}=r[t];n.scrollTop!=i+e&&(n.scrollTop=i+e),n.scrollLeft!=s&&(n.scrollLeft=s)}}let zt=null;function Pu(r){if(r.setActive)return r.setActive();if(zt)return r.focus(zt);let e=pl(r);r.focus(zt==null?{get preventScroll(){return zt={preventScroll:!0},!0}}:void 0),zt||(zt=!1,ml(e,0))}function gl(r,e){let t,n=2e8,i,s=0,o=e.top,l=e.top;for(let a=r.firstChild,u=0;a;a=a.nextSibling,u++){let c;if(a.nodeType==1)c=a.getClientRects();else if(a.nodeType==3)c=Je(a).getClientRects();else continue;for(let d=0;d<c.length;d++){let f=c[d];if(f.top<=o&&f.bottom>=l){o=Math.max(f.bottom,o),l=Math.min(f.top,l);let h=f.left>e.left?f.left-e.left:f.right<e.left?e.left-f.right:0;if(h<n){t=a,n=h,i=h&&t.nodeType==3?{left:f.right<e.left?f.right:f.left,top:e.top}:e,a.nodeType==1&&h&&(s=u+(e.left>=(f.left+f.right)/2?1:0));continue}}!t&&(e.left>=f.right&&e.top>=f.top||e.left>=f.left&&e.top>=f.bottom)&&(s=u+1)}}return t&&t.nodeType==3?Lu(t,i):!t||n&&t.nodeType==1?{node:r,offset:s}:gl(t,i)}function Lu(r,e){let t=r.nodeValue.length,n=document.createRange();for(let i=0;i<t;i++){n.setEnd(r,i+1),n.setStart(r,i);let s=Xe(n,1);if(s.top!=s.bottom&&Pi(e,s))return{node:r,offset:i+(e.left>=(s.left+s.right)/2?1:0)}}return{node:r,offset:0}}function Pi(r,e){return r.left>=e.left-1&&r.left<=e.right+1&&r.top>=e.top-1&&r.top<=e.bottom+1}function zu(r,e){let t=r.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<r.getBoundingClientRect().left?t:r}function _u(r,e,t){let{node:n,offset:i}=gl(e,t),s=-1;if(n.nodeType==1&&!n.firstChild){let o=n.getBoundingClientRect();s=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return r.docView.posFromDOM(n,i,s)}function Vu(r,e,t,n){let i=-1;for(let s=e;s!=r.dom;){let o=r.docView.nearestDesc(s,!0);if(!o)return null;if(o.node.isBlock&&o.parent){let l=o.dom.getBoundingClientRect();if(l.left>n.left||l.top>n.top)i=o.posBefore;else if(l.right<n.left||l.bottom<n.top)i=o.posAfter;else break}s=o.dom.parentNode}return i>-1?i:r.docView.posFromDOM(e,t,1)}function yl(r,e,t){let n=r.childNodes.length;if(n&&t.top<t.bottom)for(let i=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-t.top)/(t.bottom-t.top))-2)),s=i;;){let o=r.childNodes[s];if(o.nodeType==1){let l=o.getClientRects();for(let a=0;a<l.length;a++){let u=l[a];if(Pi(e,u))return yl(o,e,u)}}if((s=(s+1)%n)==i)break}return r}function Hu(r,e){let t=r.dom.ownerDocument,n,i=0;if(t.caretPositionFromPoint)try{let a=t.caretPositionFromPoint(e.left,e.top);a&&({offsetNode:n,offset:i}=a)}catch{}if(!n&&t.caretRangeFromPoint){let a=t.caretRangeFromPoint(e.left,e.top);a&&({startContainer:n,startOffset:i}=a)}let s=(r.root.elementFromPoint?r.root:t).elementFromPoint(e.left,e.top),o;if(!s||!r.dom.contains(s.nodeType!=1?s.parentNode:s)){let a=r.dom.getBoundingClientRect();if(!Pi(e,a)||(s=yl(r.dom,e,a),!s))return null}if(ue)for(let a=s;n&&a;a=vn(a))a.draggable&&(n=void 0);if(s=zu(s,e),n){if(Be&&n.nodeType==1&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let a=n.childNodes[i],u;a.nodeName=="IMG"&&(u=a.getBoundingClientRect()).right<=e.left&&u.bottom>e.top&&i++}n==r.dom&&i==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?o=r.state.doc.content.size:(i==0||n.nodeType!=1||n.childNodes[i-1].nodeName!="BR")&&(o=Vu(r,n,i,e))}o==null&&(o=_u(r,s,e));let l=r.docView.nearestDesc(s,!0);return{pos:o,inside:l?l.posAtStart-l.border:-1}}function Xe(r,e){let t=r.getClientRects();return t.length?t[e<0?0:t.length-1]:r.getBoundingClientRect()}const ju=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Dl(r,e,t){let{node:n,offset:i,atom:s}=r.docView.domFromPos(e,t<0?-1:1),o=wr||Be;if(n.nodeType==3)if(o&&(ju.test(n.nodeValue)||(t<0?!i:i==n.nodeValue.length))){let a=Xe(Je(n,i,i),t);if(Be&&i&&/\s/.test(n.nodeValue[i-1])&&i<n.nodeValue.length){let u=Xe(Je(n,i-1,i-1),-1);if(u.top==a.top){let c=Xe(Je(n,i,i+1),-1);if(c.top!=a.top)return dn(c,c.left<u.left)}}return a}else{let a=i,u=i,c=t<0?1:-1;return t<0&&!i?(u++,c=-1):t>=0&&i==n.nodeValue.length?(a--,c=1):t<0?a--:u++,dn(Xe(Je(n,a,u),1),c<0)}if(!r.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(t<0||i==_e(n))){let a=n.childNodes[i-1];if(a.nodeType==1)return Yr(a.getBoundingClientRect(),!1)}if(s==null&&i<_e(n)){let a=n.childNodes[i];if(a.nodeType==1)return Yr(a.getBoundingClientRect(),!0)}return Yr(n.getBoundingClientRect(),t>=0)}if(s==null&&i&&(t<0||i==_e(n))){let a=n.childNodes[i-1],u=a.nodeType==3?Je(a,_e(a)-(o?0:1)):a.nodeType==1&&(a.nodeName!="BR"||!a.nextSibling)?a:null;if(u)return dn(Xe(u,1),!1)}if(s==null&&i<_e(n)){let a=n.childNodes[i];for(;a.pmViewDesc&&a.pmViewDesc.ignoreForCoords;)a=a.nextSibling;let u=a?a.nodeType==3?Je(a,0,o?0:1):a.nodeType==1?a:null:null;if(u)return dn(Xe(u,-1),!0)}return dn(Xe(n.nodeType==3?Je(n):n,-t),t>=0)}function dn(r,e){if(r.width==0)return r;let t=e?r.left:r.right;return{top:r.top,bottom:r.bottom,left:t,right:t}}function Yr(r,e){if(r.height==0)return r;let t=e?r.top:r.bottom;return{top:t,bottom:t,left:r.left,right:r.right}}function bl(r,e,t){let n=r.state,i=r.root.activeElement;n!=e&&r.updateState(e),i!=r.dom&&r.focus();try{return t()}finally{n!=e&&r.updateState(n),i!=r.dom&&i&&i.focus()}}function $u(r,e,t){let n=e.selection,i=t=="up"?n.$from:n.$to;return bl(r,e,()=>{let{node:s}=r.docView.domFromPos(i.pos,t=="up"?-1:1);for(;;){let l=r.docView.nearestDesc(s,!0);if(!l)break;if(l.node.isBlock){s=l.dom;break}s=l.dom.parentNode}let o=Dl(r,i.pos,1);for(let l=s.firstChild;l;l=l.nextSibling){let a;if(l.nodeType==1)a=l.getClientRects();else if(l.nodeType==3)a=Je(l,0,l.nodeValue.length).getClientRects();else continue;for(let u=0;u<a.length;u++){let c=a[u];if(c.bottom>c.top+1&&(t=="up"?o.top-c.top>(c.bottom-o.top)*2:c.bottom-o.bottom>(o.bottom-c.top)*2))return!1}}return!0})}const Ku=/[\u0590-\u08ac]/;function Wu(r,e,t){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let i=n.parentOffset,s=!i,o=i==n.parent.content.size,l=r.domSelection();return!Ku.test(n.parent.textContent)||!l.modify?t=="left"||t=="backward"?s:o:bl(r,e,()=>{let{focusNode:a,focusOffset:u,anchorNode:c,anchorOffset:d}=r.domSelectionRange(),f=l.caretBidiLevel;l.modify("move",t,"character");let h=n.depth?r.docView.domAfterPos(n.before()):r.dom,{focusNode:p,focusOffset:m}=r.domSelectionRange(),g=p&&!h.contains(p.nodeType==1?p:p.parentNode)||a==p&&u==m;try{l.collapse(c,d),a&&(a!=c||u!=d)&&l.extend&&l.extend(a,u)}catch{}return f!=null&&(l.caretBidiLevel=f),g})}let Js=null,qs=null,Us=!1;function Ju(r,e,t){return Js==e&&qs==t?Us:(Js=e,qs=t,Us=t=="up"||t=="down"?$u(r,e,t):Wu(r,e,t))}const Fe=0,Gs=1,$t=2,$e=3;class Nn{constructor(e,t,n,i){this.parent=e,this.children=t,this.dom=n,this.contentDOM=i,this.dirty=Fe,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let i=this.children[t];if(i==e)return n;n+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let s,o;if(e==this.contentDOM)s=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=t>be(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&t==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!t||s.node))if(n&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))n=!1;else return s}}getDesc(e){let t=e.pmViewDesc;for(let n=t;n;n=n.parent)if(n==this)return t}posFromDOM(e,t,n){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let i=this.children[t],s=n+i.size;if(n==e&&s!=n){for(;!i.border&&i.children.length;)i=i.children[0];return i}if(e<s)return i.descAt(e-n-i.border);n=s}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,i=0;for(let s=0;n<this.children.length;n++){let o=this.children[n],l=s+o.size;if(l>e||o instanceof Cl){i=e-s;break}s=l}if(i)return this.children[n].domFromPos(i-this.children[n].border,t);for(let s;n&&!(s=this.children[n-1]).size&&s instanceof kl&&s.side>=0;n--);if(t<=0){let s,o=!0;for(;s=n?this.children[n-1]:null,!(!s||s.dom.parentNode==this.contentDOM);n--,o=!1);return s&&t&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,t):{node:this.contentDOM,offset:s?be(s.dom)+1:0}}else{let s,o=!0;for(;s=n<this.children.length?this.children[n]:null,!(!s||s.dom.parentNode==this.contentDOM);n++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,t):{node:this.contentDOM,offset:s?be(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=n,l=0;;l++){let a=this.children[l],u=o+a.size;if(i==-1&&e<=u){let c=o+a.border;if(e>=c&&t<=u-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(e,t,c);e=o;for(let d=l;d>0;d--){let f=this.children[d-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){i=be(f.dom)+1;break}e-=f.size}i==-1&&(i=0)}if(i>-1&&(u>t||l==this.children.length-1)){t=u;for(let c=l+1;c<this.children.length;c++){let d=this.children[c];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){s=be(d.dom);break}t+=d.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=u}return{node:this.contentDOM,from:e,to:t,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(t.nodeType!=1||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,i=!1){let s=Math.min(e,t),o=Math.max(e,t);for(let f=0,h=0;f<this.children.length;f++){let p=this.children[f],m=h+p.size;if(s>h&&o<m)return p.setSelection(e-h-p.border,t-h-p.border,n,i);h=m}let l=this.domFromPos(e,e?-1:1),a=t==e?l:this.domFromPos(t,t?-1:1),u=n.getSelection(),c=!1;if((Be||ue)&&e==t){let{node:f,offset:h}=l;if(f.nodeType==3){if(c=!!(h&&f.nodeValue[h-1]==`
`),c&&h==f.nodeValue.length)for(let p=f,m;p;p=p.parentNode){if(m=p.nextSibling){m.nodeName=="BR"&&(l=a={node:m.parentNode,offset:be(m)+1});break}let g=p.pmViewDesc;if(g&&g.node&&g.node.isBlock)break}}else{let p=f.childNodes[h-1];c=p&&(p.nodeName=="BR"||p.contentEditable=="false")}}if(Be&&u.focusNode&&u.focusNode!=a.node&&u.focusNode.nodeType==1){let f=u.focusNode.childNodes[u.focusOffset];f&&f.contentEditable=="false"&&(i=!0)}if(!(i||c&&ue)&&Ft(l.node,l.offset,u.anchorNode,u.anchorOffset)&&Ft(a.node,a.offset,u.focusNode,u.focusOffset))return;let d=!1;if((u.extend||e==t)&&!c){u.collapse(l.node,l.offset);try{e!=t&&u.extend(a.node,a.offset),d=!0}catch{}}if(!d){if(e>t){let h=l;l=a,a=h}let f=document.createRange();f.setEnd(a.node,a.offset),f.setStart(l.node,l.offset),u.removeAllRanges(),u.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,i=0;i<this.children.length;i++){let s=this.children[i],o=n+s.size;if(n==o?e<=o&&t>=n:e<o&&t>n){let l=n+s.border,a=o-s.border;if(e>=l&&t<=a){this.dirty=e==n||t==o?$t:Gs,e==l&&t==a&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=$e:s.markDirty(e-l,t-l);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?$t:$e}n=o}this.dirty=$t}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=e==1?$t:Gs;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class kl extends Nn{constructor(e,t,n,i){let s,o=t.type.toDOM;if(typeof o=="function"&&(o=o(n,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!t.type.spec.raw){if(o.nodeType!=1){let l=document.createElement("span");l.appendChild(o),o=l}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,s=this}matchesWidget(e){return this.dirty==Fe&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class qu extends Nn{constructor(e,t,n,i){super(e,[],t,null),this.textDOM=n,this.text=i}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Bt extends Nn{constructor(e,t,n,i){super(e,[],n,i),this.mark=t}static create(e,t,n,i){let s=i.nodeViews[t.type.name],o=s&&s(t,i,n);return(!o||!o.dom)&&(o=He.renderSpec(document,t.type.spec.toDOM(t,n))),new Bt(e,t,o.dom,o.contentDOM||o.dom)}parseRule(){return this.dirty&$e||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(e){return this.dirty!=$e&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Fe){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=Fe}}slice(e,t,n){let i=Bt.create(this.parent,this.mark,!0,n),s=this.children,o=this.size;t<o&&(s=ki(s,t,o,n)),e>0&&(s=ki(s,0,e,n));for(let l=0;l<s.length;l++)s[l].parent=i;return i.children=s,i}}class It extends Nn{constructor(e,t,n,i,s,o,l,a,u){super(e,[],s,o),this.node=t,this.outerDeco=n,this.innerDeco=i,this.nodeDOM=l,o&&this.updateChildren(a,u)}static create(e,t,n,i,s,o){let l=s.nodeViews[t.type.name],a,u=l&&l(t,s,()=>{if(!a)return o;if(a.parent)return a.parent.posBeforeChild(a)},n,i),c=u&&u.dom,d=u&&u.contentDOM;if(t.isText){if(!c)c=document.createTextNode(t.text);else if(c.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else c||({dom:c,contentDOM:d}=He.renderSpec(document,t.type.spec.toDOM(t)));!d&&!t.isText&&c.nodeName!="BR"&&(c.hasAttribute("contenteditable")||(c.contentEditable="false"),t.type.spec.draggable&&(c.draggable=!0));let f=c;return c=Al(c,n,t),u?a=new Uu(e,t,n,i,c,d||null,f,u,s,o+1):t.isText?new vr(e,t,n,i,c,f,s):new It(e,t,n,i,c,d||null,f,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>D.empty)}return e}matchesNode(e,t,n){return this.dirty==Fe&&e.eq(this.node)&&bi(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,i=t,s=e.composing?this.localCompositionInfo(e,t):null,o=s&&s.pos>-1?s:null,l=s&&s.pos<0,a=new Yu(this,o&&o.node,e);Zu(this.node,this.innerDeco,(u,c,d)=>{u.spec.marks?a.syncToMarks(u.spec.marks,n,e):u.type.side>=0&&!d&&a.syncToMarks(c==this.node.childCount?R.none:this.node.child(c).marks,n,e),a.placeWidget(u,e,i)},(u,c,d,f)=>{a.syncToMarks(u.marks,n,e);let h;a.findNodeMatch(u,c,d,f)||l&&e.state.selection.from>i&&e.state.selection.to<i+u.nodeSize&&(h=a.findIndexWithChild(s.node))>-1&&a.updateNodeAt(u,c,d,h,e)||a.updateNextNode(u,c,d,e,f)||a.addNode(u,c,d,e,i),i+=u.nodeSize}),a.syncToMarks([],n,e),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||this.dirty==$t)&&(o&&this.protectLocalComposition(e,o),El(this.contentDOM,this.children,e),rn&&ec(this.dom))}localCompositionInfo(e,t){let{from:n,to:i}=e.state.selection;if(!(e.state.selection instanceof F)||n<t||i>t+this.node.content.size)return null;let s=e.domSelectionRange(),o=tc(s.focusNode,s.focusOffset);if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let l=o.nodeValue,a=nc(this.node.content,l,n-t,i-t);return a<0?null:{node:o,pos:a,text:l}}else return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:i}){if(this.getDesc(t))return;let s=t;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new qu(this,s,t,i);e.input.compositionNodes.push(o),this.children=ki(this.children,n,n+i.length,e,o)}update(e,t,n,i){return this.dirty==$e||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,n,i),!0)}updateInner(e,t,n,i){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Fe}updateOuterDeco(e){if(bi(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=Sl(this.dom,this.nodeDOM,Di(this.outerDeco,this.node,t),Di(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function Ys(r,e,t,n,i){return Al(n,e,r),new It(void 0,r,e,t,n,n,n,i,0)}class vr extends It{constructor(e,t,n,i,s,o,l){super(e,t,n,i,s,null,o,l,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,i){return this.dirty==$e||this.dirty!=Fe&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Fe||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Fe,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,n){let i=this.node.cut(e,t),s=document.createTextNode(i.text);return new vr(this.parent,i,this.outerDeco,this.innerDeco,s,s,n)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=$e)}get domAtom(){return!1}}class Cl extends Nn{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Fe&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class Uu extends It{constructor(e,t,n,i,s,o,l,a,u,c){super(e,t,n,i,s,o,l,u,c),this.spec=a}update(e,t,n,i){if(this.dirty==$e)return!1;if(this.spec.update){let s=this.spec.update(e,t,n);return s&&this.updateInner(e,t,n,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,n,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,i){this.spec.setSelection?this.spec.setSelection(e,t,n):super.setSelection(e,t,n,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function El(r,e,t){let n=r.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],l=o.dom;if(l.parentNode==r){for(;l!=n;)n=Qs(n),i=!0;n=n.nextSibling}else i=!0,r.insertBefore(l,n);if(o instanceof Bt){let a=n?n.previousSibling:r.lastChild;El(o.contentDOM,o.children,t),n=a?a.nextSibling:r.firstChild}}for(;n;)n=Qs(n),i=!0;i&&t.trackWrites==r&&(t.trackWrites=null)}const Cn=function(r){r&&(this.nodeName=r)};Cn.prototype=Object.create(null);const xt=[new Cn];function Di(r,e,t){if(r.length==0)return xt;let n=t?xt[0]:new Cn,i=[n];for(let s=0;s<r.length;s++){let o=r[s].type.attrs;if(o){o.nodeName&&i.push(n=new Cn(o.nodeName));for(let l in o){let a=o[l];a!=null&&(t&&i.length==1&&i.push(n=new Cn(e.isInline?"span":"div")),l=="class"?n.class=(n.class?n.class+" ":"")+a:l=="style"?n.style=(n.style?n.style+";":"")+a:l!="nodeName"&&(n[l]=a))}}}return i}function Sl(r,e,t,n){if(t==xt&&n==xt)return e;let i=e;for(let s=0;s<n.length;s++){let o=n[s],l=t[s];if(s){let a;l&&l.nodeName==o.nodeName&&i!=r&&(a=i.parentNode)&&a.nodeName.toLowerCase()==o.nodeName||(a=document.createElement(o.nodeName),a.pmIsDeco=!0,a.appendChild(i),l=xt[0]),i=a}Gu(i,l||xt[0],o)}return i}function Gu(r,e,t){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in t)&&r.removeAttribute(n);for(let n in t)n!="class"&&n!="style"&&n!="nodeName"&&t[n]!=e[n]&&r.setAttribute(n,t[n]);if(e.class!=t.class){let n=e.class?e.class.split(" ").filter(Boolean):[],i=t.class?t.class.split(" ").filter(Boolean):[];for(let s=0;s<n.length;s++)i.indexOf(n[s])==-1&&r.classList.remove(n[s]);for(let s=0;s<i.length;s++)n.indexOf(i[s])==-1&&r.classList.add(i[s]);r.classList.length==0&&r.removeAttribute("class")}if(e.style!=t.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=n.exec(e.style);)r.style.removeProperty(i[1])}t.style&&(r.style.cssText+=t.style)}}function Al(r,e,t){return Sl(r,r,xt,Di(e,t,r.nodeType!=1))}function bi(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(!r[t].type.eq(e[t].type))return!1;return!0}function Qs(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}class Yu{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Qu(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=Fe,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let l=-1;for(let a=this.index;a<Math.min(this.index+3,this.top.children.length);a++)if(this.top.children[a].matchesMark(e[s])){l=a;break}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let a=Bt.create(this.top,e[s],t,n);this.top.children.splice(this.index,0,a),this.top=a,this.changed=!0}this.index=0,s++}}findNodeMatch(e,t,n,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,n))s=this.top.children.indexOf(o,this.index);else for(let l=this.index,a=Math.min(this.top.children.length,l+5);l<a;l++){let u=this.top.children[l];if(u.matchesNode(e,t,n)&&!this.preMatch.matched.has(u)){s=l;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,t,n,i,s){let o=this.top.children[i];return o.dirty==$e&&o.dom==o.contentDOM&&(o.dirty=$t),o.update(e,t,n,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==n)return i}return-1}e=t}}updateNextNode(e,t,n,i,s){for(let o=this.index;o<this.top.children.length;o++){let l=this.top.children[o];if(l instanceof It){let a=this.preMatch.matched.get(l);if(a!=null&&a!=s)return!1;let u=l.dom;if(!(this.lock&&(u==this.lock||u.nodeType==1&&u.contains(this.lock.parentNode))&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=$e&&bi(t,l.outerDeco)))&&l.update(e,t,n,i))return this.destroyBetween(this.index,o),l.dom!=u&&(this.changed=!0),this.index++,!0;break}}return!1}addNode(e,t,n,i,s){this.top.children.splice(this.index++,0,It.create(this.top,e,t,n,i,s)),this.changed=!0}placeWidget(e,t,n){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new kl(this.top,e,t,n);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof Bt;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof vr)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((ue||he)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let i=new Cl(this.top,[],n,null);t!=this.top?t.children.push(i):t.children.splice(this.index++,0,i),this.changed=!0}}}function Qu(r,e){let t=e,n=t.children.length,i=r.childCount,s=new Map,o=[];e:for(;i>0;){let l;for(;;)if(n){let u=t.children[n-1];if(u instanceof Bt)t=u,n=u.children.length;else{l=u,n--;break}}else{if(t==e)break e;n=t.parent.children.indexOf(t),t=t.parent}let a=l.node;if(a){if(a!=r.child(i-1))break;--i,s.set(l,i),o.push(l)}}return{index:i,matched:s,matches:o.reverse()}}function Xu(r,e){return r.type.side-e.type.side}function Zu(r,e,t,n){let i=e.locals(r),s=0;if(i.length==0){for(let u=0;u<r.childCount;u++){let c=r.child(u);n(c,i,e.forChild(s,c),u),s+=c.nodeSize}return}let o=0,l=[],a=null;for(let u=0;;){if(o<i.length&&i[o].to==s){let p=i[o++],m;for(;o<i.length&&i[o].to==s;)(m||(m=[p])).push(i[o++]);if(m){m.sort(Xu);for(let g=0;g<m.length;g++)t(m[g],u,!!a)}else t(p,u,!!a)}let c,d;if(a)d=-1,c=a,a=null;else if(u<r.childCount)d=u,c=r.child(u++);else break;for(let p=0;p<l.length;p++)l[p].to<=s&&l.splice(p--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)l.push(i[o++]);let f=s+c.nodeSize;if(c.isText){let p=f;o<i.length&&i[o].from<p&&(p=i[o].from);for(let m=0;m<l.length;m++)l[m].to<p&&(p=l[m].to);p<f&&(a=c.cut(p-s),c=c.cut(0,p-s),f=p,d=-1)}let h=c.isInline&&!c.isLeaf?l.filter(p=>!p.inline):l.slice();n(c,h,e.forChild(s,c),d),s=f}}function ec(r){if(r.nodeName=="UL"||r.nodeName=="OL"){let e=r.style.cssText;r.style.cssText=e+"; list-style: square !important",window.getComputedStyle(r).listStyle,r.style.cssText=e}}function tc(r,e){for(;;){if(r.nodeType==3)return r;if(r.nodeType==1&&e>0){if(r.childNodes.length>e&&r.childNodes[e].nodeType==3)return r.childNodes[e];r=r.childNodes[e-1],e=_e(r)}else if(r.nodeType==1&&e<r.childNodes.length)r=r.childNodes[e],e=0;else return null}}function nc(r,e,t,n){for(let i=0,s=0;i<r.childCount&&s<=n;){let o=r.child(i++),l=s;if(s+=o.nodeSize,!o.isText)continue;let a=o.text;for(;i<r.childCount;){let u=r.child(i++);if(s+=u.nodeSize,!u.isText)break;a+=u.text}if(s>=t){let u=l<n?a.lastIndexOf(e,n-l-1):-1;if(u>=0&&u+e.length+l>=t)return l+u;if(t==n&&a.length>=n+e.length-l&&a.slice(n-l,n-l+e.length)==e)return n}}return-1}function ki(r,e,t,n,i){let s=[];for(let o=0,l=0;o<r.length;o++){let a=r[o],u=l,c=l+=a.size;u>=t||c<=e?s.push(a):(u<e&&s.push(a.slice(0,e-u,n)),i&&(s.push(i),i=void 0),c>t&&s.push(a.slice(t-u,a.size,n)))}return s}function Li(r,e=null){let t=r.domSelectionRange(),n=r.state.doc;if(!t.focusNode)return null;let i=r.docView.nearestDesc(t.focusNode),s=i&&i.size==0,o=r.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let l=n.resolve(o),a,u;if(Mr(t)){for(a=l;i&&!i.node;)i=i.parent;let c=i.node;if(i&&c.isAtom&&M.isSelectable(c)&&i.parent&&!(c.isInline&&wu(t.focusNode,t.focusOffset,i.dom))){let d=i.posBefore;u=new M(o==d?l:n.resolve(d))}}else{let c=r.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(c<0)return null;a=n.resolve(c)}if(!u){let c=e=="pointer"||r.state.selection.head<l.pos&&!s?1:-1;u=zi(r,a,l,c)}return u}function xl(r){return r.editable?r.hasFocus():wl(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function Ye(r,e=!1){let t=r.state.selection;if(Ml(r,t),!!xl(r)){if(!e&&r.input.mouseDown&&r.input.mouseDown.allowDefault&&he){let n=r.domSelectionRange(),i=r.domObserver.currentSelection;if(n.anchorNode&&i.anchorNode&&Ft(n.anchorNode,n.anchorOffset,i.anchorNode,i.anchorOffset)){r.input.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)ic(r);else{let{anchor:n,head:i}=t,s,o;Xs&&!(t instanceof F)&&(t.$from.parent.inlineContent||(s=Zs(r,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=Zs(r,t.to))),r.docView.setSelection(n,i,r.root,e),Xs&&(s&&eo(s),o&&eo(o)),t.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&rc(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}const Xs=ue||he&&Ou<63;function Zs(r,e){let{node:t,offset:n}=r.docView.domFromPos(e,0),i=n<t.childNodes.length?t.childNodes[n]:null,s=n?t.childNodes[n-1]:null;if(ue&&i&&i.contentEditable=="false")return Qr(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return Qr(i);if(s)return Qr(s)}}function Qr(r){return r.contentEditable="true",ue&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function eo(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function rc(r){let e=r.dom.ownerDocument;e.removeEventListener("selectionchange",r.input.hideSelectionGuard);let t=r.domSelectionRange(),n=t.anchorNode,i=t.anchorOffset;e.addEventListener("selectionchange",r.input.hideSelectionGuard=()=>{(t.anchorNode!=n||t.anchorOffset!=i)&&(e.removeEventListener("selectionchange",r.input.hideSelectionGuard),setTimeout(()=>{(!xl(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function ic(r){let e=r.domSelection(),t=document.createRange(),n=r.cursorWrapper.dom,i=n.nodeName=="IMG";i?t.setEnd(n.parentNode,be(n)+1):t.setEnd(n,0),t.collapse(!1),e.removeAllRanges(),e.addRange(t),!i&&!r.state.selection.visible&&pe&&ot<=11&&(n.disabled=!0,n.disabled=!1)}function Ml(r,e){if(e instanceof M){let t=r.docView.descAt(e.from);t!=r.lastSelectedViewDesc&&(to(r),t&&t.selectNode(),r.lastSelectedViewDesc=t)}else to(r)}function to(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=void 0)}function zi(r,e,t,n){return r.someProp("createSelectionBetween",i=>i(r,e,t))||F.between(e,t,n)}function no(r){return r.editable&&!r.hasFocus()?!1:wl(r)}function wl(r){let e=r.domSelectionRange();if(!e.anchorNode)return!1;try{return r.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(r.editable||r.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function sc(r){let e=r.docView.domFromPos(r.state.selection.anchor,0),t=r.domSelectionRange();return Ft(e.node,e.offset,t.anchorNode,t.anchorOffset)}function Ci(r,e){let{$anchor:t,$head:n}=r.selection,i=e>0?t.max(n):t.min(n),s=i.parent.inlineContent?i.depth?r.doc.resolve(e>0?i.after():i.before()):null:i;return s&&O.findFrom(s,e)}function St(r,e){return r.dispatch(r.state.tr.setSelection(e).scrollIntoView()),!0}function ro(r,e,t){let n=r.state.selection;if(n instanceof F){if(!n.empty||t.indexOf("s")>-1)return!1;if(r.endOfTextblock(e>0?"right":"left")){let i=Ci(r.state,e);return i&&i instanceof M?St(r,i):!1}else if(!(Se&&t.indexOf("m")>-1)){let i=n.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let l=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=r.docView.descAt(l))&&!o.contentDOM?M.isSelectable(s)?St(r,new M(e<0?r.state.doc.resolve(i.pos-s.nodeSize):i)):wr?St(r,new F(r.state.doc.resolve(e<0?l:l+s.nodeSize))):!1:!1}}else{if(n instanceof M&&n.node.isInline)return St(r,new F(e>0?n.$to:n.$from));{let i=Ci(r.state,e);return i?St(r,i):!1}}}function Qn(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function En(r){let e=r.pmViewDesc;return e&&e.size==0&&(r.nextSibling||r.nodeName!="BR")}function Xr(r){let e=r.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let i,s,o=!1;for(Be&&t.nodeType==1&&n<Qn(t)&&En(t.childNodes[n])&&(o=!0);;)if(n>0){if(t.nodeType!=1)break;{let l=t.childNodes[n-1];if(En(l))i=t,s=--n;else if(l.nodeType==3)t=l,n=t.nodeValue.length;else break}}else{if(vl(t))break;{let l=t.previousSibling;for(;l&&En(l);)i=t.parentNode,s=be(l),l=l.previousSibling;if(l)t=l,n=Qn(t);else{if(t=t.parentNode,t==r.dom)break;n=0}}}o?Ei(r,t,n):i&&Ei(r,i,s)}function Zr(r){let e=r.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let i=Qn(t),s,o;for(;;)if(n<i){if(t.nodeType!=1)break;let l=t.childNodes[n];if(En(l))s=t,o=++n;else break}else{if(vl(t))break;{let l=t.nextSibling;for(;l&&En(l);)s=l.parentNode,o=be(l)+1,l=l.nextSibling;if(l)t=l,n=0,i=Qn(t);else{if(t=t.parentNode,t==r.dom)break;n=i=0}}}s&&Ei(r,s,o)}function vl(r){let e=r.pmViewDesc;return e&&e.node&&e.node.isBlock}function Ei(r,e,t){let n=r.domSelection();if(Mr(n)){let s=document.createRange();s.setEnd(e,t),s.setStart(e,t),n.removeAllRanges(),n.addRange(s)}else n.extend&&n.extend(e,t);r.domObserver.setCurSelection();let{state:i}=r;setTimeout(()=>{r.state==i&&Ye(r)},50)}function io(r,e,t){let n=r.state.selection;if(n instanceof F&&!n.empty||t.indexOf("s")>-1||Se&&t.indexOf("m")>-1)return!1;let{$from:i,$to:s}=n;if(!i.parent.inlineContent||r.endOfTextblock(e<0?"up":"down")){let o=Ci(r.state,e);if(o&&o instanceof M)return St(r,o)}if(!i.parent.inlineContent){let o=e<0?i:s,l=n instanceof Ne?O.near(o,e):O.findFrom(o,e);return l?St(r,l):!1}return!1}function so(r,e){if(!(r.state.selection instanceof F))return!0;let{$head:t,$anchor:n,empty:i}=r.state.selection;if(!t.sameParent(n))return!0;if(!i)return!1;if(r.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(s&&!s.isText){let o=r.state.tr;return e<0?o.delete(t.pos-s.nodeSize,t.pos):o.delete(t.pos,t.pos+s.nodeSize),r.dispatch(o),!0}return!1}function oo(r,e,t){r.domObserver.stop(),e.contentEditable=t,r.domObserver.start()}function oc(r){if(!ue||r.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=r.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;oo(r,n,"true"),setTimeout(()=>oo(r,n,"false"),20)}return!1}function lc(r){let e="";return r.ctrlKey&&(e+="c"),r.metaKey&&(e+="m"),r.altKey&&(e+="a"),r.shiftKey&&(e+="s"),e}function ac(r,e){let t=e.keyCode,n=lc(e);return t==8||Se&&t==72&&n=="c"?so(r,-1)||Xr(r):t==46||Se&&t==68&&n=="c"?so(r,1)||Zr(r):t==13||t==27?!0:t==37||Se&&t==66&&n=="c"?ro(r,-1,n)||Xr(r):t==39||Se&&t==70&&n=="c"?ro(r,1,n)||Zr(r):t==38||Se&&t==80&&n=="c"?io(r,-1,n)||Xr(r):t==40||Se&&t==78&&n=="c"?oc(r)||io(r,1,n)||Zr(r):n==(Se?"m":"c")&&(t==66||t==73||t==89||t==90)}function Tl(r,e){r.someProp("transformCopied",h=>{e=h(e,r)});let t=[],{content:n,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&n.childCount==1&&n.firstChild.childCount==1;){i--,s--;let h=n.firstChild;t.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),n=h.content}let o=r.someProp("clipboardSerializer")||He.fromSchema(r.state.schema),l=Rl(),a=l.createElement("div");a.appendChild(o.serializeFragment(n,{document:l}));let u=a.firstChild,c,d=0;for(;u&&u.nodeType==1&&(c=Il[u.nodeName.toLowerCase()]);){for(let h=c.length-1;h>=0;h--){let p=l.createElement(c[h]);for(;a.firstChild;)p.appendChild(a.firstChild);a.appendChild(p),d++}u=a.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(t)}`);let f=r.someProp("clipboardTextSerializer",h=>h(e,r))||e.content.textBetween(0,e.content.size,`

`);return{dom:a,text:f}}function Ol(r,e,t,n,i){let s=i.parent.type.spec.code,o,l;if(!t&&!e)return null;let a=e&&(n||s||!t);if(a){if(r.someProp("transformPastedText",f=>{e=f(e,s||n,r)}),s)return e?new C(D.from(r.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):C.empty;let d=r.someProp("clipboardTextParser",f=>f(e,i,n,r));if(d)l=d;else{let f=i.marks(),{schema:h}=r.state,p=He.fromSchema(h);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(h.text(m,f)))})}}else r.someProp("transformPastedHTML",d=>{t=d(t,r)}),o=dc(t),wr&&fc(o);let u=o&&o.querySelector("[data-pm-slice]"),c=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(c&&c[3])for(let d=+c[3];d>0;d--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(l||(l=(r.someProp("clipboardParser")||r.someProp("domParser")||en.fromSchema(r.state.schema)).parseSlice(o,{preserveWhitespace:!!(a||c),context:i,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!uc.test(f.parentNode.nodeName)?{ignore:!0}:null}})),c)l=hc(lo(l,+c[1],+c[2]),c[4]);else if(l=C.maxOpen(cc(l.content,i),!0),l.openStart||l.openEnd){let d=0,f=0;for(let h=l.content.firstChild;d<l.openStart&&!h.type.spec.isolating;d++,h=h.firstChild);for(let h=l.content.lastChild;f<l.openEnd&&!h.type.spec.isolating;f++,h=h.lastChild);l=lo(l,d,f)}return r.someProp("transformPasted",d=>{l=d(l,r)}),l}const uc=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function cc(r,e){if(r.childCount<2)return r;for(let t=e.depth;t>=0;t--){let i=e.node(t).contentMatchAt(e.index(t)),s,o=[];if(r.forEach(l=>{if(!o)return;let a=i.findWrapping(l.type),u;if(!a)return o=null;if(u=o.length&&s.length&&Fl(a,s,l,o[o.length-1],0))o[o.length-1]=u;else{o.length&&(o[o.length-1]=Bl(o[o.length-1],s.length));let c=Nl(l,a);o.push(c),i=i.matchType(c.type),s=a}}),o)return D.from(o)}return r}function Nl(r,e,t=0){for(let n=e.length-1;n>=t;n--)r=e[n].create(null,D.from(r));return r}function Fl(r,e,t,n,i){if(i<r.length&&i<e.length&&r[i]==e[i]){let s=Fl(r,e,t,n.lastChild,i+1);if(s)return n.copy(n.content.replaceChild(n.childCount-1,s));if(n.contentMatchAt(n.childCount).matchType(i==r.length-1?t.type:r[i+1]))return n.copy(n.content.append(D.from(Nl(t,r,i+1))))}}function Bl(r,e){if(e==0)return r;let t=r.content.replaceChild(r.childCount-1,Bl(r.lastChild,e-1)),n=r.contentMatchAt(r.childCount).fillBefore(D.empty,!0);return r.copy(t.append(n))}function Si(r,e,t,n,i,s){let o=e<0?r.firstChild:r.lastChild,l=o.content;return i<n-1&&(l=Si(l,e,t,n,i+1,s)),i>=t&&(l=e<0?o.contentMatchAt(0).fillBefore(l,r.childCount>1||s<=i).append(l):l.append(o.contentMatchAt(o.childCount).fillBefore(D.empty,!0))),r.replaceChild(e<0?0:r.childCount-1,o.copy(l))}function lo(r,e,t){return e<r.openStart&&(r=new C(Si(r.content,-1,e,r.openStart,0,r.openEnd),e,r.openEnd)),t<r.openEnd&&(r=new C(Si(r.content,1,t,r.openEnd,0,0),r.openStart,t)),r}const Il={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let ao=null;function Rl(){return ao||(ao=document.implementation.createHTMLDocument("title"))}function dc(r){let e=/^(\s*<meta [^>]*>)*/.exec(r);e&&(r=r.slice(e[0].length));let t=Rl().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(r),i;if((i=n&&Il[n[1].toLowerCase()])&&(r=i.map(s=>"<"+s+">").join("")+r+i.map(s=>"</"+s+">").reverse().join("")),t.innerHTML=r,i)for(let s=0;s<i.length;s++)t=t.querySelector(i[s])||t;return t}function fc(r){let e=r.querySelectorAll(he?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let n=e[t];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),n)}}function hc(r,e){if(!r.size)return r;let t=r.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return r}let{content:i,openStart:s,openEnd:o}=r;for(let l=n.length-2;l>=0;l-=2){let a=t.nodes[n[l]];if(!a||a.hasRequiredAttrs())break;i=D.from(a.create(n[l+1],i)),s++,o++}return new C(i,s,o)}const ce={},de={},pc={touchstart:!0,touchmove:!0};class mc{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function gc(r){for(let e in ce){let t=ce[e];r.dom.addEventListener(e,r.input.eventHandlers[e]=n=>{Dc(r,n)&&!_i(r,n)&&(r.editable||!(n.type in de))&&t(r,n)},pc[e]?{passive:!0}:void 0)}ue&&r.dom.addEventListener("input",()=>null),Ai(r)}function st(r,e){r.input.lastSelectionOrigin=e,r.input.lastSelectionTime=Date.now()}function yc(r){r.domObserver.stop();for(let e in r.input.eventHandlers)r.dom.removeEventListener(e,r.input.eventHandlers[e]);clearTimeout(r.input.composingTimeout),clearTimeout(r.input.lastIOSEnterFallbackTimeout)}function Ai(r){r.someProp("handleDOMEvents",e=>{for(let t in e)r.input.eventHandlers[t]||r.dom.addEventListener(t,r.input.eventHandlers[t]=n=>_i(r,n))})}function _i(r,e){return r.someProp("handleDOMEvents",t=>{let n=t[e.type];return n?n(r,e)||e.defaultPrevented:!1})}function Dc(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=r.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function bc(r,e){!_i(r,e)&&ce[e.type]&&(r.editable||!(e.type in de))&&ce[e.type](r,e)}de.keydown=(r,e)=>{let t=e;if(r.input.shiftKey=t.keyCode==16||t.shiftKey,!Ll(r,t)&&(r.input.lastKeyCode=t.keyCode,r.input.lastKeyCodeTime=Date.now(),!(Ve&&he&&t.keyCode==13)))if(t.keyCode!=229&&r.domObserver.forceFlush(),rn&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let n=Date.now();r.input.lastIOSEnter=n,r.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{r.input.lastIOSEnter==n&&(r.someProp("handleKeyDown",i=>i(r,jt(13,"Enter"))),r.input.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",n=>n(r,t))||ac(r,t)?t.preventDefault():st(r,"key")};de.keyup=(r,e)=>{e.keyCode==16&&(r.input.shiftKey=!1)};de.keypress=(r,e)=>{let t=e;if(Ll(r,t)||!t.charCode||t.ctrlKey&&!t.altKey||Se&&t.metaKey)return;if(r.someProp("handleKeyPress",i=>i(r,t))){t.preventDefault();return}let n=r.state.selection;if(!(n instanceof F)||!n.$from.sameParent(n.$to)){let i=String.fromCharCode(t.charCode);r.someProp("handleTextInput",s=>s(r,n.$from.pos,n.$to.pos,i))||r.dispatch(r.state.tr.insertText(i).scrollIntoView()),t.preventDefault()}};function Tr(r){return{left:r.clientX,top:r.clientY}}function kc(r,e){let t=e.x-r.clientX,n=e.y-r.clientY;return t*t+n*n<100}function Vi(r,e,t,n,i){if(n==-1)return!1;let s=r.state.doc.resolve(n);for(let o=s.depth+1;o>0;o--)if(r.someProp(e,l=>o>s.depth?l(r,t,s.nodeAfter,s.before(o),i,!0):l(r,t,s.node(o),s.before(o),i,!1)))return!0;return!1}function Zt(r,e,t){r.focused||r.focus();let n=r.state.tr.setSelection(e);t=="pointer"&&n.setMeta("pointer",!0),r.dispatch(n)}function Cc(r,e){if(e==-1)return!1;let t=r.state.doc.resolve(e),n=t.nodeAfter;return n&&n.isAtom&&M.isSelectable(n)?(Zt(r,new M(t),"pointer"),!0):!1}function Ec(r,e){if(e==-1)return!1;let t=r.state.selection,n,i;t instanceof M&&(n=t.node);let s=r.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let l=o>s.depth?s.nodeAfter:s.node(o);if(M.isSelectable(l)){n&&t.$from.depth>0&&o>=t.$from.depth&&s.before(t.$from.depth+1)==t.$from.pos?i=s.before(t.$from.depth):i=s.before(o);break}}return i!=null?(Zt(r,M.create(r.state.doc,i),"pointer"),!0):!1}function Sc(r,e,t,n,i){return Vi(r,"handleClickOn",e,t,n)||r.someProp("handleClick",s=>s(r,e,n))||(i?Ec(r,t):Cc(r,t))}function Ac(r,e,t,n){return Vi(r,"handleDoubleClickOn",e,t,n)||r.someProp("handleDoubleClick",i=>i(r,e,n))}function xc(r,e,t,n){return Vi(r,"handleTripleClickOn",e,t,n)||r.someProp("handleTripleClick",i=>i(r,e,n))||Mc(r,t,n)}function Mc(r,e,t){if(t.button!=0)return!1;let n=r.state.doc;if(e==-1)return n.inlineContent?(Zt(r,F.create(n,0,n.content.size),"pointer"),!0):!1;let i=n.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),l=i.before(s);if(o.inlineContent)Zt(r,F.create(n,l+1,l+1+o.content.size),"pointer");else if(M.isSelectable(o))Zt(r,M.create(n,l),"pointer");else continue;return!0}}function Hi(r){return Xn(r)}const Pl=Se?"metaKey":"ctrlKey";ce.mousedown=(r,e)=>{let t=e;r.input.shiftKey=t.shiftKey;let n=Hi(r),i=Date.now(),s="singleClick";i-r.input.lastClick.time<500&&kc(t,r.input.lastClick)&&!t[Pl]&&(r.input.lastClick.type=="singleClick"?s="doubleClick":r.input.lastClick.type=="doubleClick"&&(s="tripleClick")),r.input.lastClick={time:i,x:t.clientX,y:t.clientY,type:s};let o=r.posAtCoords(Tr(t));o&&(s=="singleClick"?(r.input.mouseDown&&r.input.mouseDown.done(),r.input.mouseDown=new wc(r,o,t,!!n)):(s=="doubleClick"?Ac:xc)(r,o.pos,o.inside,t)?t.preventDefault():st(r,"pointer"))};class wc{constructor(e,t,n,i){this.view=e,this.pos=t,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[Pl],this.allowDefault=n.shiftKey;let s,o;if(t.inside>-1)s=e.state.doc.nodeAt(t.inside),o=t.inside;else{let c=e.state.doc.resolve(t.pos);s=c.parent,o=c.depth?c.before():0}const l=i?null:n.target,a=l?e.docView.nearestDesc(l,!0):null;this.target=a?a.dom:null;let{selection:u}=e.state;(n.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||u instanceof M&&u.from<=o&&u.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Be&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),st(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Ye(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Tr(e))),this.updateAllowDefault(e),this.allowDefault||!t?st(this.view,"pointer"):Sc(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||ue&&this.mightDrag&&!this.mightDrag.node.isAtom||he&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Zt(this.view,O.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):st(this.view,"pointer")}move(e){this.updateAllowDefault(e),st(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}ce.touchstart=r=>{r.input.lastTouch=Date.now(),Hi(r),st(r,"pointer")};ce.touchmove=r=>{r.input.lastTouch=Date.now(),st(r,"pointer")};ce.contextmenu=r=>Hi(r);function Ll(r,e){return r.composing?!0:ue&&Math.abs(e.timeStamp-r.input.compositionEndedAt)<500?(r.input.compositionEndedAt=-2e8,!0):!1}const vc=Ve?5e3:-1;de.compositionstart=de.compositionupdate=r=>{if(!r.composing){r.domObserver.flush();let{state:e}=r,t=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)))r.markCursor=r.state.storedMarks||t.marks(),Xn(r,!0),r.markCursor=null;else if(Xn(r),Be&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let n=r.domSelectionRange();for(let i=n.focusNode,s=n.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){r.domSelection().collapse(o,o.nodeValue.length);break}else i=o,s=-1}}r.input.composing=!0}zl(r,vc)};de.compositionend=(r,e)=>{r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=e.timeStamp,zl(r,20))};function zl(r,e){clearTimeout(r.input.composingTimeout),e>-1&&(r.input.composingTimeout=setTimeout(()=>Xn(r),e))}function _l(r){for(r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=Tc());r.input.compositionNodes.length>0;)r.input.compositionNodes.pop().markParentsDirty()}function Tc(){let r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function Xn(r,e=!1){if(!(Ve&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),_l(r),e||r.docView&&r.docView.dirty){let t=Li(r);return t&&!t.eq(r.state.selection)?r.dispatch(r.state.tr.setSelection(t)):r.updateState(r.state),!0}return!1}}function Oc(r,e){if(!r.dom.parentNode)return;let t=r.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),i=document.createRange();i.selectNodeContents(e),r.dom.blur(),n.removeAllRanges(),n.addRange(i),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),r.focus()},50)}const sn=pe&&ot<15||rn&&Nu<604;ce.copy=de.cut=(r,e)=>{let t=e,n=r.state.selection,i=t.type=="cut";if(n.empty)return;let s=sn?null:t.clipboardData,o=n.content(),{dom:l,text:a}=Tl(r,o);s?(t.preventDefault(),s.clearData(),s.setData("text/html",l.innerHTML),s.setData("text/plain",a)):Oc(r,l),i&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Nc(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function Fc(r,e){if(!r.dom.parentNode)return;let t=r.input.shiftKey||r.state.selection.$from.parent.type.spec.code,n=r.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(()=>{r.focus(),n.parentNode&&n.parentNode.removeChild(n),t?xi(r,n.value,null,e):xi(r,n.textContent,n.innerHTML,e)},50)}function xi(r,e,t,n){let i=Ol(r,e,t,r.input.shiftKey,r.state.selection.$from);if(r.someProp("handlePaste",l=>l(r,n,i||C.empty)))return!0;if(!i)return!1;let s=Nc(i),o=s?r.state.tr.replaceSelectionWith(s,r.input.shiftKey):r.state.tr.replaceSelection(i);return r.dispatch(o.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}de.paste=(r,e)=>{let t=e;if(r.composing&&!Ve)return;let n=sn?null:t.clipboardData;n&&xi(r,n.getData("text/plain"),n.getData("text/html"),t)?t.preventDefault():Fc(r,t)};class Bc{constructor(e,t){this.slice=e,this.move=t}}const Vl=Se?"altKey":"ctrlKey";ce.dragstart=(r,e)=>{let t=e,n=r.input.mouseDown;if(n&&n.done(),!t.dataTransfer)return;let i=r.state.selection,s=i.empty?null:r.posAtCoords(Tr(t));if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof M?i.to-1:i.to))){if(n&&n.mightDrag)r.dispatch(r.state.tr.setSelection(M.create(r.state.doc,n.mightDrag.pos)));else if(t.target&&t.target.nodeType==1){let u=r.docView.nearestDesc(t.target,!0);u&&u.node.type.spec.draggable&&u!=r.docView&&r.dispatch(r.state.tr.setSelection(M.create(r.state.doc,u.posBefore)))}}let o=r.state.selection.content(),{dom:l,text:a}=Tl(r,o);t.dataTransfer.clearData(),t.dataTransfer.setData(sn?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",sn||t.dataTransfer.setData("text/plain",a),r.dragging=new Bc(o,!t[Vl])};ce.dragend=r=>{let e=r.dragging;window.setTimeout(()=>{r.dragging==e&&(r.dragging=null)},50)};de.dragover=de.dragenter=(r,e)=>e.preventDefault();de.drop=(r,e)=>{let t=e,n=r.dragging;if(r.dragging=null,!t.dataTransfer)return;let i=r.posAtCoords(Tr(t));if(!i)return;let s=r.state.doc.resolve(i.pos),o=n&&n.slice;o?r.someProp("transformPasted",p=>{o=p(o,r)}):o=Ol(r,t.dataTransfer.getData(sn?"Text":"text/plain"),sn?null:t.dataTransfer.getData("text/html"),!1,s);let l=!!(n&&!t[Vl]);if(r.someProp("handleDrop",p=>p(r,t,o||C.empty,l))){t.preventDefault();return}if(!o)return;t.preventDefault();let a=o?sl(r.state.doc,s.pos,o):s.pos;a==null&&(a=s.pos);let u=r.state.tr;l&&u.deleteSelection();let c=u.mapping.map(a),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=u.doc;if(d?u.replaceRangeWith(c,c,o.content.firstChild):u.replaceRange(c,c,o),u.doc.eq(f))return;let h=u.doc.resolve(c);if(d&&M.isSelectable(o.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(o.content.firstChild))u.setSelection(new M(h));else{let p=u.mapping.map(a);u.mapping.maps[u.mapping.maps.length-1].forEach((m,g,y,b)=>p=b),u.setSelection(zi(r,h,u.doc.resolve(p)))}r.focus(),r.dispatch(u.setMeta("uiEvent","drop"))};ce.focus=r=>{r.input.lastFocus=Date.now(),r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(()=>{r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.domSelectionRange())&&Ye(r)},20))};ce.blur=(r,e)=>{let t=e;r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),t.relatedTarget&&r.dom.contains(t.relatedTarget)&&r.domObserver.currentSelection.clear(),r.focused=!1)};ce.beforeinput=(r,e)=>{if(he&&Ve&&e.inputType=="deleteContentBackward"){r.domObserver.flushSoon();let{domChangeCount:n}=r.input;setTimeout(()=>{if(r.input.domChangeCount!=n||(r.dom.blur(),r.focus(),r.someProp("handleKeyDown",s=>s(r,jt(8,"Backspace")))))return;let{$cursor:i}=r.state.selection;i&&i.pos>0&&r.dispatch(r.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let r in de)ce[r]=de[r];function Tn(r,e){if(r==e)return!0;for(let t in r)if(r[t]!==e[t])return!1;for(let t in e)if(!(t in r))return!1;return!0}class ji{constructor(e,t){this.toDOM=e,this.spec=t||Tt,this.side=this.spec.side||0}map(e,t,n,i){let{pos:s,deleted:o}=e.mapResult(t.from+i,this.side<0?-1:1);return o?null:new xe(s-n,s-n,this)}valid(){return!0}eq(e){return this==e||e instanceof ji&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Tn(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class lt{constructor(e,t){this.attrs=e,this.spec=t||Tt}map(e,t,n,i){let s=e.map(t.from+i,this.spec.inclusiveStart?-1:1)-n,o=e.map(t.to+i,this.spec.inclusiveEnd?1:-1)-n;return s>=o?null:new xe(s,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof lt&&Tn(this.attrs,e.attrs)&&Tn(this.spec,e.spec)}static is(e){return e.type instanceof lt}destroy(){}}class $i{constructor(e,t){this.attrs=e,this.spec=t||Tt}map(e,t,n,i){let s=e.mapResult(t.from+i,1);if(s.deleted)return null;let o=e.mapResult(t.to+i,-1);return o.deleted||o.pos<=s.pos?null:new xe(s.pos-n,o.pos-n,this)}valid(e,t){let{index:n,offset:i}=e.content.findIndex(t.from),s;return i==t.from&&!(s=e.child(n)).isText&&i+s.nodeSize==t.to}eq(e){return this==e||e instanceof $i&&Tn(this.attrs,e.attrs)&&Tn(this.spec,e.spec)}destroy(){}}class xe{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new xe(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new xe(e,e,new ji(t,n))}static inline(e,t,n,i){return new xe(e,t,new lt(n,i))}static node(e,t,n,i){return new xe(e,t,new $i(n,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof lt}}const Vt=[],Tt={};class q{constructor(e,t){this.local=e.length?e:Vt,this.children=t.length?t:Vt}static create(e,t){return t.length?Zn(t,e,0,Tt):oe}find(e,t,n){let i=[];return this.findInner(e??0,t??1e9,i,0,n),i}findInner(e,t,n,i,s){for(let o=0;o<this.local.length;o++){let l=this.local[o];l.from<=t&&l.to>=e&&(!s||s(l.spec))&&n.push(l.copy(l.from+i,l.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let l=this.children[o]+1;this.children[o+2].findInner(e-l,t-l,n,i+l,s)}}map(e,t,n){return this==oe||e.maps.length==0?this:this.mapInner(e,t,0,0,n||Tt)}mapInner(e,t,n,i,s){let o;for(let l=0;l<this.local.length;l++){let a=this.local[l].map(e,n,i);a&&a.type.valid(t,a)?(o||(o=[])).push(a):s.onRemove&&s.onRemove(this.local[l].spec)}return this.children.length?Ic(this.children,o||[],e,t,n,i,s):o?new q(o.sort(Ot),Vt):oe}add(e,t){return t.length?this==oe?q.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let i,s=0;e.forEach((l,a)=>{let u=a+n,c;if(c=jl(t,l,u)){for(i||(i=this.children.slice());s<i.length&&i[s]<a;)s+=3;i[s]==a?i[s+2]=i[s+2].addInner(l,c,u+1):i.splice(s,0,a,a+l.nodeSize,Zn(c,l,u+1,Tt)),s+=3}});let o=Hl(s?$l(t):t,-n);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||o.splice(l--,1);return new q(o.length?this.local.concat(o).sort(Ot):this.local,i||this.children)}remove(e){return e.length==0||this==oe?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,i=this.local;for(let s=0;s<n.length;s+=3){let o,l=n[s]+t,a=n[s+1]+t;for(let c=0,d;c<e.length;c++)(d=e[c])&&d.from>l&&d.to<a&&(e[c]=null,(o||(o=[])).push(d));if(!o)continue;n==this.children&&(n=this.children.slice());let u=n[s+2].removeInner(o,l+1);u!=oe?n[s+2]=u:(n.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let l=0;l<i.length;l++)i[l].eq(o,t)&&(i==this.local&&(i=this.local.slice()),i.splice(l--,1))}return n==this.children&&i==this.local?this:i.length||n.length?new q(i,n):oe}forChild(e,t){if(this==oe)return this;if(t.isLeaf)return q.empty;let n,i;for(let l=0;l<this.children.length;l+=3)if(this.children[l]>=e){this.children[l]==e&&(n=this.children[l+2]);break}let s=e+1,o=s+t.content.size;for(let l=0;l<this.local.length;l++){let a=this.local[l];if(a.from<o&&a.to>s&&a.type instanceof lt){let u=Math.max(s,a.from)-s,c=Math.min(o,a.to)-s;u<c&&(i||(i=[])).push(a.copy(u,c))}}if(i){let l=new q(i.sort(Ot),Vt);return n?new nt([l,n]):l}return n||oe}eq(e){if(this==e)return!0;if(!(e instanceof q)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Ki(this.localsInner(e))}localsInner(e){if(this==oe)return Vt;if(e.inlineContent||!this.local.some(lt.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof lt||t.push(this.local[n]);return t}}q.empty=new q([],[]);q.removeOverlap=Ki;const oe=q.empty;class nt{constructor(e){this.members=e}map(e,t){const n=this.members.map(i=>i.map(e,t,Tt));return nt.from(n)}forChild(e,t){if(t.isLeaf)return q.empty;let n=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,t);s!=oe&&(s instanceof nt?n=n.concat(s.members):n.push(s))}return nt.from(n)}eq(e){if(!(e instanceof nt)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!t)t=s;else{n&&(t=t.slice(),n=!1);for(let o=0;o<s.length;o++)t.push(s[o])}}return t?Ki(n?t:t.sort(Ot)):Vt}static from(e){switch(e.length){case 0:return oe;case 1:return e[0];default:return new nt(e.every(t=>t instanceof q)?e:e.reduce((t,n)=>t.concat(n instanceof q?n:n.members),[]))}}}function Ic(r,e,t,n,i,s,o){let l=r.slice();for(let u=0,c=s;u<t.maps.length;u++){let d=0;t.maps[u].forEach((f,h,p,m)=>{let g=m-p-(h-f);for(let y=0;y<l.length;y+=3){let b=l[y+1];if(b<0||f>b+c-d)continue;let x=l[y]+c-d;h>=x?l[y+1]=f<=x?-2:-1:p>=i&&g&&(l[y]+=g,l[y+1]+=g)}d+=g}),c=t.maps[u].map(c,-1)}let a=!1;for(let u=0;u<l.length;u+=3)if(l[u+1]<0){if(l[u+1]==-2){a=!0,l[u+1]=-1;continue}let c=t.map(r[u]+s),d=c-i;if(d<0||d>=n.content.size){a=!0;continue}let f=t.map(r[u+1]+s,-1),h=f-i,{index:p,offset:m}=n.content.findIndex(d),g=n.maybeChild(p);if(g&&m==d&&m+g.nodeSize==h){let y=l[u+2].mapInner(t,g,c+1,r[u]+s+1,o);y!=oe?(l[u]=d,l[u+1]=h,l[u+2]=y):(l[u+1]=-2,a=!0)}else a=!0}if(a){let u=Rc(l,r,e,t,i,s,o),c=Zn(u,n,0,o);e=c.local;for(let d=0;d<l.length;d+=3)l[d+1]<0&&(l.splice(d,3),d-=3);for(let d=0,f=0;d<c.children.length;d+=3){let h=c.children[d];for(;f<l.length&&l[f]<h;)f+=3;l.splice(f,0,c.children[d],c.children[d+1],c.children[d+2])}}return new q(e.sort(Ot),l)}function Hl(r,e){if(!e||!r.length)return r;let t=[];for(let n=0;n<r.length;n++){let i=r[n];t.push(new xe(i.from+e,i.to+e,i.type))}return t}function Rc(r,e,t,n,i,s,o){function l(a,u){for(let c=0;c<a.local.length;c++){let d=a.local[c].map(n,i,u);d?t.push(d):o.onRemove&&o.onRemove(a.local[c].spec)}for(let c=0;c<a.children.length;c+=3)l(a.children[c+2],a.children[c]+u+1)}for(let a=0;a<r.length;a+=3)r[a+1]==-1&&l(r[a+2],e[a]+s+1);return t}function jl(r,e,t){if(e.isLeaf)return null;let n=t+e.nodeSize,i=null;for(let s=0,o;s<r.length;s++)(o=r[s])&&o.from>t&&o.to<n&&((i||(i=[])).push(o),r[s]=null);return i}function $l(r){let e=[];for(let t=0;t<r.length;t++)r[t]!=null&&e.push(r[t]);return e}function Zn(r,e,t,n){let i=[],s=!1;e.forEach((l,a)=>{let u=jl(r,l,a+t);if(u){s=!0;let c=Zn(u,l,t+a+1,n);c!=oe&&i.push(a,a+l.nodeSize,c)}});let o=Hl(s?$l(r):r,-t).sort(Ot);for(let l=0;l<o.length;l++)o[l].type.valid(e,o[l])||(n.onRemove&&n.onRemove(o[l].spec),o.splice(l--,1));return o.length||i.length?new q(o,i):oe}function Ot(r,e){return r.from-e.from||r.to-e.to}function Ki(r){let e=r;for(let t=0;t<e.length-1;t++){let n=e[t];if(n.from!=n.to)for(let i=t+1;i<e.length;i++){let s=e[i];if(s.from==n.from){s.to!=n.to&&(e==r&&(e=r.slice()),e[i]=s.copy(s.from,n.to),uo(e,i+1,s.copy(n.to,s.to)));continue}else{s.from<n.to&&(e==r&&(e=r.slice()),e[t]=n.copy(n.from,s.from),uo(e,i,n.copy(s.from,n.to)));break}}}return e}function uo(r,e,t){for(;e<r.length&&Ot(t,r[e])>0;)e++;r.splice(e,0,t)}function ei(r){let e=[];return r.someProp("decorations",t=>{let n=t(r.state);n&&n!=oe&&e.push(n)}),r.cursorWrapper&&e.push(q.create(r.state.doc,[r.cursorWrapper.deco])),nt.from(e)}const Pc={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Lc=pe&&ot<=11;class zc{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class _c{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new zc,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let i=0;i<n.length;i++)this.queue.push(n[i]);pe&&ot<=11&&n.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),Lc&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Pc)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(no(this.view)){if(this.suppressingSelectionUpdates)return Ye(this.view);if(pe&&ot<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Ft(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,n;for(let s=e.focusNode;s;s=vn(s))t.add(s);for(let s=e.anchorNode;s;s=vn(s))if(t.has(s)){n=s;break}let i=n&&this.view.docView.nearestDesc(n);if(i&&i.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);let n=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&no(e)&&!this.ignoreSelectionChange(n),s=-1,o=-1,l=!1,a=[];if(e.editable)for(let c=0;c<t.length;c++){let d=this.registerMutation(t[c],a);d&&(s=s<0?d.from:Math.min(d.from,s),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(l=!0))}if(Be&&a.length>1){let c=a.filter(d=>d.nodeName=="BR");if(c.length==2){let d=c[0],f=c[1];d.parentNode&&d.parentNode.parentNode==f.parentNode?f.remove():d.remove()}}let u=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&e.input.lastTouch<Date.now()-300&&Mr(n)&&(u=Li(e))&&u.eq(O.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Ye(e),this.currentSelection.set(n),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),Vc(e)),this.handleDOMChange(s,o,l,a),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||Ye(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let c=0;c<e.addedNodes.length;c++)t.push(e.addedNodes[c]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let i=e.previousSibling,s=e.nextSibling;if(pe&&ot<=11&&e.addedNodes.length)for(let c=0;c<e.addedNodes.length;c++){let{previousSibling:d,nextSibling:f}=e.addedNodes[c];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f)}let o=i&&i.parentNode==e.target?be(i)+1:0,l=n.localPosFromDOM(e.target,o,-1),a=s&&s.parentNode==e.target?be(s):e.target.childNodes.length,u=n.localPosFromDOM(e.target,a,1);return{from:l,to:u}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let co=new WeakMap,fo=!1;function Vc(r){if(!co.has(r)&&(co.set(r,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(r.dom).whiteSpace)!==-1)){if(r.requiresGeckoHackNode=Be,fo)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),fo=!0}}function Hc(r){let e;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}r.dom.addEventListener("beforeinput",t,!0),document.execCommand("indent"),r.dom.removeEventListener("beforeinput",t,!0);let n=e.startContainer,i=e.startOffset,s=e.endContainer,o=e.endOffset,l=r.domAtPos(r.state.selection.anchor);return Ft(l.node,l.offset,s,o)&&([n,i,s,o]=[s,o,n,i]),{anchorNode:n,anchorOffset:i,focusNode:s,focusOffset:o}}function jc(r,e,t){let{node:n,fromOffset:i,toOffset:s,from:o,to:l}=r.docView.parseRange(e,t),a=r.domSelectionRange(),u,c=a.anchorNode;if(c&&r.dom.contains(c.nodeType==1?c:c.parentNode)&&(u=[{node:c,offset:a.anchorOffset}],Mr(a)||u.push({node:a.focusNode,offset:a.focusOffset})),he&&r.input.lastKeyCode===8)for(let g=s;g>i;g--){let y=n.childNodes[g-1],b=y.pmViewDesc;if(y.nodeName=="BR"&&!b){s=g;break}if(!b||b.size)break}let d=r.state.doc,f=r.someProp("domParser")||en.fromSchema(r.state.schema),h=d.resolve(o),p=null,m=f.parse(n,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:i,to:s,preserveWhitespace:h.parent.type.whitespace=="pre"?"full":!0,findPositions:u,ruleFromNode:$c,context:h});if(u&&u[0].pos!=null){let g=u[0].pos,y=u[1]&&u[1].pos;y==null&&(y=g),p={anchor:g+o,head:y+o}}return{doc:m,sel:p,from:o,to:l}}function $c(r){let e=r.pmViewDesc;if(e)return e.parseRule();if(r.nodeName=="BR"&&r.parentNode){if(ue&&/^(ul|ol)$/i.test(r.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(r.parentNode.lastChild==r||ue&&/^(tr|table)$/i.test(r.parentNode.nodeName))return{ignore:!0}}else if(r.nodeName=="IMG"&&r.getAttribute("mark-placeholder"))return{ignore:!0};return null}function Kc(r,e,t,n,i){if(e<0){let S=r.input.lastSelectionTime>Date.now()-50?r.input.lastSelectionOrigin:null,$=Li(r,S);if($&&!r.state.selection.eq($)){let Me=r.state.tr.setSelection($);S=="pointer"?Me.setMeta("pointer",!0):S=="key"&&Me.scrollIntoView(),r.dispatch(Me)}return}let s=r.state.doc.resolve(e),o=s.sharedDepth(t);e=s.before(o+1),t=r.state.doc.resolve(t).after(o+1);let l=r.state.selection,a=jc(r,e,t),u=r.state.doc,c=u.slice(a.from,a.to),d,f;r.input.lastKeyCode===8&&Date.now()-100<r.input.lastKeyCodeTime?(d=r.state.selection.to,f="end"):(d=r.state.selection.from,f="start"),r.input.lastKeyCode=null;let h=qc(c.content,a.doc.content,a.from,d,f);if((rn&&r.input.lastIOSEnter>Date.now()-225||Ve)&&i.some(S=>S.nodeName=="DIV"||S.nodeName=="P"||S.nodeName=="LI")&&(!h||h.endA>=h.endB)&&r.someProp("handleKeyDown",S=>S(r,jt(13,"Enter")))){r.input.lastIOSEnter=0;return}if(!h)if(n&&l instanceof F&&!l.empty&&l.$head.sameParent(l.$anchor)&&!r.composing&&!(a.sel&&a.sel.anchor!=a.sel.head))h={start:l.from,endA:l.to,endB:l.to};else{if(a.sel){let S=ho(r,r.state.doc,a.sel);S&&!S.eq(r.state.selection)&&r.dispatch(r.state.tr.setSelection(S))}return}if(he&&r.cursorWrapper&&a.sel&&a.sel.anchor==r.cursorWrapper.deco.from&&a.sel.head==a.sel.anchor){let S=h.endB-h.start;a.sel={anchor:a.sel.anchor+S,head:a.sel.anchor+S}}r.input.domChangeCount++,r.state.selection.from<r.state.selection.to&&h.start==h.endB&&r.state.selection instanceof F&&(h.start>r.state.selection.from&&h.start<=r.state.selection.from+2&&r.state.selection.from>=a.from?h.start=r.state.selection.from:h.endA<r.state.selection.to&&h.endA>=r.state.selection.to-2&&r.state.selection.to<=a.to&&(h.endB+=r.state.selection.to-h.endA,h.endA=r.state.selection.to)),pe&&ot<=11&&h.endB==h.start+1&&h.endA==h.start&&h.start>a.from&&a.doc.textBetween(h.start-a.from-1,h.start-a.from+1)==" "&&(h.start--,h.endA--,h.endB--);let p=a.doc.resolveNoCache(h.start-a.from),m=a.doc.resolveNoCache(h.endB-a.from),g=u.resolve(h.start),y=p.sameParent(m)&&p.parent.inlineContent&&g.end()>=h.endA,b;if((rn&&r.input.lastIOSEnter>Date.now()-225&&(!y||i.some(S=>S.nodeName=="DIV"||S.nodeName=="P"))||!y&&p.pos<a.doc.content.size&&(b=O.findFrom(a.doc.resolve(p.pos+1),1,!0))&&b.head==m.pos)&&r.someProp("handleKeyDown",S=>S(r,jt(13,"Enter")))){r.input.lastIOSEnter=0;return}if(r.state.selection.anchor>h.start&&Jc(u,h.start,h.endA,p,m)&&r.someProp("handleKeyDown",S=>S(r,jt(8,"Backspace")))){Ve&&he&&r.domObserver.suppressSelectionUpdates();return}he&&Ve&&h.endB==h.start&&(r.input.lastAndroidDelete=Date.now()),Ve&&!y&&p.start()!=m.start()&&m.parentOffset==0&&p.depth==m.depth&&a.sel&&a.sel.anchor==a.sel.head&&a.sel.head==h.endA&&(h.endB-=2,m=a.doc.resolveNoCache(h.endB-a.from),setTimeout(()=>{r.someProp("handleKeyDown",function(S){return S(r,jt(13,"Enter"))})},20));let x=h.start,w=h.endA,I,J,H;if(y){if(p.pos==m.pos)pe&&ot<=11&&p.parentOffset==0&&(r.domObserver.suppressSelectionUpdates(),setTimeout(()=>Ye(r),20)),I=r.state.tr.delete(x,w),J=u.resolve(h.start).marksAcross(u.resolve(h.endA));else if(h.endA==h.endB&&(H=Wc(p.parent.content.cut(p.parentOffset,m.parentOffset),g.parent.content.cut(g.parentOffset,h.endA-g.start()))))I=r.state.tr,H.type=="add"?I.addMark(x,w,H.mark):I.removeMark(x,w,H.mark);else if(p.parent.child(p.index()).isText&&p.index()==m.index()-(m.textOffset?0:1)){let S=p.parent.textBetween(p.parentOffset,m.parentOffset);if(r.someProp("handleTextInput",$=>$(r,x,w,S)))return;I=r.state.tr.insertText(S,x,w)}}if(I||(I=r.state.tr.replace(x,w,a.doc.slice(h.start-a.from,h.endB-a.from))),a.sel){let S=ho(r,I.doc,a.sel);S&&!(he&&Ve&&r.composing&&S.empty&&(h.start!=h.endB||r.input.lastAndroidDelete<Date.now()-100)&&(S.head==x||S.head==I.mapping.map(w)-1)||pe&&S.empty&&S.head==x)&&I.setSelection(S)}J&&I.ensureMarks(J),r.dispatch(I.scrollIntoView())}function ho(r,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:zi(r,e.resolve(t.anchor),e.resolve(t.head))}function Wc(r,e){let t=r.firstChild.marks,n=e.firstChild.marks,i=t,s=n,o,l,a;for(let c=0;c<n.length;c++)i=n[c].removeFromSet(i);for(let c=0;c<t.length;c++)s=t[c].removeFromSet(s);if(i.length==1&&s.length==0)l=i[0],o="add",a=c=>c.mark(l.addToSet(c.marks));else if(i.length==0&&s.length==1)l=s[0],o="remove",a=c=>c.mark(l.removeFromSet(c.marks));else return null;let u=[];for(let c=0;c<e.childCount;c++)u.push(a(e.child(c)));if(D.from(u).eq(r))return{mark:l,type:o}}function Jc(r,e,t,n,i){if(!n.parent.isTextblock||t-e<=i.pos-n.pos||ti(n,!0,!1)<i.pos)return!1;let s=r.resolve(e);if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=r.resolve(ti(s,!0,!0));return!o.parent.isTextblock||o.pos>t||ti(o,!0,!1)<t?!1:n.parent.content.cut(n.parentOffset).eq(o.parent.content)}function ti(r,e,t){let n=r.depth,i=e?r.end():r.pos;for(;n>0&&(e||r.indexAfter(n)==r.node(n).childCount);)n--,i++,e=!1;if(t){let s=r.node(n).maybeChild(r.indexAfter(n));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function qc(r,e,t,n,i){let s=r.findDiffStart(e,t);if(s==null)return null;let{a:o,b:l}=r.findDiffEnd(e,t+r.size,t+e.size);if(i=="end"){let a=Math.max(0,s-Math.min(o,l));n-=o+a-s}if(o<s&&r.size<e.size){let a=n<=s&&n>=o?s-n:0;s-=a,l=s+(l-o),o=s}else if(l<s){let a=n<=s&&n>=l?s-n:0;s-=a,o=s+(o-l),l=s}return{start:s,endA:o,endB:l}}class Uc{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new mc,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(Do),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=go(this),mo(this),this.nodeViews=yo(this),this.docView=Ys(this.state.doc,po(this),ei(this),this.dom,this),this.domObserver=new _c(this,(n,i,s,o)=>Kc(this,n,i,s,o)),this.domObserver.start(),gc(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Ai(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Do),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let n in this._props)t[n]=this._props[n];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){let n=this.state,i=!1,s=!1;e.storedMarks&&this.composing&&(_l(this),s=!0),this.state=e;let o=n.plugins!=e.plugins||this._props.plugins!=t.plugins;if(o||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let f=yo(this);Yc(f,this.nodeViews)&&(this.nodeViews=f,i=!0)}(o||t.handleDOMEvents!=this._props.handleDOMEvents)&&Ai(this),this.editable=go(this),mo(this);let l=ei(this),a=po(this),u=n.plugins!=e.plugins&&!n.doc.eq(e.doc)?"reset":e.scrollToSelection>n.scrollToSelection?"to selection":"preserve",c=i||!this.docView.matchesNode(e.doc,a,l);(c||!e.selection.eq(n.selection))&&(s=!0);let d=u=="preserve"&&s&&this.dom.style.overflowAnchor==null&&Iu(this);if(s){this.domObserver.stop();let f=c&&(pe||he)&&!this.composing&&!n.selection.empty&&!e.selection.empty&&Gc(n.selection,e.selection);if(c){let h=he?this.trackWrites=this.domSelectionRange().focusNode:null;(i||!this.docView.update(e.doc,a,l,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=Ys(e.doc,a,l,this.dom,this)),h&&!this.trackWrites&&(f=!0)}f||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&sc(this))?Ye(this,f):(Ml(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():d&&Ru(d)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof M){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&Ws(this,t.getBoundingClientRect(),e)}else Ws(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let n=this.directPlugins[t];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let n=this.state.plugins[t];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}}someProp(e,t){let n=this._props&&this._props[e],i;if(n!=null&&(i=t?t(n):n))return i;for(let o=0;o<this.directPlugins.length;o++){let l=this.directPlugins[o].props[e];if(l!=null&&(i=t?t(l):l))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let l=s[o].props[e];if(l!=null&&(i=t?t(l):l))return i}}hasFocus(){if(pe){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Pu(this.dom),Ye(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}posAtCoords(e){return Hu(this,e)}coordsAtPos(e,t=1){return Dl(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let i=this.docView.posFromDOM(e,t,n);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,t){return Ju(this,t||this.state,e)}destroy(){this.docView&&(yc(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],ei(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return this.docView==null}dispatchEvent(e){return bc(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){return ue&&this.root.nodeType===11&&Tu(this.dom.ownerDocument)==this.dom?Hc(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function po(r){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(r.editable),e.translate="no",r.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(r.state)),t)for(let n in t)n=="class"&&(e.class+=" "+t[n]),n=="style"?e.style=(e.style?e.style+";":"")+t[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(t[n]))}),[xe.node(0,r.state.doc.content.size,e)]}function mo(r){if(r.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),r.cursorWrapper={dom:e,deco:xe.widget(r.state.selection.head,e,{raw:!0,marks:r.markCursor})}}else r.cursorWrapper=null}function go(r){return!r.someProp("editable",e=>e(r.state)===!1)}function Gc(r,e){let t=Math.min(r.$anchor.sharedDepth(r.head),e.$anchor.sharedDepth(e.head));return r.$anchor.start(t)!=e.$anchor.start(t)}function yo(r){let e=Object.create(null);function t(n){for(let i in n)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=n[i])}return r.someProp("nodeViews",t),r.someProp("markViews",t),e}function Yc(r,e){let t=0,n=0;for(let i in r){if(r[i]!=e[i])return!0;t++}for(let i in e)n++;return t!=n}function Do(r){if(r.spec.state||r.spec.filterTransaction||r.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var ct={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},er={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},bo=typeof navigator<"u"&&/Chrome\/(\d+)/.exec(navigator.userAgent),Qc=typeof navigator<"u"&&/Mac/.test(navigator.platform),Xc=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Zc=Qc||bo&&+bo[1]<57;for(var te=0;te<10;te++)ct[48+te]=ct[96+te]=String(te);for(var te=1;te<=24;te++)ct[te+111]="F"+te;for(var te=65;te<=90;te++)ct[te]=String.fromCharCode(te+32),er[te]=String.fromCharCode(te);for(var ni in ct)er.hasOwnProperty(ni)||(er[ni]=ct[ni]);function ed(r){var e=Zc&&(r.ctrlKey||r.altKey||r.metaKey)||Xc&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",t=!e&&r.key||(r.shiftKey?er:ct)[r.keyCode]||r.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const td=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function nd(r){let e=r.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let n,i,s,o;for(let l=0;l<e.length-1;l++){let a=e[l];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))i=!0;else if(/^s(hift)?$/i.test(a))s=!0;else if(/^mod$/i.test(a))td?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+a)}return n&&(t="Alt-"+t),i&&(t="Ctrl-"+t),o&&(t="Meta-"+t),s&&(t="Shift-"+t),t}function rd(r){let e=Object.create(null);for(let t in r)e[nd(t)]=r[t];return e}function ri(r,e,t){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),t!==!1&&e.shiftKey&&(r="Shift-"+r),r}function id(r){return new fe({props:{handleKeyDown:Kl(r)}})}function Kl(r){let e=rd(r);return function(t,n){let i=ed(n),s=i.length==1&&i!=" ",o,l=e[ri(i,n,!s)];if(l&&l(t.state,t.dispatch,t))return!0;if(s&&(n.shiftKey||n.altKey||n.metaKey||i.charCodeAt(0)>127)&&(o=ct[n.keyCode])&&o!=i){let a=e[ri(o,n,!0)];if(a&&a(t.state,t.dispatch,t))return!0}else if(s&&n.shiftKey){let a=e[ri(i,n,!0)];if(a&&a(t.state,t.dispatch,t))return!0}return!1}}const sd=(r,e)=>r.selection.empty?!1:(e&&e(r.tr.deleteSelection().scrollIntoView()),!0);function od(r,e){let{$cursor:t}=r.selection;return!t||(e?!e.endOfTextblock("backward",r):t.parentOffset>0)?null:t}const ld=(r,e,t)=>{let n=od(r,t);if(!n)return!1;let i=Wl(n);if(!i){let o=n.blockRange(),l=o&&un(o);return l==null?!1:(e&&e(r.tr.lift(o,l).scrollIntoView()),!0)}let s=i.nodeBefore;if(!s.type.spec.isolating&&Ul(r,i,e))return!0;if(n.parent.content.size==0&&(on(s,"end")||M.isSelectable(s))){let o=Ii(r.doc,n.before(),n.after(),C.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=r.tr.step(o);l.setSelection(on(s,"end")?O.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):M.create(l.doc,i.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}}return s.isAtom&&i.depth==n.depth-1?(e&&e(r.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1};function on(r,e,t=!1){for(let n=r;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(t&&n.childCount!=1)return!1}return!1}const ad=(r,e,t)=>{let{$head:n,empty:i}=r.selection,s=n;if(!i)return!1;if(n.parent.isTextblock){if(t?!t.endOfTextblock("backward",r):n.parentOffset>0)return!1;s=Wl(n)}let o=s&&s.nodeBefore;return!o||!M.isSelectable(o)?!1:(e&&e(r.tr.setSelection(M.create(r.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function Wl(r){if(!r.parent.type.spec.isolating)for(let e=r.depth-1;e>=0;e--){if(r.index(e)>0)return r.doc.resolve(r.before(e+1));if(r.node(e).type.spec.isolating)break}return null}function ud(r,e){let{$cursor:t}=r.selection;return!t||(e?!e.endOfTextblock("forward",r):t.parentOffset<t.parent.content.size)?null:t}const cd=(r,e,t)=>{let n=ud(r,t);if(!n)return!1;let i=Jl(n);if(!i)return!1;let s=i.nodeAfter;if(Ul(r,i,e))return!0;if(n.parent.content.size==0&&(on(s,"start")||M.isSelectable(s))){let o=Ii(r.doc,n.before(),n.after(),C.empty);if(o&&o.slice.size<o.to-o.from){if(e){let l=r.tr.step(o);l.setSelection(on(s,"start")?O.findFrom(l.doc.resolve(l.mapping.map(i.pos)),1):M.create(l.doc,l.mapping.map(i.pos))),e(l.scrollIntoView())}return!0}}return s.isAtom&&i.depth==n.depth-1?(e&&e(r.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},dd=(r,e,t)=>{let{$head:n,empty:i}=r.selection,s=n;if(!i)return!1;if(n.parent.isTextblock){if(t?!t.endOfTextblock("forward",r):n.parentOffset<n.parent.content.size)return!1;s=Jl(n)}let o=s&&s.nodeAfter;return!o||!M.isSelectable(o)?!1:(e&&e(r.tr.setSelection(M.create(r.doc,s.pos)).scrollIntoView()),!0)};function Jl(r){if(!r.parent.type.spec.isolating)for(let e=r.depth-1;e>=0;e--){let t=r.node(e);if(r.index(e)+1<t.childCount)return r.doc.resolve(r.after(e+1));if(t.type.spec.isolating)break}return null}const fd=(r,e)=>{let t=r.selection,n=t instanceof M,i;if(n){if(t.node.isTextblock||!dt(r.doc,t.from))return!1;i=t.from}else if(i=il(r.doc,t.from,-1),i==null)return!1;if(e){let s=r.tr.join(i);n&&s.setSelection(M.create(s.doc,i-r.doc.resolve(i).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},hd=(r,e)=>{let t=r.selection,n;if(t instanceof M){if(t.node.isTextblock||!dt(r.doc,t.to))return!1;n=t.to}else if(n=il(r.doc,t.to,1),n==null)return!1;return e&&e(r.tr.join(n).scrollIntoView()),!0},pd=(r,e)=>{let{$from:t,$to:n}=r.selection,i=t.blockRange(n),s=i&&un(i);return s==null?!1:(e&&e(r.tr.lift(i,s).scrollIntoView()),!0)},md=(r,e)=>{let{$head:t,$anchor:n}=r.selection;return!t.parent.type.spec.code||!t.sameParent(n)?!1:(e&&e(r.tr.insertText(`
`).scrollIntoView()),!0)};function ql(r){for(let e=0;e<r.edgeCount;e++){let{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const gd=(r,e)=>{let{$head:t,$anchor:n}=r.selection;if(!t.parent.type.spec.code||!t.sameParent(n))return!1;let i=t.node(-1),s=t.indexAfter(-1),o=ql(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let l=t.after(),a=r.tr.replaceWith(l,l,o.createAndFill());a.setSelection(O.near(a.doc.resolve(l),1)),e(a.scrollIntoView())}return!0},yd=(r,e)=>{let t=r.selection,{$from:n,$to:i}=t;if(t instanceof Ne||n.parent.inlineContent||i.parent.inlineContent)return!1;let s=ql(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!n.parentOffset&&i.index()<i.parent.childCount?n:i).pos,l=r.tr.insert(o,s.createAndFill());l.setSelection(F.create(l.doc,o+1)),e(l.scrollIntoView())}return!0},Dd=(r,e)=>{let{$cursor:t}=r.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let s=t.before();if(Qt(r.doc,s))return e&&e(r.tr.split(s).scrollIntoView()),!0}let n=t.blockRange(),i=n&&un(n);return i==null?!1:(e&&e(r.tr.lift(n,i).scrollIntoView()),!0)},bd=(r,e)=>{let{$from:t,to:n}=r.selection,i,s=t.sharedDepth(n);return s==0?!1:(i=t.before(s),e&&e(r.tr.setSelection(M.create(r.doc,i))),!0)};function kd(r,e,t){let n=e.nodeBefore,i=e.nodeAfter,s=e.index();return!n||!i||!n.type.compatibleContent(i.type)?!1:!n.content.size&&e.parent.canReplace(s-1,s)?(t&&t(r.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||dt(r.doc,e.pos))?!1:(t&&t(r.tr.clearIncompatible(e.pos,n.type,n.contentMatchAt(n.childCount)).join(e.pos).scrollIntoView()),!0)}function Ul(r,e,t){let n=e.nodeBefore,i=e.nodeAfter,s,o;if(n.type.spec.isolating||i.type.spec.isolating)return!1;if(kd(r,e,t))return!0;let l=e.parent.canReplace(e.index(),e.index()+1);if(l&&(s=(o=n.contentMatchAt(n.childCount)).findWrapping(i.type))&&o.matchType(s[0]||i.type).validEnd){if(t){let d=e.pos+i.nodeSize,f=D.empty;for(let m=s.length-1;m>=0;m--)f=D.from(s[m].create(null,f));f=D.from(n.copy(f));let h=r.tr.step(new Q(e.pos-1,d,e.pos,d,new C(f,1,0),s.length,!0)),p=d+2*s.length;dt(h.doc,p)&&h.join(p),t(h.scrollIntoView())}return!0}let a=O.findFrom(e,1),u=a&&a.$from.blockRange(a.$to),c=u&&un(u);if(c!=null&&c>=e.depth)return t&&t(r.tr.lift(u,c).scrollIntoView()),!0;if(l&&on(i,"start",!0)&&on(n,"end")){let d=n,f=[];for(;f.push(d),!d.isTextblock;)d=d.lastChild;let h=i,p=1;for(;!h.isTextblock;h=h.firstChild)p++;if(d.canReplace(d.childCount,d.childCount,h.content)){if(t){let m=D.empty;for(let y=f.length-1;y>=0;y--)m=D.from(f[y].copy(m));let g=r.tr.step(new Q(e.pos-f.length,e.pos+i.nodeSize,e.pos+p,e.pos+i.nodeSize-p,new C(m,f.length,0),0,!0));t(g.scrollIntoView())}return!0}}return!1}function Gl(r){return function(e,t){let n=e.selection,i=r<0?n.$from:n.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(t&&t(e.tr.setSelection(F.create(e.doc,r<0?i.start(s):i.end(s)))),!0):!1}}const Cd=Gl(-1),Ed=Gl(1);function Sd(r,e=null){return function(t,n){let{$from:i,$to:s}=t.selection,o=i.blockRange(s),l=o&&Bi(o,r,e);return l?(n&&n(t.tr.wrap(o,l).scrollIntoView()),!0):!1}}function ko(r,e=null){return function(t,n){let i=!1;for(let s=0;s<t.selection.ranges.length&&!i;s++){let{$from:{pos:o},$to:{pos:l}}=t.selection.ranges[s];t.doc.nodesBetween(o,l,(a,u)=>{if(i)return!1;if(!(!a.isTextblock||a.hasMarkup(r,e)))if(a.type==r)i=!0;else{let c=t.doc.resolve(u),d=c.index();i=c.parent.canReplaceWith(d,d+1,r)}})}if(!i)return!1;if(n){let s=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:l},$to:{pos:a}}=t.selection.ranges[o];s.setBlockType(l,a,r,e)}n(s.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function Ad(r,e=null){return function(t,n){let{$from:i,$to:s}=t.selection,o=i.blockRange(s),l=!1,a=o;if(!o)return!1;if(o.depth>=2&&i.node(o.depth-1).type.compatibleContent(r)&&o.startIndex==0){if(i.index(o.depth-1)==0)return!1;let c=t.doc.resolve(o.start-2);a=new qn(c,c,o.depth),o.endIndex<o.parent.childCount&&(o=new qn(i,t.doc.resolve(s.end(o.depth)),o.depth)),l=!0}let u=Bi(a,r,e,o);return u?(n&&n(xd(t.tr,o,u,l,r).scrollIntoView()),!0):!1}}function xd(r,e,t,n,i){let s=D.empty;for(let c=t.length-1;c>=0;c--)s=D.from(t[c].type.create(t[c].attrs,s));r.step(new Q(e.start-(n?2:0),e.end,e.start,e.end,new C(s,0,0),t.length,!0));let o=0;for(let c=0;c<t.length;c++)t[c].type==i&&(o=c+1);let l=t.length-o,a=e.start+t.length-(n?2:0),u=e.parent;for(let c=e.startIndex,d=e.endIndex,f=!0;c<d;c++,f=!1)!f&&Qt(r.doc,a,l)&&(r.split(a,l),a+=2*l),a+=u.child(c).nodeSize;return r}function Md(r){return function(e,t){let{$from:n,$to:i}=e.selection,s=n.blockRange(i,o=>o.childCount>0&&o.firstChild.type==r);return s?t?n.node(s.depth-1).type==r?wd(e,t,r,s):vd(e,t,s):!0:!1}}function wd(r,e,t,n){let i=r.tr,s=n.end,o=n.$to.end(n.depth);s<o&&(i.step(new Q(s-1,o,s,o,new C(D.from(t.create(null,n.parent.copy())),1,0),1,!0)),n=new qn(i.doc.resolve(n.$from.pos),i.doc.resolve(o),n.depth));const l=un(n);if(l==null)return!1;i.lift(n,l);let a=i.mapping.map(s,-1)-1;return dt(i.doc,a)&&i.join(a),e(i.scrollIntoView()),!0}function vd(r,e,t){let n=r.tr,i=t.parent;for(let h=t.end,p=t.endIndex-1,m=t.startIndex;p>m;p--)h-=i.child(p).nodeSize,n.delete(h-1,h+1);let s=n.doc.resolve(t.start),o=s.nodeAfter;if(n.mapping.map(t.end)!=t.start+s.nodeAfter.nodeSize)return!1;let l=t.startIndex==0,a=t.endIndex==i.childCount,u=s.node(-1),c=s.index(-1);if(!u.canReplace(c+(l?0:1),c+1,o.content.append(a?D.empty:D.from(i))))return!1;let d=s.pos,f=d+o.nodeSize;return n.step(new Q(d-(l?1:0),f+(a?1:0),d+1,f-1,new C((l?D.empty:D.from(i.copy(D.empty))).append(a?D.empty:D.from(i.copy(D.empty))),l?0:1,a?0:1),l?0:1)),e(n.scrollIntoView()),!0}function Td(r){return function(e,t){let{$from:n,$to:i}=e.selection,s=n.blockRange(i,u=>u.childCount>0&&u.firstChild.type==r);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let l=s.parent,a=l.child(o-1);if(a.type!=r)return!1;if(t){let u=a.lastChild&&a.lastChild.type==l.type,c=D.from(u?r.create():null),d=new C(D.from(r.create(null,D.from(l.type.create(null,c)))),u?3:1,0),f=s.start,h=s.end;t(e.tr.step(new Q(f-(u?3:1),h,f,h,d,1,!0)).scrollIntoView())}return!0}}function Or(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:i}=t,{storedMarks:s}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),filterTransaction:e.filterTransaction,plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return n},get doc(){return i},get tr(){return n=t.selection,i=t.doc,s=t.storedMarks,t}}}class Nr{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:i}=t,{tr:s}=n,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([l,a])=>[l,(...c)=>{const d=a(...c)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i,l=[],a=!!e,u=e||s.tr,c=()=>(!a&&t&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),l.every(f=>f===!0)),d={...Object.fromEntries(Object.entries(n).map(([f,h])=>[f,(...m)=>{const g=this.buildProps(u,t),y=h(...m)(g);return l.push(y),d}])),run:c};return d}createCan(e){const{rawCommands:t,state:n}=this,i=!1,s=e||n.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([a,u])=>[a,(...c)=>u(...c)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,t=!0){const{rawCommands:n,editor:i,state:s}=this,{view:o}=i;s.storedMarks&&e.setStoredMarks(s.storedMarks);const l={tr:e,editor:i,view:o,state:Or({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map(([a,u])=>[a,(...c)=>u(...c)(l)]))}};return l}}class Od{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach(i=>i.apply(this,t)),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter(i=>i!==t):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}function E(r,e,t){return r.config[e]===void 0&&r.parent?E(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?E(r.parent,e,t):null}):r.config[e]}function Fr(r){const e=r.filter(i=>i.type==="extension"),t=r.filter(i=>i.type==="node"),n=r.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function Yl(r){const e=[],{nodeExtensions:t,markExtensions:n}=Fr(r),i=[...t,...n],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return r.forEach(o=>{const l={name:o.name,options:o.options,storage:o.storage},a=E(o,"addGlobalAttributes",l);if(!a)return;a().forEach(c=>{c.types.forEach(d=>{Object.entries(c.attributes).forEach(([f,h])=>{e.push({type:d,name:f,attribute:{...s,...h}})})})})}),i.forEach(o=>{const l={name:o.name,options:o.options,storage:o.storage},a=E(o,"addAttributes",l);if(!a)return;const u=a();Object.entries(u).forEach(([c,d])=>{const f={...s,...d};d!=null&&d.isRequired&&(d==null?void 0:d.default)===void 0&&delete f.default,e.push({type:o.name,name:c,attribute:f})})}),e}function X(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}function re(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([i,s])=>{if(!n[i]){n[i]=s;return}i==="class"?n[i]=[n[i],s].join(" "):i==="style"?n[i]=[n[i],s].join("; "):n[i]=s}),n},{})}function Mi(r,e){return e.filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(r.attrs)||{}:{[t.name]:r.attrs[t.name]}).reduce((t,n)=>re(t,n),{})}function Ql(r){return typeof r=="function"}function T(r,e=void 0,...t){return Ql(r)?e?r.bind(e)(...t):r(...t):r}function Nd(r={}){return Object.keys(r).length===0&&r.constructor===Object}function Fd(r){return typeof r!="string"?r:r.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(r):r==="true"?!0:r==="false"?!1:r}function Co(r,e){return r.style?r:{...r,getAttrs:t=>{const n=r.getAttrs?r.getAttrs(t):r.attrs;if(n===!1)return!1;const i=e.reduce((s,o)=>{const l=o.attribute.parseHTML?o.attribute.parseHTML(t):Fd(t.getAttribute(o.name));return l==null?s:{...s,[o.name]:l}},{});return{...n,...i}}}}function Eo(r){return Object.fromEntries(Object.entries(r).filter(([e,t])=>e==="attrs"&&Nd(t)?!1:t!=null))}function Bd(r){var e;const t=Yl(r),{nodeExtensions:n,markExtensions:i}=Fr(r),s=(e=n.find(a=>E(a,"topNode")))===null||e===void 0?void 0:e.name,o=Object.fromEntries(n.map(a=>{const u=t.filter(g=>g.type===a.name),c={name:a.name,options:a.options,storage:a.storage},d=r.reduce((g,y)=>{const b=E(y,"extendNodeSchema",c);return{...g,...b?b(a):{}}},{}),f=Eo({...d,content:T(E(a,"content",c)),marks:T(E(a,"marks",c)),group:T(E(a,"group",c)),inline:T(E(a,"inline",c)),atom:T(E(a,"atom",c)),selectable:T(E(a,"selectable",c)),draggable:T(E(a,"draggable",c)),code:T(E(a,"code",c)),defining:T(E(a,"defining",c)),isolating:T(E(a,"isolating",c)),attrs:Object.fromEntries(u.map(g=>{var y;return[g.name,{default:(y=g==null?void 0:g.attribute)===null||y===void 0?void 0:y.default}]}))}),h=T(E(a,"parseHTML",c));h&&(f.parseDOM=h.map(g=>Co(g,u)));const p=E(a,"renderHTML",c);p&&(f.toDOM=g=>p({node:g,HTMLAttributes:Mi(g,u)}));const m=E(a,"renderText",c);return m&&(f.toText=m),[a.name,f]})),l=Object.fromEntries(i.map(a=>{const u=t.filter(m=>m.type===a.name),c={name:a.name,options:a.options,storage:a.storage},d=r.reduce((m,g)=>{const y=E(g,"extendMarkSchema",c);return{...m,...y?y(a):{}}},{}),f=Eo({...d,inclusive:T(E(a,"inclusive",c)),excludes:T(E(a,"excludes",c)),group:T(E(a,"group",c)),spanning:T(E(a,"spanning",c)),code:T(E(a,"code",c)),attrs:Object.fromEntries(u.map(m=>{var g;return[m.name,{default:(g=m==null?void 0:m.attribute)===null||g===void 0?void 0:g.default}]}))}),h=T(E(a,"parseHTML",c));h&&(f.parseDOM=h.map(m=>Co(m,u)));const p=E(a,"renderHTML",c);return p&&(f.toDOM=m=>p({mark:m,HTMLAttributes:Mi(m,u)})),[a.name,f]}));return new qa({topNode:s,nodes:o,marks:l})}function ii(r,e){return e.nodes[r]||e.marks[r]||null}function So(r,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===r.name):e}const Id=(r,e=500)=>{let t="";const n=r.parentOffset;return r.parent.nodesBetween(Math.max(0,n-e),n,(i,s,o,l)=>{var a,u;const c=((u=(a=i.type.spec).toText)===null||u===void 0?void 0:u.call(a,{node:i,pos:s,parent:o,index:l}))||i.textContent||"%leaf%";t+=c.slice(0,Math.max(0,n-s))}),t};function Wi(r){return Object.prototype.toString.call(r)==="[object RegExp]"}class Br{constructor(e){this.find=e.find,this.handler=e.handler}}const Rd=(r,e)=>{if(Wi(e))return e.exec(r);const t=e(r);if(!t)return null;const n=[];return n.push(t.text),n.index=t.index,n.input=r,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(t.replaceWith)),n};function si(r){var e;const{editor:t,from:n,to:i,text:s,rules:o,plugin:l}=r,{view:a}=t;if(a.composing)return!1;const u=a.state.doc.resolve(n);if(u.parent.type.spec.code||!((e=u.nodeBefore||u.nodeAfter)===null||e===void 0)&&e.marks.find(f=>f.type.spec.code))return!1;let c=!1;const d=Id(u)+s;return o.forEach(f=>{if(c)return;const h=Rd(d,f.find);if(!h)return;const p=a.state.tr,m=Or({state:a.state,transaction:p}),g={from:n-(h[0].length-s.length),to:i},{commands:y,chain:b,can:x}=new Nr({editor:t,state:m});f.handler({state:m,range:g,match:h,commands:y,chain:b,can:x})===null||!p.steps.length||(p.setMeta(l,{transform:p,from:n,to:i,text:s}),a.dispatch(p),c=!0)}),c}function Pd(r){const{editor:e,rules:t}=r,n=new fe({state:{init(){return null},apply(i,s){const o=i.getMeta(n);return o||(i.selectionSet||i.docChanged?null:s)}},props:{handleTextInput(i,s,o,l){return si({editor:e,from:s,to:o,text:l,rules:t,plugin:n})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&si({editor:e,from:s.pos,to:s.pos,text:"",rules:t,plugin:n})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?si({editor:e,from:o.pos,to:o.pos,text:`
`,rules:t,plugin:n}):!1}},isInputRules:!0});return n}function Ld(r){return typeof r=="number"}class zd{constructor(e){this.find=e.find,this.handler=e.handler}}const _d=(r,e)=>{if(Wi(e))return[...r.matchAll(e)];const t=e(r);return t?t.map(n=>{const i=[];return i.push(n.text),i.index=n.index,i.input=r,i.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(n.replaceWith)),i}):[]};function Vd(r){const{editor:e,state:t,from:n,to:i,rule:s}=r,{commands:o,chain:l,can:a}=new Nr({editor:e,state:t}),u=[];return t.doc.nodesBetween(n,i,(d,f)=>{if(!d.isTextblock||d.type.spec.code)return;const h=Math.max(n,f),p=Math.min(i,f+d.content.size),m=d.textBetween(h-f,p-f,void 0,"");_d(m,s.find).forEach(y=>{if(y.index===void 0)return;const b=h+y.index+1,x=b+y[0].length,w={from:t.tr.mapping.map(b),to:t.tr.mapping.map(x)},I=s.handler({state:t,range:w,match:y,commands:o,chain:l,can:a});u.push(I)})}),u.every(d=>d!==null)}function Hd(r){const{editor:e,rules:t}=r;let n=null,i=!1,s=!1;return t.map(l=>new fe({view(a){const u=c=>{var d;n=!((d=a.dom.parentElement)===null||d===void 0)&&d.contains(c.target)?a.dom.parentElement:null};return window.addEventListener("dragstart",u),{destroy(){window.removeEventListener("dragstart",u)}}},props:{handleDOMEvents:{drop:a=>(s=n===a.dom.parentElement,!1),paste:(a,u)=>{var c;const d=(c=u.clipboardData)===null||c===void 0?void 0:c.getData("text/html");return i=!!(d!=null&&d.includes("data-pm-slice")),!1}}},appendTransaction:(a,u,c)=>{const d=a[0],f=d.getMeta("uiEvent")==="paste"&&!i,h=d.getMeta("uiEvent")==="drop"&&!s;if(!f&&!h)return;const p=u.doc.content.findDiffStart(c.doc.content),m=u.doc.content.findDiffEnd(c.doc.content);if(!Ld(p)||!m||p===m.b)return;const g=c.tr,y=Or({state:c,transaction:g});if(!(!Vd({editor:e,state:y,from:Math.max(p-1,0),to:m.b-1,rule:l})||!g.steps.length))return g}}))}function jd(r){const e=r.filter((t,n)=>r.indexOf(t)!==n);return[...new Set(e)]}class Kt{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=Kt.resolve(e),this.schema=Bd(this.extensions),this.extensions.forEach(n=>{var i;this.editor.extensionStorage[n.name]=n.storage;const s={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:ii(n.name,this.schema)};n.type==="mark"&&(!((i=T(E(n,"keepOnSplit",s)))!==null&&i!==void 0)||i)&&this.splittableMarks.push(n.name);const o=E(n,"onBeforeCreate",s);o&&this.editor.on("beforeCreate",o);const l=E(n,"onCreate",s);l&&this.editor.on("create",l);const a=E(n,"onUpdate",s);a&&this.editor.on("update",a);const u=E(n,"onSelectionUpdate",s);u&&this.editor.on("selectionUpdate",u);const c=E(n,"onTransaction",s);c&&this.editor.on("transaction",c);const d=E(n,"onFocus",s);d&&this.editor.on("focus",d);const f=E(n,"onBlur",s);f&&this.editor.on("blur",f);const h=E(n,"onDestroy",s);h&&this.editor.on("destroy",h)})}static resolve(e){const t=Kt.sort(Kt.flatten(e)),n=jd(t.map(i=>i.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map(t=>{const n={name:t.name,options:t.options,storage:t.storage},i=E(t,"addExtensions",n);return i?[t,...this.flatten(i())]:t}).flat(10)}static sort(e){return e.sort((n,i)=>{const s=E(n,"priority")||100,o=E(i,"priority")||100;return s>o?-1:s<o?1:0})}get commands(){return this.extensions.reduce((e,t)=>{const n={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:ii(t.name,this.schema)},i=E(t,"addCommands",n);return i?{...e,...i()}:e},{})}get plugins(){const{editor:e}=this,t=Kt.sort([...this.extensions].reverse()),n=[],i=[],s=t.map(o=>{const l={name:o.name,options:o.options,storage:o.storage,editor:e,type:ii(o.name,this.schema)},a=[],u=E(o,"addKeyboardShortcuts",l);let c={};if(o.type==="mark"&&o.config.exitable&&(c.ArrowRight=()=>Ke.handleExit({editor:e,mark:o})),u){const m=Object.fromEntries(Object.entries(u()).map(([g,y])=>[g,()=>y({editor:e})]));c={...c,...m}}const d=id(c);a.push(d);const f=E(o,"addInputRules",l);So(o,e.options.enableInputRules)&&f&&n.push(...f());const h=E(o,"addPasteRules",l);So(o,e.options.enablePasteRules)&&h&&i.push(...h());const p=E(o,"addProseMirrorPlugins",l);if(p){const m=p();a.push(...m)}return a}).flat();return[Pd({editor:e,rules:n}),...Hd({editor:e,rules:i}),...s]}get attributes(){return Yl(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=Fr(this.extensions);return Object.fromEntries(t.filter(n=>!!E(n,"addNodeView")).map(n=>{const i=this.attributes.filter(a=>a.type===n.name),s={name:n.name,options:n.options,storage:n.storage,editor:e,type:X(n.name,this.schema)},o=E(n,"addNodeView",s);if(!o)return[];const l=(a,u,c,d)=>{const f=Mi(a,i);return o()({editor:e,node:a,getPos:c,decorations:d,HTMLAttributes:f,extension:n})};return[n.name,l]}))}}function $d(r){return Object.prototype.toString.call(r).slice(8,-1)}function oi(r){return $d(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function Ir(r,e){const t={...r};return oi(r)&&oi(e)&&Object.keys(e).forEach(n=>{oi(e[n])?n in r?t[n]=Ir(r[n],e[n]):Object.assign(t,{[n]:e[n]}):Object.assign(t,{[n]:e[n]})}),t}class me{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=T(E(this,"addOptions",{name:this.name}))),this.storage=T(E(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new me(e)}configure(e={}){const t=this.extend();return t.options=Ir(this.options,e),t.storage=T(E(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new me(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=T(E(t,"addOptions",{name:t.name})),t.storage=T(E(t,"addStorage",{name:t.name,options:t.options})),t}}function Xl(r,e,t){const{from:n,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=t||{};let l="",a=!0;return r.nodesBetween(n,i,(u,c,d,f)=>{var h;const p=o==null?void 0:o[u.type.name];p?(u.isBlock&&!a&&(l+=s,a=!0),d&&(l+=p({node:u,pos:c,parent:d,index:f,range:e}))):u.isText?(l+=(h=u==null?void 0:u.text)===null||h===void 0?void 0:h.slice(Math.max(n,c)-c,i-c),a=!1):u.isBlock&&!a&&(l+=s,a=!0)}),l}function Zl(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}const Kd=me.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new fe({key:new Ie("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(c=>c.$from.pos)),l=Math.max(...s.map(c=>c.$to.pos)),a=Zl(t);return Xl(n,{from:o,to:l},{textSerializers:a})}}})]}}),Wd=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window==null?void 0:window.getSelection())===null||t===void 0||t.removeAllRanges())}),!0),Jd=(r=!1)=>({commands:e})=>e.setContent("",r),qd=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:i}=n;return t&&i.forEach(({$from:s,$to:o})=>{r.doc.nodesBetween(s.pos,o.pos,(l,a)=>{if(l.type.isText)return;const{doc:u,mapping:c}=e,d=u.resolve(c.map(a)),f=u.resolve(c.map(a+l.nodeSize)),h=d.blockRange(f);if(!h)return;const p=un(h);if(l.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(h.start,m)}(p||p===0)&&e.lift(h,p)})}),!0},Ud=r=>e=>r(e),Gd=()=>({state:r,dispatch:e})=>yd(r,e),Yd=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const i=r.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===n.type){if(e){const l=i.before(s),a=i.after(s);r.delete(l,a).scrollIntoView()}return!0}return!1},Qd=r=>({tr:e,state:t,dispatch:n})=>{const i=X(r,t.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(n){const a=s.before(o),u=s.after(o);e.delete(a,u).scrollIntoView()}return!0}return!1},Xd=r=>({tr:e,dispatch:t})=>{const{from:n,to:i}=r;return t&&e.delete(n,i),!0},Zd=()=>({state:r,dispatch:e})=>sd(r,e),ef=()=>({commands:r})=>r.keyboardShortcut("Enter"),tf=()=>({state:r,dispatch:e})=>gd(r,e);function tr(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(i=>t.strict?e[i]===r[i]:Wi(e[i])?e[i].test(r[i]):e[i]===r[i]):!0}function wi(r,e,t={}){return r.find(n=>n.type===e&&tr(n.attrs,t))}function nf(r,e,t={}){return!!wi(r,e,t)}function Ji(r,e,t={}){if(!r||!e)return;let n=r.parent.childAfter(r.parentOffset);if(r.parentOffset===n.offset&&n.offset!==0&&(n=r.parent.childBefore(r.parentOffset)),!n.node)return;const i=wi([...n.node.marks],e,t);if(!i)return;let s=n.index,o=r.start()+n.offset,l=s+1,a=o+n.node.nodeSize;for(wi([...n.node.marks],e,t);s>0&&i.isInSet(r.parent.child(s-1).marks);)s-=1,o-=r.parent.child(s).nodeSize;for(;l<r.parent.childCount&&nf([...r.parent.child(l).marks],e,t);)a+=r.parent.child(l).nodeSize,l+=1;return{from:o,to:a}}function ht(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}const rf=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const s=ht(r,n.schema),{doc:o,selection:l}=t,{$from:a,from:u,to:c}=l;if(i){const d=Ji(a,s,e);if(d&&d.from<=u&&d.to>=c){const f=F.create(o,d.from,d.to);t.setSelection(f)}}return!0},sf=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function ea(r){return r instanceof F}function Mt(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function ta(r,e=null){if(!e)return null;const t=O.atStart(r),n=O.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const i=t.from,s=n.to;return e==="all"?F.create(r,Mt(0,i,s),Mt(r.content.size,i,s)):F.create(r,Mt(e,i,s),Mt(e,i,s))}function qi(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const of=(r=null,e={})=>({editor:t,view:n,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{qi()&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e!=null&&e.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(s&&r===null&&!ea(t.state.selection))return o(),!0;const l=ta(i.doc,r)||t.state.selection,a=t.state.selection.eq(l);return s&&(a||i.setSelection(l),a&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},lf=(r,e)=>t=>r.every((n,i)=>e(n,{...t,index:i})),af=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e);function Ao(r){const e=`<body>${r}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function nr(r,e,t){if(t={slice:!0,parseOptions:{},...t},typeof r=="object"&&r!==null)try{return Array.isArray(r)?D.fromArray(r.map(n=>e.nodeFromJSON(n))):e.nodeFromJSON(r)}catch(n){return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",n),nr("",e,t)}if(typeof r=="string"){const n=en.fromSchema(e);return t.slice?n.parseSlice(Ao(r),t.parseOptions).content:n.parse(Ao(r),t.parseOptions)}return nr("",e,t)}function uf(r,e,t){const n=r.steps.length-1;if(n<e)return;const i=r.steps[n];if(!(i instanceof le||i instanceof Q))return;const s=r.mapping.maps[n];let o=0;s.forEach((l,a,u,c)=>{o===0&&(o=c)}),r.setSelection(O.near(r.doc.resolve(o),t))}const cf=r=>r.toString().startsWith("<"),df=(r,e,t)=>({tr:n,dispatch:i,editor:s})=>{if(i){t={parseOptions:{},updateSelection:!0,...t};const o=nr(e,s.schema,{parseOptions:{preserveWhitespace:"full",...t.parseOptions}});if(o.toString()==="<>")return!0;let{from:l,to:a}=typeof r=="number"?{from:r,to:r}:r,u=!0,c=!0;if((cf(o)?o:[o]).forEach(f=>{f.check(),u=u?f.isText&&f.marks.length===0:!1,c=c?f.isBlock:!1}),l===a&&c){const{parent:f}=n.doc.resolve(l);f.isTextblock&&!f.type.spec.code&&!f.childCount&&(l-=1,a+=1)}u?n.insertText(e,l,a):n.replaceWith(l,a,o),t.updateSelection&&uf(n,n.steps.length-1,-1)}return!0},ff=()=>({state:r,dispatch:e})=>fd(r,e),hf=()=>({state:r,dispatch:e})=>hd(r,e),pf=()=>({state:r,dispatch:e})=>ld(r,e),mf=()=>({state:r,dispatch:e})=>cd(r,e);function na(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function gf(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,i,s,o;for(let l=0;l<e.length-1;l+=1){const a=e[l];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))i=!0;else if(/^s(hift)?$/i.test(a))s=!0;else if(/^mod$/i.test(a))qi()||na()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${a}`)}return n&&(t=`Alt-${t}`),i&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),s&&(t=`Shift-${t}`),t}const yf=r=>({editor:e,view:t,tr:n,dispatch:i})=>{const s=gf(r).split(/-(?!$)/),o=s.find(u=>!["Alt","Ctrl","Meta","Shift"].includes(u)),l=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),a=e.captureTransaction(()=>{t.someProp("handleKeyDown",u=>u(t,l))});return a==null||a.steps.forEach(u=>{const c=u.map(n.mapping);c&&i&&n.maybeStep(c)}),!0};function On(r,e,t={}){const{from:n,to:i,empty:s}=r.selection,o=e?X(e,r.schema):null,l=[];r.doc.nodesBetween(n,i,(d,f)=>{if(d.isText)return;const h=Math.max(n,f),p=Math.min(i,f+d.nodeSize);l.push({node:d,from:h,to:p})});const a=i-n,u=l.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>tr(d.node.attrs,t,{strict:!1}));return s?!!u.length:u.reduce((d,f)=>d+f.to-f.from,0)>=a}const Df=(r,e={})=>({state:t,dispatch:n})=>{const i=X(r,t.schema);return On(t,i,e)?pd(t,n):!1},bf=()=>({state:r,dispatch:e})=>Dd(r,e),kf=r=>({state:e,dispatch:t})=>{const n=X(r,e.schema);return Md(n)(e,t)},Cf=()=>({state:r,dispatch:e})=>md(r,e);function Rr(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function xo(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,i)=>(t.includes(i)||(n[i]=r[i]),n),{})}const Ef=(r,e)=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const l=Rr(typeof r=="string"?r:r.name,n.schema);return l?(l==="node"&&(s=X(r,n.schema)),l==="mark"&&(o=ht(r,n.schema)),i&&t.selection.ranges.forEach(a=>{n.doc.nodesBetween(a.$from.pos,a.$to.pos,(u,c)=>{s&&s===u.type&&t.setNodeMarkup(c,void 0,xo(u.attrs,e)),o&&u.marks.length&&u.marks.forEach(d=>{o===d.type&&t.addMark(c,c+u.nodeSize,o.create(xo(d.attrs,e)))})})}),!0):!1},Sf=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),Af=()=>({tr:r,commands:e})=>e.setTextSelection({from:0,to:r.doc.content.size}),xf=()=>({state:r,dispatch:e})=>ad(r,e),Mf=()=>({state:r,dispatch:e})=>dd(r,e),wf=()=>({state:r,dispatch:e})=>bd(r,e),vf=()=>({state:r,dispatch:e})=>Ed(r,e),Tf=()=>({state:r,dispatch:e})=>Cd(r,e);function ra(r,e,t={}){return nr(r,e,{slice:!1,parseOptions:t})}const Of=(r,e=!1,t={})=>({tr:n,editor:i,dispatch:s})=>{const{doc:o}=n,l=ra(r,i.schema,t);return s&&n.replaceWith(0,o.content.size,l).setMeta("preventUpdate",!e),!0};function Nf(r,e){const t=new cl(r);return e.forEach(n=>{n.steps.forEach(i=>{t.step(i)})}),t}function Ff(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function Bf(r,e,t){const n=[];return r.nodesBetween(e.from,e.to,(i,s)=>{t(i)&&n.push({node:i,pos:s})}),n}function If(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function Ui(r){return e=>If(e.$from,r)}function Rf(r,e){const t=He.fromSchema(e).serializeFragment(r),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(t),i.innerHTML}function Pf(r,e){const t={from:0,to:r.content.size};return Xl(r,t,e)}function ia(r,e){const t=ht(e,r.schema),{from:n,to:i,empty:s}=r.selection,o=[];s?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,i,a=>{o.push(...a.marks)});const l=o.find(a=>a.type.name===t.name);return l?{...l.attrs}:{}}function Lf(r,e){const t=X(e,r.schema),{from:n,to:i}=r.selection,s=[];r.doc.nodesBetween(n,i,l=>{s.push(l)});const o=s.reverse().find(l=>l.type.name===t.name);return o?{...o.attrs}:{}}function sa(r,e){const t=Rr(typeof e=="string"?e:e.name,r.schema);return t==="node"?Lf(r,e):t==="mark"?ia(r,e):{}}function zf(r,e=JSON.stringify){const t={};return r.filter(n=>{const i=e(n);return Object.prototype.hasOwnProperty.call(t,i)?!1:t[i]=!0})}function _f(r){const e=zf(r);return e.length===1?e:e.filter((t,n)=>!e.filter((s,o)=>o!==n).some(s=>t.oldRange.from>=s.oldRange.from&&t.oldRange.to<=s.oldRange.to&&t.newRange.from>=s.newRange.from&&t.newRange.to<=s.newRange.to))}function Vf(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((l,a)=>{o.push({from:l,to:a})});else{const{from:l,to:a}=t[s];if(l===void 0||a===void 0)return;o.push({from:l,to:a})}o.forEach(({from:l,to:a})=>{const u=e.slice(s).map(l,-1),c=e.slice(s).map(a),d=e.invert().map(u,-1),f=e.invert().map(c);n.push({oldRange:{from:d,to:f},newRange:{from:u,to:c}})})}),_f(n)}function rr(r,e,t){const n=[];return r===e?t.resolve(r).marks().forEach(i=>{const s=t.resolve(r-1),o=Ji(s,i.type);o&&n.push({mark:i,...o})}):t.nodesBetween(r,e,(i,s)=>{n.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),n}function vi(r,e,t={}){const{empty:n,ranges:i}=r.selection,s=e?ht(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>tr(d.attrs,t,{strict:!1}));let o=0;const l=[];if(i.forEach(({$from:d,$to:f})=>{const h=d.pos,p=f.pos;r.doc.nodesBetween(h,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(h,g),b=Math.min(p,g+m.nodeSize),x=b-y;o+=x,l.push(...m.marks.map(w=>({mark:w,from:y,to:b})))})}),o===0)return!1;const a=l.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>tr(d.mark.attrs,t,{strict:!1})).reduce((d,f)=>d+f.to-f.from,0),u=l.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,f)=>d+f.to-f.from,0);return(a>0?a+u:a)>=o}function Hf(r,e,t={}){if(!e)return On(r,null,t)||vi(r,null,t);const n=Rr(e,r.schema);return n==="node"?On(r,e,t):n==="mark"?vi(r,e,t):!1}function Mo(r,e){const{nodeExtensions:t}=Fr(e),n=t.find(o=>o.name===r);if(!n)return!1;const i={name:n.name,options:n.options,storage:n.storage},s=T(E(n,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function jf(r){var e;const t=(e=r.type.createAndFill())===null||e===void 0?void 0:e.toJSON(),n=r.toJSON();return JSON.stringify(t)===JSON.stringify(n)}function $f(r,e,t){var n;const{selection:i}=e;let s=null;if(ea(i)&&(s=i.$cursor),s){const l=(n=r.storedMarks)!==null&&n!==void 0?n:s.marks();return!!t.isInSet(l)||!l.some(a=>a.type.excludes(t))}const{ranges:o}=i;return o.some(({$from:l,$to:a})=>{let u=l.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(l.pos,a.pos,(c,d,f)=>{if(u)return!1;if(c.isInline){const h=!f||f.type.allowsMarkType(t),p=!!t.isInSet(c.marks)||!c.marks.some(m=>m.type.excludes(t));u=h&&p}return!u}),u})}const Kf=(r,e={})=>({tr:t,state:n,dispatch:i})=>{const{selection:s}=t,{empty:o,ranges:l}=s,a=ht(r,n.schema);if(i)if(o){const u=ia(n,a);t.addStoredMark(a.create({...u,...e}))}else l.forEach(u=>{const c=u.$from.pos,d=u.$to.pos;n.doc.nodesBetween(c,d,(f,h)=>{const p=Math.max(h,c),m=Math.min(h+f.nodeSize,d);f.marks.find(y=>y.type===a)?f.marks.forEach(y=>{a===y.type&&t.addMark(p,m,a.create({...y.attrs,...e}))}):t.addMark(p,m,a.create(e))})});return $f(n,t,a)},Wf=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),Jf=(r,e={})=>({state:t,dispatch:n,chain:i})=>{const s=X(r,t.schema);return s.isTextblock?i().command(({commands:o})=>ko(s,e)(t)?!0:o.clearNodes()).command(({state:o})=>ko(s,e)(o,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},qf=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,i=Mt(r,0,n.content.size),s=M.create(n,i);e.setSelection(s)}return!0},Uf=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:i,to:s}=typeof r=="number"?{from:r,to:r}:r,o=F.atStart(n).from,l=F.atEnd(n).to,a=Mt(i,o,l),u=Mt(s,o,l),c=F.create(n,a,u);e.setSelection(c)}return!0},Gf=r=>({state:e,dispatch:t})=>{const n=X(r,e.schema);return Td(n)(e,t)};function Hn(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const i=r.find(s=>s.type===e&&s.name===n);return i?i.attribute.keepOnSplit:!1}))}function wo(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(i=>e==null?void 0:e.includes(i.type.name));r.tr.ensureMarks(n)}}const Yf=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:i})=>{const{selection:s,doc:o}=e,{$from:l,$to:a}=s,u=i.extensionManager.attributes,c=Hn(u,l.node().type.name,l.node().attrs);if(s instanceof M&&s.node.isBlock)return!l.parentOffset||!Qt(o,l.pos)?!1:(n&&(r&&wo(t,i.extensionManager.splittableMarks),e.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;if(n){const d=a.parentOffset===a.parent.content.size;s instanceof F&&e.deleteSelection();const f=l.depth===0?void 0:Ff(l.node(-1).contentMatchAt(l.indexAfter(-1)));let h=d&&f?[{type:f,attrs:c}]:void 0,p=Qt(e.doc,e.mapping.map(l.pos),1,h);if(!h&&!p&&Qt(e.doc,e.mapping.map(l.pos),1,f?[{type:f}]:void 0)&&(p=!0,h=f?[{type:f,attrs:c}]:void 0),p&&(e.split(e.mapping.map(l.pos),1,h),f&&!d&&!l.parentOffset&&l.parent.type!==f)){const m=e.mapping.map(l.before()),g=e.doc.resolve(m);l.node(-1).canReplaceWith(g.index(),g.index()+1,f)&&e.setNodeMarkup(e.mapping.map(l.before()),f)}r&&wo(t,i.extensionManager.splittableMarks),e.scrollIntoView()}return!0},Qf=r=>({tr:e,state:t,dispatch:n,editor:i})=>{var s;const o=X(r,t.schema),{$from:l,$to:a}=t.selection,u=t.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(a))return!1;const c=l.node(-1);if(c.type!==o)return!1;const d=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==o||l.index(-2)!==l.node(-2).childCount-1)return!1;if(n){let g=D.empty;const y=l.index(-1)?1:l.index(-2)?2:3;for(let H=l.depth-y;H>=l.depth-3;H-=1)g=D.from(l.node(H).copy(g));const b=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,x=Hn(d,l.node().type.name,l.node().attrs),w=((s=o.contentMatch.defaultType)===null||s===void 0?void 0:s.createAndFill(x))||void 0;g=g.append(D.from(o.createAndFill(null,w)||void 0));const I=l.before(l.depth-(y-1));e.replace(I,l.after(-b),new C(g,4-y,0));let J=-1;e.doc.nodesBetween(I,e.doc.content.size,(H,S)=>{if(J>-1)return!1;H.isTextblock&&H.content.size===0&&(J=S+1)}),J>-1&&e.setSelection(F.near(e.doc.resolve(J))),e.scrollIntoView()}return!0}const f=a.pos===l.end()?c.contentMatchAt(0).defaultType:null,h=Hn(d,c.type.name,c.attrs),p=Hn(d,l.node().type.name,l.node().attrs);e.delete(l.pos,a.pos);const m=f?[{type:o,attrs:h},{type:f,attrs:p}]:[{type:o,attrs:h}];return Qt(e.doc,l.pos,2)?(n&&e.split(l.pos,2,m).scrollIntoView(),!0):!1},vo=(r,e)=>{const t=Ui(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===(i==null?void 0:i.type)&&dt(r.doc,t.pos)&&r.join(t.pos),!0},To=(r,e)=>{const t=Ui(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const i=r.doc.nodeAt(n);return t.node.type===(i==null?void 0:i.type)&&dt(r.doc,n)&&r.join(n),!0},Xf=(r,e)=>({editor:t,tr:n,state:i,dispatch:s,chain:o,commands:l,can:a})=>{const{extensions:u}=t.extensionManager,c=X(r,i.schema),d=X(e,i.schema),{selection:f}=i,{$from:h,$to:p}=f,m=h.blockRange(p);if(!m)return!1;const g=Ui(y=>Mo(y.type.name,u))(f);if(m.depth>=1&&g&&m.depth-g.depth<=1){if(g.node.type===c)return l.liftListItem(d);if(Mo(g.node.type.name,u)&&c.validContent(g.node.content)&&s)return o().command(()=>(n.setNodeMarkup(g.pos,c),!0)).command(()=>vo(n,c)).command(()=>To(n,c)).run()}return o().command(()=>a().wrapInList(c)?!0:l.clearNodes()).wrapInList(c).command(()=>vo(n,c)).command(()=>To(n,c)).run()},Zf=(r,e={},t={})=>({state:n,commands:i})=>{const{extendEmptyMarkRange:s=!1}=t,o=ht(r,n.schema);return vi(n,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},eh=(r,e,t={})=>({state:n,commands:i})=>{const s=X(r,n.schema),o=X(e,n.schema);return On(n,s,t)?i.setNode(o):i.setNode(s,t)},th=(r,e={})=>({state:t,commands:n})=>{const i=X(r,t.schema);return On(t,i,e)?n.lift(i):n.wrapIn(i,e)},nh=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const i=t[n];let s;if(i.spec.isInputRules&&(s=i.getState(r))){if(e){const o=r.tr,l=s.transform;for(let a=l.steps.length-1;a>=0;a-=1)o.step(l.steps[a].invert(l.docs[a]));if(s.text){const a=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,r.schema.text(s.text,a))}else o.delete(s.from,s.to)}return!0}}return!1},rh=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:i}=t;return n||e&&i.forEach(s=>{r.removeMark(s.$from.pos,s.$to.pos)}),!0},ih=(r,e={})=>({tr:t,state:n,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:l}=t,a=ht(r,n.schema),{$from:u,empty:c,ranges:d}=l;if(!i)return!0;if(c&&o){let{from:f,to:h}=l;const p=(s=u.marks().find(g=>g.type===a))===null||s===void 0?void 0:s.attrs,m=Ji(u,a,p);m&&(f=m.from,h=m.to),t.removeMark(f,h,a)}else d.forEach(f=>{t.removeMark(f.$from.pos,f.$to.pos,a)});return t.removeStoredMark(a),!0},sh=(r,e={})=>({tr:t,state:n,dispatch:i})=>{let s=null,o=null;const l=Rr(typeof r=="string"?r:r.name,n.schema);return l?(l==="node"&&(s=X(r,n.schema)),l==="mark"&&(o=ht(r,n.schema)),i&&t.selection.ranges.forEach(a=>{const u=a.$from.pos,c=a.$to.pos;n.doc.nodesBetween(u,c,(d,f)=>{s&&s===d.type&&t.setNodeMarkup(f,void 0,{...d.attrs,...e}),o&&d.marks.length&&d.marks.forEach(h=>{if(o===h.type){const p=Math.max(f,u),m=Math.min(f+d.nodeSize,c);t.addMark(p,m,o.create({...h.attrs,...e}))}})})}),!0):!1},oh=(r,e={})=>({state:t,dispatch:n})=>{const i=X(r,t.schema);return Sd(i,e)(t,n)},lh=(r,e={})=>({state:t,dispatch:n})=>{const i=X(r,t.schema);return Ad(i,e)(t,n)};var ah=Object.freeze({__proto__:null,blur:Wd,clearContent:Jd,clearNodes:qd,command:Ud,createParagraphNear:Gd,deleteCurrentNode:Yd,deleteNode:Qd,deleteRange:Xd,deleteSelection:Zd,enter:ef,exitCode:tf,extendMarkRange:rf,first:sf,focus:of,forEach:lf,insertContent:af,insertContentAt:df,joinUp:ff,joinDown:hf,joinBackward:pf,joinForward:mf,keyboardShortcut:yf,lift:Df,liftEmptyBlock:bf,liftListItem:kf,newlineInCode:Cf,resetAttributes:Ef,scrollIntoView:Sf,selectAll:Af,selectNodeBackward:xf,selectNodeForward:Mf,selectParentNode:wf,selectTextblockEnd:vf,selectTextblockStart:Tf,setContent:Of,setMark:Kf,setMeta:Wf,setNode:Jf,setNodeSelection:qf,setTextSelection:Uf,sinkListItem:Gf,splitBlock:Yf,splitListItem:Qf,toggleList:Xf,toggleMark:Zf,toggleNode:eh,toggleWrap:th,undoInputRule:nh,unsetAllMarks:rh,unsetMark:ih,updateAttributes:sh,wrapIn:oh,wrapInList:lh});const uh=me.create({name:"commands",addCommands(){return{...ah}}}),ch=me.create({name:"editable",addProseMirrorPlugins(){return[new fe({key:new Ie("editable"),props:{editable:()=>this.editor.options.editable}})]}}),dh=me.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new fe({key:new Ie("focusEvents"),props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),fh=me.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:l})=>{const{selection:a,doc:u}=l,{empty:c,$anchor:d}=a,{pos:f,parent:h}=d,p=O.atStart(u).from===f;return!c||!p||!h.type.isTextblock||h.textContent.length?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...n},s={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return qi()||na()?s:i},addProseMirrorPlugins(){return[new fe({key:new Ie("clearDocument"),appendTransaction:(r,e,t)=>{if(!(r.some(p=>p.docChanged)&&!e.doc.eq(t.doc)))return;const{empty:i,from:s,to:o}=e.selection,l=O.atStart(e.doc).from,a=O.atEnd(e.doc).to,u=s===l&&o===a,c=t.doc.textBetween(0,t.doc.content.size," "," ").length===0;if(i||!u||!c)return;const d=t.tr,f=Or({state:t,transaction:d}),{commands:h}=new Nr({editor:this.editor,state:f});if(h.clearNodes(),!!d.steps.length)return d}})]}}),hh=me.create({name:"tabindex",addProseMirrorPlugins(){return[new fe({key:new Ie("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var ph=Object.freeze({__proto__:null,ClipboardTextSerializer:Kd,Commands:uh,Editable:ch,FocusEvents:dh,Keymap:fh,Tabindex:hh});const mh=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function gh(r,e){const t=document.querySelector("style[data-tiptap-style]");if(t!==null)return t;const n=document.createElement("style");return e&&n.setAttribute("nonce",e),n.setAttribute("data-tiptap-style",""),n.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(n),n}class yh extends Od{constructor(e={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=gh(mh,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e){this.setOptions({editable:e}),this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const n=Ql(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:n});this.view.updateState(i)}unregisterPlugin(e){if(this.isDestroyed)return;const t=typeof e=="string"?`${e}$`:e.key,n=this.state.reconfigure({plugins:this.state.plugins.filter(i=>!i.key.startsWith(t))});this.view.updateState(n)}createExtensionManager(){const t=[...this.options.enableCoreExtensions?Object.values(ph):[],...this.options.extensions].filter(n=>["extension","node","mark"].includes(n==null?void 0:n.type));this.extensionManager=new Kt(t,this)}createCommandManager(){this.commandManager=new Nr({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=ra(this.options.content,this.schema,this.options.parseOptions),t=ta(e,this.options.autofocus);this.view=new Uc(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:Ht.create({doc:e,selection:t||void 0})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var l;return(l=this.capturedTransaction)===null||l===void 0?void 0:l.step(o)});return}const t=this.state.apply(e),n=!this.state.selection.eq(t.selection);this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),n&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),s=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),s&&this.emit("blur",{editor:this,event:s.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return sa(this.state,e)}isActive(e,t){const n=typeof e=="string"?e:null,i=typeof e=="string"?t:e;return Hf(this.state,n,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Rf(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t=`

`,textSerializers:n={}}=e||{};return Pf(this.state.doc,{blockSeparator:t,textSerializers:{...n,...Zl(this.schema)}})}get isEmpty(){return jf(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}}function ln(r){return new Br({find:r.find,handler:({state:e,range:t,match:n})=>{const i=T(r.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:s}=e,o=n[n.length-1],l=n[0];let a=t.to;if(o){const u=l.search(/\S/),c=t.from+l.indexOf(o),d=c+o.length;if(rr(t.from,t.to,e.doc).filter(h=>h.mark.type.excluded.find(m=>m===r.type&&m!==h.mark.type)).filter(h=>h.to>c).length)return null;d<t.to&&s.delete(d,t.to),c>t.from&&s.delete(t.from+u,c),a=t.from+u+o.length,s.addMark(t.from+u,a,r.type.create(i||{})),s.removeStoredMark(r.type)}}})}function Dh(r){return new Br({find:r.find,handler:({state:e,range:t,match:n})=>{const i=T(r.getAttributes,void 0,n)||{},{tr:s}=e,o=t.from;let l=t.to;if(n[1]){const a=n[0].lastIndexOf(n[1]);let u=o+a;u>l?u=l:l=u+n[1].length;const c=n[0][n[0].length-1];s.insertText(c,o+n[0].length-1),s.replaceWith(u,l,r.type.create(i))}else n[0]&&s.replaceWith(o,l,r.type.create(i))}})}function Ti(r){return new Br({find:r.find,handler:({state:e,range:t,match:n})=>{const i=e.doc.resolve(t.from),s=T(r.getAttributes,void 0,n)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),r.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,r.type,s)}})}function Gi(r){return new Br({find:r.find,handler:({state:e,range:t,match:n})=>{const i=T(r.getAttributes,void 0,n)||{},s=e.tr.delete(t.from,t.to),l=s.doc.resolve(t.from).blockRange(),a=l&&Bi(l,r.type,i);if(!a)return null;s.wrap(l,a);const u=s.doc.resolve(t.from-1).nodeBefore;u&&u.type===r.type&&dt(s.doc,t.from-1)&&(!r.joinPredicate||r.joinPredicate(n,u))&&s.join(t.from-1)}})}class Ke{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=T(E(this,"addOptions",{name:this.name}))),this.storage=T(E(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ke(e)}configure(e={}){const t=this.extend();return t.options=Ir(this.options,e),t.storage=T(E(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Ke(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=T(E(t,"addOptions",{name:t.name})),t.storage=T(E(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(u=>(u==null?void 0:u.type.name)===t.name))return!1;const a=o.find(u=>(u==null?void 0:u.type.name)===t.name);return a&&n.removeStoredMark(a),n.insertText(" ",i.pos),e.view.dispatch(n),!0}return!1}}class ge{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=T(E(this,"addOptions",{name:this.name}))),this.storage=T(E(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ge(e)}configure(e={}){const t=this.extend();return t.options=Ir(this.options,e),t.storage=T(E(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new ge(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=T(E(t,"addOptions",{name:t.name})),t.storage=T(E(t,"addStorage",{name:t.name,options:t.options})),t}}function Rt(r){return new zd({find:r.find,handler:({state:e,range:t,match:n})=>{const i=T(r.getAttributes,void 0,n);if(i===!1||i===null)return null;const{tr:s}=e,o=n[n.length-1],l=n[0];let a=t.to;if(o){const u=l.search(/\S/),c=t.from+l.indexOf(o),d=c+o.length;if(rr(t.from,t.to,e.doc).filter(h=>h.mark.type.excluded.find(m=>m===r.type&&m!==h.mark.type)).filter(h=>h.to>c).length)return null;d<t.to&&s.delete(d,t.to),c>t.from&&s.delete(t.from+u,c),a=t.from+u+o.length,s.addMark(t.from+u,a,r.type.create(i||{})),s.removeStoredMark(r.type)}}})}const bh=/^\s*>\s$/,kh=ge.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:r}){return["blockquote",re(this.options.HTMLAttributes,r),0]},addCommands(){return{setBlockquote:()=>({commands:r})=>r.wrapIn(this.name),toggleBlockquote:()=>({commands:r})=>r.toggleWrap(this.name),unsetBlockquote:()=>({commands:r})=>r.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Gi({find:bh,type:this.type})]}}),Ch=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,Eh=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,Sh=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,Ah=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,oa=Ke.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:r=>r.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:r=>/^(bold(er)?|[5-9]\d{2,})$/.test(r)&&null}]},renderHTML({HTMLAttributes:r}){return["strong",re(this.options.HTMLAttributes,r),0]},addCommands(){return{setBold:()=>({commands:r})=>r.setMark(this.name),toggleBold:()=>({commands:r})=>r.toggleMark(this.name),unsetBold:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[ln({find:Ch,type:this.type}),ln({find:Sh,type:this.type})]},addPasteRules(){return[Rt({find:Eh,type:this.type}),Rt({find:Ah,type:this.type})]}}),xh=/^\s*([-+*])\s$/,la=ge.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:r}){return["ul",re(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleBulletList:()=>({commands:r})=>r.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){return[Gi({find:xh,type:this.type})]}}),Mh=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,wh=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,vh=Ke.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:r}){return["code",re(this.options.HTMLAttributes,r),0]},addCommands(){return{setCode:()=>({commands:r})=>r.setMark(this.name),toggleCode:()=>({commands:r})=>r.toggleMark(this.name),unsetCode:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[ln({find:Mh,type:this.type})]},addPasteRules(){return[Rt({find:wh,type:this.type})]}}),Th=/^```([a-z]+)?[\s\n]$/,Oh=/^~~~([a-z]+)?[\s\n]$/,Nh=ge.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:r=>{var e;const{languageClassPrefix:t}=this.options,s=[...((e=r.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(t)).map(o=>o.replace(t,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:r,HTMLAttributes:e}){return["pre",re(this.options.HTMLAttributes,e),["code",{class:r.attrs.language?this.options.languageClassPrefix+r.attrs.language:null},0]]},addCommands(){return{setCodeBlock:r=>({commands:e})=>e.setNode(this.name,r),toggleCodeBlock:r=>({commands:e})=>e.toggleNode(this.name,"paragraph",r)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:r,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!r||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:r})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=r,{selection:t}=e,{$from:n,empty:i}=t;if(!i||n.parent.type!==this.type)return!1;const s=n.parentOffset===n.parent.nodeSize-2,o=n.parent.textContent.endsWith(`

`);return!s||!o?!1:r.chain().command(({tr:l})=>(l.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:r})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=r,{selection:t,doc:n}=e,{$from:i,empty:s}=t;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const l=i.after();return l===void 0||n.nodeAt(l)?!1:r.commands.exitCode()}}},addInputRules(){return[Ti({find:Th,type:this.type,getAttributes:r=>({language:r[1]})}),Ti({find:Oh,type:this.type,getAttributes:r=>({language:r[1]})})]},addProseMirrorPlugins(){return[new fe({key:new Ie("codeBlockVSCodeHandler"),props:{handlePaste:(r,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),i=n?JSON.parse(n):void 0,s=i==null?void 0:i.mode;if(!t||!s)return!1;const{tr:o}=r.state;return o.replaceSelectionWith(this.type.create({language:s})),o.setSelection(F.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.insertText(t.replace(/\r\n?/g,`
`)),o.setMeta("paste",!0),r.dispatch(o),!0}}})]}}),aa=ge.create({name:"doc",topNode:!0,content:"block+"});function Fh(r={}){return new fe({view(e){return new Bh(e,r)}})}class Bh{constructor(e,t){this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=t.width||1,this.color=t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(n=>{let i=s=>{this[n](s)};return e.dom.addEventListener(n,i),{name:n,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t;if(!e.parent.inlineContent){let o=e.nodeBefore,l=e.nodeAfter;if(o||l){let a=this.editorView.nodeDOM(this.cursorPos-(o?o.nodeSize:0)).getBoundingClientRect(),u=o?a.bottom:a.top;o&&l&&(u=(u+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),t={left:a.left,right:a.right,top:u-this.width/2,bottom:u+this.width/2}}}if(!t){let o=this.editorView.coordsAtPos(this.cursorPos);t={left:o.left-this.width/2,right:o.left+this.width/2,top:o.top,bottom:o.bottom}}let n=this.editorView.dom.offsetParent;this.element||(this.element=n.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);let i,s;if(!n||n==document.body&&getComputedStyle(n).position=="static")i=-pageXOffset,s=-pageYOffset;else{let o=n.getBoundingClientRect();i=o.left-n.scrollLeft,s=o.top-n.scrollTop}this.element.style.left=t.left-i+"px",this.element.style.top=t.top-s+"px",this.element.style.width=t.right-t.left+"px",this.element.style.height=t.bottom-t.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),i=n&&n.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,t):i;if(t&&!s){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(o=sl(this.editorView.state.doc,o,this.editorView.dragging.slice),o==null))return this.setCursor(null);this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}const Ih=me.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Fh(this.options)]}});class j extends O{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return j.valid(n)?new j(n):O.near(n)}content(){return C.empty}eq(e){return e instanceof j&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new j(e.resolve(t.pos))}getBookmark(){return new Yi(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!Rh(e)||!Ph(e))return!1;let n=t.type.spec.allowGapCursor;if(n!=null)return n;let i=t.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&j.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let l=e.node(o);if(t>0?e.indexAfter(o)<l.childCount:e.index(o)>0){s=l.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=t;let a=e.doc.resolve(i);if(j.valid(a))return a}for(;;){let o=t>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!M.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*t),n=!1;continue e}break}s=o,i+=t;let l=e.doc.resolve(i);if(j.valid(l))return l}return null}}}j.prototype.visible=!1;j.findFrom=j.findGapCursorFrom;O.jsonID("gapcursor",j);class Yi{constructor(e){this.pos=e}map(e){return new Yi(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return j.valid(t)?new j(t):O.near(t)}}function Rh(r){for(let e=r.depth;e>=0;e--){let t=r.index(e),n=r.node(e);if(t==0){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(t-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function Ph(r){for(let e=r.depth;e>=0;e--){let t=r.indexAfter(e),n=r.node(e);if(t==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let i=n.child(t);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function Lh(){return new fe({props:{decorations:Hh,createSelectionBetween(r,e,t){return e.pos==t.pos&&j.valid(t)?new j(t):null},handleClick:_h,handleKeyDown:zh,handleDOMEvents:{beforeinput:Vh}}})}const zh=Kl({ArrowLeft:_n("horiz",-1),ArrowRight:_n("horiz",1),ArrowUp:_n("vert",-1),ArrowDown:_n("vert",1)});function _n(r,e){const t=r=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,i,s){let o=n.selection,l=e>0?o.$to:o.$from,a=o.empty;if(o instanceof F){if(!s.endOfTextblock(t)||l.depth==0)return!1;a=!1,l=n.doc.resolve(e>0?l.after():l.before())}let u=j.findGapCursorFrom(l,e,a);return u?(i&&i(n.tr.setSelection(new j(u))),!0):!1}}function _h(r,e,t){if(!r||!r.editable)return!1;let n=r.state.doc.resolve(e);if(!j.valid(n))return!1;let i=r.posAtCoords({left:t.clientX,top:t.clientY});return i&&i.inside>-1&&M.isSelectable(r.state.doc.nodeAt(i.inside))?!1:(r.dispatch(r.state.tr.setSelection(new j(n))),!0)}function Vh(r,e){if(e.inputType!="insertCompositionText"||!(r.state.selection instanceof j))return!1;let{$from:t}=r.state.selection,n=t.parent.contentMatchAt(t.index()).findWrapping(r.state.schema.nodes.text);if(!n)return!1;let i=D.empty;for(let o=n.length-1;o>=0;o--)i=D.from(n[o].createAndFill(null,i));let s=r.state.tr.replace(t.pos,t.pos,new C(i,0,0));return s.setSelection(F.near(s.doc.resolve(t.pos+1))),r.dispatch(s),!1}function Hh(r){if(!(r.selection instanceof j))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",q.create(r.doc,[xe.widget(r.selection.head,e,{key:"gapcursor"})])}const jh=me.create({name:"gapCursor",addProseMirrorPlugins(){return[Lh()]},extendNodeSchema(r){var e;const t={name:r.name,options:r.options,storage:r.storage};return{allowGapCursor:(e=T(E(r,"allowGapCursor",t)))!==null&&e!==void 0?e:null}}}),$h=ge.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:r}){return["br",re(this.options.HTMLAttributes,r)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:r,chain:e,state:t,editor:n})=>r.first([()=>r.exitCode(),()=>r.command(()=>{const{selection:i,storedMarks:s}=t;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:l}=n.extensionManager,a=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:u,dispatch:c})=>{if(c&&a&&o){const d=a.filter(f=>l.includes(f.type.name));u.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),ua=ge.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(r=>({tag:`h${r}`,attrs:{level:r}}))},renderHTML({node:r,HTMLAttributes:e}){return[`h${this.options.levels.includes(r.attrs.level)?r.attrs.level:this.options.levels[0]}`,re(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.setNode(this.name,r):!1,toggleHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.toggleNode(this.name,"paragraph",r):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((r,e)=>({...r,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(r=>Ti({find:new RegExp(`^(#{1,${r}})\\s$`),type:this.type,getAttributes:{level:r}}))}});var ir=200,ne=function(){};ne.prototype.append=function(e){return e.length?(e=ne.from(e),!this.length&&e||e.length<ir&&this.leafAppend(e)||this.length<ir&&e.leafPrepend(this)||this.appendInner(e)):this};ne.prototype.prepend=function(e){return e.length?ne.from(e).append(this):this};ne.prototype.appendInner=function(e){return new Kh(this,e)};ne.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?ne.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};ne.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};ne.prototype.forEach=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)};ne.prototype.map=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},t,n),i};ne.from=function(e){return e instanceof ne?e:e&&e.length?new ca(e):ne.empty};var ca=function(r){function e(n){r.call(this),this.values=n}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,l){for(var a=s;a<o;a++)if(i(this.values[a],l+a)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,l){for(var a=s-1;a>=o;a--)if(i(this.values[a],l+a)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=ir)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=ir)return new e(i.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(ne);ne.empty=new ca([]);var Kh=function(r){function e(t,n){r.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,i,s,o){var l=this.left.length;if(i<l&&this.left.forEachInner(n,i,Math.min(s,l),o)===!1||s>l&&this.right.forEachInner(n,Math.max(i-l,0),Math.min(this.length,s)-l,o+l)===!1)return!1},e.prototype.forEachInvertedInner=function(n,i,s,o){var l=this.left.length;if(i>l&&this.right.forEachInvertedInner(n,i-l,Math.max(s,l)-l,o+l)===!1||s<l&&this.left.forEachInvertedInner(n,Math.min(i,l),s,o)===!1)return!1},e.prototype.sliceInner=function(n,i){if(n==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(n,i):n>=s?this.right.slice(n-s,i-s):this.left.slice(n,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(n){var i=this.right.leafAppend(n);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(n){var i=this.left.leafPrepend(n);if(i)return new e(i,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e}(ne),da=ne;const Wh=500;class Oe{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let i,s;t&&(i=this.remapping(n,this.items.length),s=i.maps.length);let o=e.tr,l,a,u=[],c=[];return this.items.forEach((d,f)=>{if(!d.step){i||(i=this.remapping(n,f+1),s=i.maps.length),s--,c.push(d);return}if(i){c.push(new Le(d.map));let h=d.step.map(i.slice(s)),p;h&&o.maybeStep(h).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],u.push(new Le(p,void 0,void 0,u.length+c.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(d.step);if(d.selection)return l=i?d.selection.map(i.slice(s)):d.selection,a=new Oe(this.items.slice(0,n).append(c.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:a,transform:o,selection:l}}addTransform(e,t,n,i){let s=[],o=this.eventCount,l=this.items,a=!i&&l.length?l.get(l.length-1):null;for(let c=0;c<e.steps.length;c++){let d=e.steps[c].invert(e.docs[c]),f=new Le(e.mapping.maps[c],d,t),h;(h=a&&a.merge(f))&&(f=h,c?s.pop():l=l.slice(0,l.length-1)),s.push(f),t&&(o++,t=void 0),i||(a=f)}let u=o-n.depth;return u>qh&&(l=Jh(l,u),o-=u),new Oe(l.append(s),o)}remapping(e,t){let n=new Yt;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?n.maps.length-i.mirrorOffset:void 0;n.appendMap(i.map,o)},e,t),n}addMaps(e){return this.eventCount==0?this:new Oe(this.items.append(e.map(t=>new Le(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],i=Math.max(0,this.items.length-t),s=e.mapping,o=e.steps.length,l=this.eventCount;this.items.forEach(f=>{f.selection&&l--},i);let a=t;this.items.forEach(f=>{let h=s.getMirror(--a);if(h==null)return;o=Math.min(o,h);let p=s.maps[h];if(f.step){let m=e.steps[h].invert(e.docs[h]),g=f.selection&&f.selection.map(s.slice(a+1,h));g&&l++,n.push(new Le(p,m,g))}else n.push(new Le(p))},i);let u=[];for(let f=t;f<o;f++)u.push(new Le(s.maps[f]));let c=this.items.slice(0,i).append(u).append(n),d=new Oe(c,l);return d.emptyItemCount()>Wh&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,i=[],s=0;return this.items.forEach((o,l)=>{if(l>=e)i.push(o),o.selection&&s++;else if(o.step){let a=o.step.map(t.slice(n)),u=a&&a.getMap();if(n--,u&&t.appendMap(u,n),a){let c=o.selection&&o.selection.map(t.slice(n));c&&s++;let d=new Le(u.invert(),a,c),f,h=i.length-1;(f=i.length&&i[h].merge(d))?i[h]=f:i.push(d)}}else o.map&&n--},this.items.length,0),new Oe(da.from(i.reverse()),s)}}Oe.empty=new Oe(da.empty,0);function Jh(r,e){let t;return r.forEach((n,i)=>{if(n.selection&&e--==0)return t=i,!1}),r.slice(t)}class Le{constructor(e,t,n,i){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new Le(t.getMap().invert(),t,this.selection)}}}class et{constructor(e,t,n,i){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=i}}const qh=20;function Uh(r,e,t,n){let i=t.getMeta(at),s;if(i)return i.historyState;t.getMeta(Yh)&&(r=new et(r.done,r.undone,null,0));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return r;if(o&&o.getMeta(at))return o.getMeta(at).redo?new et(r.done.addTransform(t,void 0,n,jn(e)),r.undone,Oo(t.mapping.maps[t.steps.length-1]),r.prevTime):new et(r.done,r.undone.addTransform(t,void 0,n,jn(e)),null,r.prevTime);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let l=r.prevTime==0||!o&&(r.prevTime<(t.time||0)-n.newGroupDelay||!Gh(t,r.prevRanges)),a=o?li(r.prevRanges,t.mapping):Oo(t.mapping.maps[t.steps.length-1]);return new et(r.done.addTransform(t,l?e.selection.getBookmark():void 0,n,jn(e)),Oe.empty,a,t.time)}else return(s=t.getMeta("rebased"))?new et(r.done.rebased(t,s),r.undone.rebased(t,s),li(r.prevRanges,t.mapping),r.prevTime):new et(r.done.addMaps(t.mapping.maps),r.undone.addMaps(t.mapping.maps),li(r.prevRanges,t.mapping),r.prevTime)}function Gh(r,e){if(!e)return!1;if(!r.docChanged)return!0;let t=!1;return r.mapping.maps[0].forEach((n,i)=>{for(let s=0;s<e.length;s+=2)n<=e[s+1]&&i>=e[s]&&(t=!0)}),t}function Oo(r){let e=[];return r.forEach((t,n,i,s)=>e.push(i,s)),e}function li(r,e){if(!r)return null;let t=[];for(let n=0;n<r.length;n+=2){let i=e.map(r[n],1),s=e.map(r[n+1],-1);i<=s&&t.push(i,s)}return t}function fa(r,e,t,n){let i=jn(e),s=at.get(e).spec.config,o=(n?r.undone:r.done).popEvent(e,i);if(!o)return;let l=o.selection.resolve(o.transform.doc),a=(n?r.done:r.undone).addTransform(o.transform,e.selection.getBookmark(),s,i),u=new et(n?a:o.remaining,n?o.remaining:a,null,0);t(o.transform.setSelection(l).setMeta(at,{redo:n,historyState:u}).scrollIntoView())}let ai=!1,No=null;function jn(r){let e=r.plugins;if(No!=e){ai=!1,No=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){ai=!0;break}}return ai}const at=new Ie("history"),Yh=new Ie("closeHistory");function Qh(r={}){return r={depth:r.depth||100,newGroupDelay:r.newGroupDelay||500},new fe({key:at,state:{init(){return new et(Oe.empty,Oe.empty,null,0)},apply(e,t,n){return Uh(t,n,e,r)}},config:r,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,i=n=="historyUndo"?ha:n=="historyRedo"?pa:null;return i?(t.preventDefault(),i(e.state,e.dispatch)):!1}}}})}const ha=(r,e)=>{let t=at.getState(r);return!t||t.done.eventCount==0?!1:(e&&fa(t,r,e,!1),!0)},pa=(r,e)=>{let t=at.getState(r);return!t||t.undone.eventCount==0?!1:(e&&fa(t,r,e,!0),!0)},Xh=me.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:r,dispatch:e})=>ha(r,e),redo:()=>({state:r,dispatch:e})=>pa(r,e)}},addProseMirrorPlugins(){return[Qh(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),Zh=ge.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:r}){return["hr",re(this.options.HTMLAttributes,r)]},addCommands(){return{setHorizontalRule:()=>({chain:r})=>r().insertContent({type:this.name}).command(({tr:e,dispatch:t})=>{var n;if(t){const{$to:i}=e.selection,s=i.end();if(i.nodeAfter)e.setSelection(F.create(e.doc,i.pos));else{const o=(n=i.parent.type.contentMatch.defaultType)===null||n===void 0?void 0:n.create();o&&(e.insert(s,o),e.setSelection(F.create(e.doc,s)))}e.scrollIntoView()}return!0}).run()}},addInputRules(){return[Dh({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),ep=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,tp=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,np=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,rp=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,ma=Ke.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:r=>r.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:r}){return["em",re(this.options.HTMLAttributes,r),0]},addCommands(){return{setItalic:()=>({commands:r})=>r.setMark(this.name),toggleItalic:()=>({commands:r})=>r.toggleMark(this.name),unsetItalic:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[ln({find:ep,type:this.type}),ln({find:np,type:this.type})]},addPasteRules(){return[Rt({find:tp,type:this.type}),Rt({find:rp,type:this.type})]}}),ga=ge.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:r}){return["li",re(this.options.HTMLAttributes,r),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ip=/^(\d+)\.\s$/,ya=ge.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:r=>r.hasAttribute("start")?parseInt(r.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:r}){const{start:e,...t}=r;return e===1?["ol",re(this.options.HTMLAttributes,t),0]:["ol",re(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleOrderedList:()=>({commands:r})=>r.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){return[Gi({find:ip,type:this.type,getAttributes:r=>({start:+r[1]}),joinPredicate:(r,e)=>e.childCount+e.attrs.start===+r[1]})]}}),Da=ge.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:r}){return["p",re(this.options.HTMLAttributes,r),0]},addCommands(){return{setParagraph:()=>({commands:r})=>r.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),sp=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,op=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,ba=Ke.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["s",re(this.options.HTMLAttributes,r),0]},addCommands(){return{setStrike:()=>({commands:r})=>r.setMark(this.name),toggleStrike:()=>({commands:r})=>r.toggleMark(this.name),unsetStrike:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[ln({find:sp,type:this.type})]},addPasteRules(){return[Rt({find:op,type:this.type})]}}),ka=ge.create({name:"text",group:"inline"});me.create({name:"starterKit",addExtensions(){var r,e,t,n,i,s,o,l,a,u,c,d,f,h,p,m,g,y;const b=[];return this.options.blockquote!==!1&&b.push(kh.configure((r=this.options)===null||r===void 0?void 0:r.blockquote)),this.options.bold!==!1&&b.push(oa.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&b.push(la.configure((t=this.options)===null||t===void 0?void 0:t.bulletList)),this.options.code!==!1&&b.push(vh.configure((n=this.options)===null||n===void 0?void 0:n.code)),this.options.codeBlock!==!1&&b.push(Nh.configure((i=this.options)===null||i===void 0?void 0:i.codeBlock)),this.options.document!==!1&&b.push(aa.configure((s=this.options)===null||s===void 0?void 0:s.document)),this.options.dropcursor!==!1&&b.push(Ih.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&b.push(jh.configure((l=this.options)===null||l===void 0?void 0:l.gapcursor)),this.options.hardBreak!==!1&&b.push($h.configure((a=this.options)===null||a===void 0?void 0:a.hardBreak)),this.options.heading!==!1&&b.push(ua.configure((u=this.options)===null||u===void 0?void 0:u.heading)),this.options.history!==!1&&b.push(Xh.configure((c=this.options)===null||c===void 0?void 0:c.history)),this.options.horizontalRule!==!1&&b.push(Zh.configure((d=this.options)===null||d===void 0?void 0:d.horizontalRule)),this.options.italic!==!1&&b.push(ma.configure((f=this.options)===null||f===void 0?void 0:f.italic)),this.options.listItem!==!1&&b.push(ga.configure((h=this.options)===null||h===void 0?void 0:h.listItem)),this.options.orderedList!==!1&&b.push(ya.configure((p=this.options)===null||p===void 0?void 0:p.orderedList)),this.options.paragraph!==!1&&b.push(Da.configure((m=this.options)===null||m===void 0?void 0:m.paragraph)),this.options.strike!==!1&&b.push(ba.configure((g=this.options)===null||g===void 0?void 0:g.strike)),this.options.text!==!1&&b.push(ka.configure((y=this.options)===null||y===void 0?void 0:y.text)),b}});function Qi(r){this.j={},this.jr=[],this.jd=null,this.t=r}Qi.prototype={accepts:function(){return!!this.t},tt:function(e,t){if(t&&t.j)return this.j[e]=t,t;var n=t,i=this.j[e];if(i)return n&&(i.t=n),i;i=P();var s=sr(this,e);return s?(Object.assign(i.j,s.j),i.jr.append(s.jr),i.jr=s.jd,i.t=n||s.t):i.t=n,this.j[e]=i,i}};var P=function(){return new Qi},A=function(e){return new Qi(e)},k=function(e,t,n){e.j[t]||(e.j[t]=n)},G=function(e,t,n){e.jr.push([t,n])},sr=function(e,t){var n=e.j[t];if(n)return n;for(var i=0;i<e.jr.length;i++){var s=e.jr[i][0],o=e.jr[i][1];if(s.test(t))return o}return e.jd},B=function(e,t,n){for(var i=0;i<t.length;i++)k(e,t[i],n)},lp=function(e,t){for(var n=0;n<t.length;n++){var i=t[n][0],s=t[n][1];k(e,i,s)}},Et=function(e,t,n,i){for(var s=0,o=t.length,l;s<o&&(l=e.j[t[s]]);)e=l,s++;if(s>=o)return[];for(;s<o-1;)l=i(),k(e,t[s],l),e=l,s++;k(e,t[o-1],n)},Te="DOMAIN",qe="LOCALHOST",ze="TLD",Ee="NUM",an="PROTOCOL",Xi="MAILTO",Ca="WS",Zi="NL",Wt="OPENBRACE",Sn="OPENBRACKET",An="OPENANGLEBRACKET",xn="OPENPAREN",At="CLOSEBRACE",Jt="CLOSEBRACKET",qt="CLOSEANGLEBRACKET",Ut="CLOSEPAREN",or="AMPERSAND",lr="APOSTROPHE",ar="ASTERISK",Gt="AT",ur="BACKSLASH",cr="BACKTICK",dr="CARET",Mn="COLON",es="COMMA",fr="DOLLAR",tt="DOT",hr="EQUALS",ts="EXCLAMATION",pr="HYPHEN",mr="PERCENT",gr="PIPE",yr="PLUS",Dr="POUND",br="QUERY",ns="QUOTE",rs="SEMI",Ue="SLASH",kr="TILDE",Cr="UNDERSCORE",Er="SYM",ap=Object.freeze({__proto__:null,DOMAIN:Te,LOCALHOST:qe,TLD:ze,NUM:Ee,PROTOCOL:an,MAILTO:Xi,WS:Ca,NL:Zi,OPENBRACE:Wt,OPENBRACKET:Sn,OPENANGLEBRACKET:An,OPENPAREN:xn,CLOSEBRACE:At,CLOSEBRACKET:Jt,CLOSEANGLEBRACKET:qt,CLOSEPAREN:Ut,AMPERSAND:or,APOSTROPHE:lr,ASTERISK:ar,AT:Gt,BACKSLASH:ur,BACKTICK:cr,CARET:dr,COLON:Mn,COMMA:es,DOLLAR:fr,DOT:tt,EQUALS:hr,EXCLAMATION:ts,HYPHEN:pr,PERCENT:mr,PIPE:gr,PLUS:yr,POUND:Dr,QUERY:br,QUOTE:ns,SEMI:rs,SLASH:Ue,TILDE:kr,UNDERSCORE:Cr,SYM:Er}),Fo="aaa aarp abarth abb abbott abbvie abc able abogado abudhabi ac academy accenture accountant accountants aco actor ad adac ads adult ae aeg aero aetna af afamilycompany afl africa ag agakhan agency ai aig airbus airforce airtel akdn al alfaromeo alibaba alipay allfinanz allstate ally alsace alstom am amazon americanexpress americanfamily amex amfam amica amsterdam analytics android anquan anz ao aol apartments app apple aq aquarelle ar arab aramco archi army arpa art arte as asda asia associates at athleta attorney au auction audi audible audio auspost author auto autos avianca aw aws ax axa az azure ba baby baidu banamex bananarepublic band bank bar barcelona barclaycard barclays barefoot bargains baseball basketball bauhaus bayern bb bbc bbt bbva bcg bcn bd be beats beauty beer bentley berlin best bestbuy bet bf bg bh bharti bi bible bid bike bing bingo bio biz bj black blackfriday blockbuster blog bloomberg blue bm bms bmw bn bnpparibas bo boats boehringer bofa bom bond boo book booking bosch bostik boston bot boutique box br bradesco bridgestone broadway broker brother brussels bs bt budapest bugatti build builders business buy buzz bv bw by bz bzh ca cab cafe cal call calvinklein cam camera camp cancerresearch canon capetown capital capitalone car caravan cards care career careers cars casa case cash casino cat catering catholic cba cbn cbre cbs cc cd center ceo cern cf cfa cfd cg ch chanel channel charity chase chat cheap chintai christmas chrome church ci cipriani circle cisco citadel citi citic city cityeats ck cl claims cleaning click clinic clinique clothing cloud club clubmed cm cn co coach codes coffee college cologne com comcast commbank community company compare computer comsec condos construction consulting contact contractors cooking cookingchannel cool coop corsica country coupon coupons courses cpa cr credit creditcard creditunion cricket crown crs cruise cruises csc cu cuisinella cv cw cx cy cymru cyou cz dabur dad dance data date dating datsun day dclk dds de deal dealer deals degree delivery dell deloitte delta democrat dental dentist desi design dev dhl diamonds diet digital direct directory discount discover dish diy dj dk dm dnp do docs doctor dog domains dot download drive dtv dubai duck dunlop dupont durban dvag dvr dz earth eat ec eco edeka edu education ee eg email emerck energy engineer engineering enterprises epson equipment er ericsson erni es esq estate et etisalat eu eurovision eus events exchange expert exposed express extraspace fage fail fairwinds faith family fan fans farm farmers fashion fast fedex feedback ferrari ferrero fi fiat fidelity fido film final finance financial fire firestone firmdale fish fishing fit fitness fj fk flickr flights flir florist flowers fly fm fo foo food foodnetwork football ford forex forsale forum foundation fox fr free fresenius frl frogans frontdoor frontier ftr fujitsu fujixerox fun fund furniture futbol fyi ga gal gallery gallo gallup game games gap garden gay gb gbiz gd gdn ge gea gent genting george gf gg ggee gh gi gift gifts gives giving gl glade glass gle global globo gm gmail gmbh gmo gmx gn godaddy gold goldpoint golf goo goodyear goog google gop got gov gp gq gr grainger graphics gratis green gripe grocery group gs gt gu guardian gucci guge guide guitars guru gw gy hair hamburg hangout haus hbo hdfc hdfcbank health healthcare help helsinki here hermes hgtv hiphop hisamitsu hitachi hiv hk hkt hm hn hockey holdings holiday homedepot homegoods homes homesense honda horse hospital host hosting hot hoteles hotels hotmail house how hr hsbc ht hu hughes hyatt hyundai ibm icbc ice icu id ie ieee ifm ikano il im imamat imdb immo immobilien in inc industries infiniti info ing ink institute insurance insure int international intuit investments io ipiranga iq ir irish is ismaili ist istanbul it itau itv iveco jaguar java jcb je jeep jetzt jewelry jio jll jm jmp jnj jo jobs joburg jot joy jp jpmorgan jprs juegos juniper kaufen kddi ke kerryhotels kerrylogistics kerryproperties kfh kg kh ki kia kim kinder kindle kitchen kiwi km kn koeln komatsu kosher kp kpmg kpn kr krd kred kuokgroup kw ky kyoto kz la lacaixa lamborghini lamer lancaster lancia land landrover lanxess lasalle lat latino latrobe law lawyer lb lc lds lease leclerc lefrak legal lego lexus lgbt li lidl life lifeinsurance lifestyle lighting like lilly limited limo lincoln linde link lipsy live living lixil lk llc llp loan loans locker locus loft lol london lotte lotto love lpl lplfinancial lr ls lt ltd ltda lu lundbeck luxe luxury lv ly ma macys madrid maif maison makeup man management mango map market marketing markets marriott marshalls maserati mattel mba mc mckinsey md me med media meet melbourne meme memorial men menu merckmsd mg mh miami microsoft mil mini mint mit mitsubishi mk ml mlb mls mm mma mn mo mobi mobile moda moe moi mom monash money monster mormon mortgage moscow moto motorcycles mov movie mp mq mr ms msd mt mtn mtr mu museum mutual mv mw mx my mz na nab nagoya name nationwide natura navy nba nc ne nec net netbank netflix network neustar new news next nextdirect nexus nf nfl ng ngo nhk ni nico nike nikon ninja nissan nissay nl no nokia northwesternmutual norton now nowruz nowtv np nr nra nrw ntt nu nyc nz obi observer off office okinawa olayan olayangroup oldnavy ollo om omega one ong onl online onyourside ooo open oracle orange org organic origins osaka otsuka ott ovh pa page panasonic paris pars partners parts party passagens pay pccw pe pet pf pfizer pg ph pharmacy phd philips phone photo photography photos physio pics pictet pictures pid pin ping pink pioneer pizza pk pl place play playstation plumbing plus pm pn pnc pohl poker politie porn post pr pramerica praxi press prime pro prod productions prof progressive promo properties property protection pru prudential ps pt pub pw pwc py qa qpon quebec quest qvc racing radio raid re read realestate realtor realty recipes red redstone redumbrella rehab reise reisen reit reliance ren rent rentals repair report republican rest restaurant review reviews rexroth rich richardli ricoh ril rio rip rmit ro rocher rocks rodeo rogers room rs rsvp ru rugby ruhr run rw rwe ryukyu sa saarland safe safety sakura sale salon samsclub samsung sandvik sandvikcoromant sanofi sap sarl sas save saxo sb sbi sbs sc sca scb schaeffler schmidt scholarships school schule schwarz science scjohnson scot sd se search seat secure security seek select sener services ses seven sew sex sexy sfr sg sh shangrila sharp shaw shell shia shiksha shoes shop shopping shouji show showtime si silk sina singles site sj sk ski skin sky skype sl sling sm smart smile sn sncf so soccer social softbank software sohu solar solutions song sony soy spa space sport spot spreadbetting sr srl ss st stada staples star statebank statefarm stc stcgroup stockholm storage store stream studio study style su sucks supplies supply support surf surgery suzuki sv swatch swiftcover swiss sx sy sydney systems sz tab taipei talk taobao target tatamotors tatar tattoo tax taxi tc tci td tdk team tech technology tel temasek tennis teva tf tg th thd theater theatre tiaa tickets tienda tiffany tips tires tirol tj tjmaxx tjx tk tkmaxx tl tm tmall tn to today tokyo tools top toray toshiba total tours town toyota toys tr trade trading training travel travelchannel travelers travelersinsurance trust trv tt tube tui tunes tushu tv tvs tw tz ua ubank ubs ug uk unicom university uno uol ups us uy uz va vacations vana vanguard vc ve vegas ventures verisign versicherung vet vg vi viajes video vig viking villas vin vip virgin visa vision viva vivo vlaanderen vn vodka volkswagen volvo vote voting voto voyage vu vuelos wales walmart walter wang wanggou watch watches weather weatherchannel webcam weber website wed wedding weibo weir wf whoswho wien wiki williamhill win windows wine winners wme wolterskluwer woodside work works world wow ws wtc wtf xbox xerox xfinity xihuan xin xxx xyz yachts yahoo yamaxun yandex ye yodobashi yoga yokohama you youtube yt yun za zappos zara zero zip zm zone zuerich zw vermgensberater-ctb vermgensberatung-pwb                                                                                                                                                        ".split(" "),fn=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,hn=/(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEDD-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDDFF\uDE70-\uDE74\uDE78-\uDE7C\uDE80-\uDE86\uDE90-\uDEAC\uDEB0-\uDEBA\uDEC0-\uDEC5\uDED0-\uDED9\uDEE0-\uDEE7\uDEF0-\uDEF6])/,pn=/\uFE0F/,mn=/\d/,Bo=/\s/;function up(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=P(),t=A(Ee),n=A(Te),i=P(),s=A(Ca),o=[[mn,n],[fn,n],[hn,n],[pn,n]],l=function(){var w=A(Te);return w.j={"-":i},w.jr=[].concat(o),w},a=function(w){var I=l();return I.t=w,I};lp(e,[["'",A(lr)],["{",A(Wt)],["[",A(Sn)],["<",A(An)],["(",A(xn)],["}",A(At)],["]",A(Jt)],[">",A(qt)],[")",A(Ut)],["&",A(or)],["*",A(ar)],["@",A(Gt)],["`",A(cr)],["^",A(dr)],[":",A(Mn)],[",",A(es)],["$",A(fr)],[".",A(tt)],["=",A(hr)],["!",A(ts)],["-",A(pr)],["%",A(mr)],["|",A(gr)],["+",A(yr)],["#",A(Dr)],["?",A(br)],['"',A(ns)],["/",A(Ue)],[";",A(rs)],["~",A(kr)],["_",A(Cr)],["\\",A(ur)]]),k(e,`
`,A(Zi)),G(e,Bo,s),k(s,`
`,P()),G(s,Bo,s);for(var u=0;u<Fo.length;u++)Et(e,Fo[u],a(ze),l);var c=l(),d=l(),f=l(),h=l();Et(e,"file",c,l),Et(e,"ftp",d,l),Et(e,"http",f,l),Et(e,"mailto",h,l);var p=l(),m=A(an),g=A(Xi);k(d,"s",p),k(d,":",m),k(f,"s",p),k(f,":",m),k(c,":",m),k(p,":",m),k(h,":",g);for(var y=l(),b=0;b<r.length;b++)Et(e,r[b],y,l);return k(y,":",m),Et(e,"localhost",a(qe),l),G(e,mn,t),G(e,fn,n),G(e,hn,n),G(e,pn,n),G(t,mn,t),G(t,fn,n),G(t,hn,n),G(t,pn,n),k(t,"-",i),k(n,"-",i),k(i,"-",i),G(n,mn,n),G(n,fn,n),G(n,hn,n),G(n,pn,n),G(i,mn,n),G(i,fn,n),G(i,hn,n),G(i,pn,n),e.jd=A(Er),e}function cp(r,e){for(var t=dp(e.replace(/[A-Z]/g,function(h){return h.toLowerCase()})),n=t.length,i=[],s=0,o=0;o<n;){for(var l=r,a=null,u=0,c=null,d=-1,f=-1;o<n&&(a=sr(l,t[o]));)l=a,l.accepts()?(d=0,f=0,c=l):d>=0&&(d+=t[o].length,f++),u+=t[o].length,s+=t[o].length,o++;s-=d,o-=f,u-=d,i.push({t:c.t,v:e.substr(s-u,u),s:s-u,e:s})}return i}function dp(r){for(var e=[],t=r.length,n=0;n<t;){var i=r.charCodeAt(n),s=void 0,o=i<55296||i>56319||n+1===t||(s=r.charCodeAt(n+1))<56320||s>57343?r[n]:r.slice(n,n+2);e.push(o),n+=o.length}return e}function $n(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?$n=function(e){return typeof e}:$n=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$n(r)}var se={defaultProtocol:"http",events:null,format:Io,formatHref:Io,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:0,className:null,attributes:null,ignoreTags:[]};function fp(r){r=r||{},this.defaultProtocol="defaultProtocol"in r?r.defaultProtocol:se.defaultProtocol,this.events="events"in r?r.events:se.events,this.format="format"in r?r.format:se.format,this.formatHref="formatHref"in r?r.formatHref:se.formatHref,this.nl2br="nl2br"in r?r.nl2br:se.nl2br,this.tagName="tagName"in r?r.tagName:se.tagName,this.target="target"in r?r.target:se.target,this.rel="rel"in r?r.rel:se.rel,this.validate="validate"in r?r.validate:se.validate,this.truncate="truncate"in r?r.truncate:se.truncate,this.className="className"in r?r.className:se.className,this.attributes=r.attributes||se.attributes,this.ignoreTags=[];for(var e=("ignoreTags"in r)?r.ignoreTags:se.ignoreTags,t=0;t<e.length;t++)this.ignoreTags.push(e[t].toUpperCase())}fp.prototype={resolve:function(e){var t=e.toHref(this.defaultProtocol);return{formatted:this.get("format",e.toString(),e),formattedHref:this.get("formatHref",t,e),tagName:this.get("tagName",t,e),className:this.get("className",t,e),target:this.get("target",t,e),rel:this.get("rel",t,e),events:this.getObject("events",t,e),attributes:this.getObject("attributes",t,e),truncate:this.get("truncate",t,e)}},check:function(e){return this.get("validate",e.toString(),e)},get:function(e,t,n){var i=this[e];if(!i)return i;var s;switch($n(i)){case"function":return i(t,n.t);case"object":return s=n.t in i?i[n.t]:se[e],typeof s=="function"?s(t,n.t):s}return i},getObject:function(e,t,n){var i=this[e];return typeof i=="function"?i(t,n.t):i}};function Io(r){return r}function hp(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Object.create(r.prototype);for(var i in t)n[i]=t[i];return n.constructor=e,e.prototype=n,e}function Sr(){}Sr.prototype={t:"token",isLink:!1,toString:function(){return this.v},toHref:function(){return this.toString()},startIndex:function(){return this.tk[0].s},endIndex:function(){return this.tk[this.tk.length-1].e},toObject:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:se.defaultProtocol;return{type:this.t,value:this.v,isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}}};function Pt(r,e){function t(n,i){this.t=r,this.v=n,this.tk=i}return hp(Sr,t,e),t}var Ea=Pt("email",{isLink:!0}),Oi=Pt("email",{isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),Ni=Pt("text"),Sa=Pt("nl"),Ze=Pt("url",{isLink:!0,toHref:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:se.defaultProtocol,t=this.tk,n=!1,i=!1,s=[],o=0;t[o].t===an;)n=!0,s.push(t[o].v),o++;for(;t[o].t===Ue;)i=!0,s.push(t[o].v),o++;for(;o<t.length;o++)s.push(t[o].v);return s=s.join(""),n||i||(s="".concat(e,"://").concat(s)),s},hasProtocol:function(){return this.tk[0].t===an}}),pp=Object.freeze({__proto__:null,MultiToken:Sr,Base:Sr,createTokenClass:Pt,MailtoEmail:Ea,Email:Oi,Text:Ni,Nl:Sa,Url:Ze});function mp(){var r=P(),e=P(),t=P(),n=P(),i=P(),s=P(),o=P(),l=A(Ze),a=P(),u=A(Ze),c=A(Ze),d=P(),f=P(),h=P(),p=P(),m=P(),g=A(Ze),y=A(Ze),b=A(Ze),x=A(Ze),w=P(),I=P(),J=P(),H=P(),S=P(),$=P(),Me=A(Oi),Lt=P(),We=A(Oi),ie=A(Ea),pt=P(),ke=P(),ae=P(),Re=P(),Fn=A(Sa);k(r,Zi,Fn),k(r,an,e),k(r,Xi,t),k(e,Ue,n),k(n,Ue,i),k(r,ze,s),k(r,Te,s),k(r,qe,l),k(r,Ee,s),k(i,ze,c),k(i,Te,c),k(i,Ee,c),k(i,qe,c),k(s,tt,o),k(S,tt,$),k(o,ze,l),k(o,Te,s),k(o,Ee,s),k(o,qe,s),k($,ze,Me),k($,Te,S),k($,Ee,S),k($,qe,S),k(l,tt,o),k(Me,tt,$),k(l,Mn,a),k(l,Ue,c),k(a,Ee,u),k(u,Ue,c),k(Me,Mn,Lt),k(Lt,Ee,We);var K=[or,ar,Gt,ur,cr,dr,fr,Te,hr,pr,qe,Ee,mr,gr,yr,Dr,an,Ue,Er,kr,ze,Cr],V=[lr,qt,At,Jt,Ut,Mn,es,tt,ts,An,Wt,Sn,xn,br,ns,rs];k(c,Wt,f),k(c,Sn,h),k(c,An,p),k(c,xn,m),k(d,Wt,f),k(d,Sn,h),k(d,An,p),k(d,xn,m),k(f,At,c),k(h,Jt,c),k(p,qt,c),k(m,Ut,c),k(g,At,c),k(y,Jt,c),k(b,qt,c),k(x,Ut,c),k(w,At,c),k(I,Jt,c),k(J,qt,c),k(H,Ut,c),B(f,K,g),B(h,K,y),B(p,K,b),B(m,K,x),B(f,V,w),B(h,V,I),B(p,V,J),B(m,V,H),B(g,K,g),B(y,K,y),B(b,K,b),B(x,K,x),B(g,V,g),B(y,V,y),B(b,V,b),B(x,V,x),B(w,K,g),B(I,K,y),B(J,K,b),B(H,K,x),B(w,V,w),B(I,V,I),B(J,V,J),B(H,V,H),B(c,K,c),B(d,K,c),B(c,V,d),B(d,V,d),k(t,ze,ie),k(t,Te,ie),k(t,Ee,ie),k(t,qe,ie),B(ie,K,ie),B(ie,V,pt),B(pt,K,ie),B(pt,V,pt);var De=[or,lr,ar,ur,cr,dr,At,fr,Te,hr,pr,Ee,Wt,mr,gr,yr,Dr,br,Ue,Er,kr,ze,Cr];return B(s,De,ke),k(s,Gt,ae),B(l,De,ke),k(l,Gt,ae),B(o,De,ke),B(ke,De,ke),k(ke,Gt,ae),k(ke,tt,Re),B(Re,De,ke),k(ae,ze,S),k(ae,Te,S),k(ae,Ee,S),k(ae,qe,Me),r}function gp(r,e,t){for(var n=t.length,i=0,s=[],o=[];i<n;){for(var l=r,a=null,u=null,c=0,d=null,f=-1;i<n&&!(a=sr(l,t[i].t));)o.push(t[i++]);for(;i<n&&(u=a||sr(l,t[i].t));)a=null,l=u,l.accepts()?(f=0,d=l):f>=0&&f++,i++,c++;if(f<0)for(var h=i-c;h<i;h++)o.push(t[h]);else{o.length>0&&(s.push(ui(Ni,e,o)),o=[]),i-=f,c-=f;var p=d.t,m=t.slice(i-c,i);s.push(ui(p,e,m))}}return o.length>0&&s.push(ui(Ni,e,o)),s}function ui(r,e,t){var n=t[0].s,i=t[t.length-1].e,s=e.substr(n,i-n);return new r(s,t)}var yp=typeof console<"u"&&console&&console.warn||function(){},Y={scanner:null,parser:null,pluginQueue:[],customProtocols:[],initialized:!1};function Dp(){Y.scanner=null,Y.parser=null,Y.pluginQueue=[],Y.customProtocols=[],Y.initialized=!1}function bp(r){if(Y.initialized&&yp('linkifyjs: already initialized - will not register custom protocol "'.concat(r,'" until you manually call linkify.init(). To avoid this warning, please register all custom protocols before invoking linkify the first time.')),!/^[a-z-]+$/.test(r))throw Error("linkifyjs: protocols containing characters other than a-z or - (hyphen) are not supported");Y.customProtocols.push(r)}function kp(){Y.scanner={start:up(Y.customProtocols),tokens:ap},Y.parser={start:mp(),tokens:pp};for(var r={createTokenClass:Pt},e=0;e<Y.pluginQueue.length;e++)Y.pluginQueue[e][1]({scanner:Y.scanner,parser:Y.parser,utils:r});Y.initialized=!0}function Aa(r){return Y.initialized||kp(),gp(Y.parser.start,r,cp(Y.scanner.start,r))}function is(r){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=Aa(r),n=[],i=0;i<t.length;i++){var s=t[i];s.isLink&&(!e||s.t===e)&&n.push(s.toObject())}return n}function Ro(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=Aa(r);return t.length===1&&t[0].isLink&&(!e||t[0].t===e)}function Cp(r){return new fe({key:new Ie("autolink"),appendTransaction:(e,t,n)=>{const i=e.some(c=>c.docChanged)&&!t.doc.eq(n.doc),s=e.some(c=>c.getMeta("preventAutolink"));if(!i||s)return;const{tr:o}=n,l=Nf(t.doc,[...e]),{mapping:a}=l;if(Vf(l).forEach(({oldRange:c,newRange:d})=>{rr(c.from,c.to,t.doc).filter(m=>m.mark.type===r.type).forEach(m=>{const g=a.map(m.from),y=a.map(m.to),b=rr(g,y,n.doc).filter(S=>S.mark.type===r.type);if(!b.length)return;const x=b[0],w=t.doc.textBetween(m.from,m.to,void 0," "),I=n.doc.textBetween(x.from,x.to,void 0," "),J=Ro(w),H=Ro(I);J&&!H&&o.removeMark(x.from,x.to,r.type)});const f=Bf(n.doc,d,m=>m.isTextblock);let h,p;if(f.length>1?(h=f[0],p=n.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ")):f.length&&n.doc.textBetween(d.from,d.to," "," ").endsWith(" ")&&(h=f[0],p=n.doc.textBetween(h.pos,d.to,void 0," ")),h&&p){const m=p.split(" ").filter(b=>b!=="");if(m.length<=0)return!1;const g=m[m.length-1],y=h.pos+p.lastIndexOf(g);if(!g)return!1;is(g).filter(b=>b.isLink).filter(b=>r.validate?r.validate(b.value):!0).map(b=>({...b,from:y+b.start+1,to:y+b.end+1})).forEach(b=>{o.addMark(b.from,b.to,r.type.create({href:b.href}))})}}),!!o.steps.length)return o}})}function Ep(r){return new fe({key:new Ie("handleClickLink"),props:{handleClick:(e,t,n)=>{var i;const s=sa(e.state,r.type.name);return((i=n.target)===null||i===void 0?void 0:i.closest("a"))&&s.href?(window.open(s.href,s.target),!0):!1}}})}function Sp(r){return new fe({key:new Ie("handlePasteLink"),props:{handlePaste:(e,t,n)=>{const{state:i}=e,{selection:s}=i,{empty:o}=s;if(o)return!1;let l="";n.content.forEach(u=>{l+=u.textContent});const a=is(l).find(u=>u.isLink&&u.value===l);return!l||!a?!1:(r.editor.commands.setMark(r.type,{href:a.href}),!0)}}})}const Ap=Ke.create({name:"link",priority:1e3,keepOnSplit:!1,onCreate(){this.options.protocols.forEach(bp)},onDestroy(){Dp()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:'a[href]:not([href *= "javascript:" i])'}]},renderHTML({HTMLAttributes:r}){return["a",re(this.options.HTMLAttributes,r),0]},addCommands(){return{setLink:r=>({chain:e})=>e().setMark(this.name,r).setMeta("preventAutolink",!0).run(),toggleLink:r=>({chain:e})=>e().toggleMark(this.name,r,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:r})=>r().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Rt({find:r=>is(r).filter(e=>this.options.validate?this.options.validate(e.value):!0).filter(e=>e.isLink).map(e=>({text:e.value,index:e.start,data:e})),type:this.type,getAttributes:r=>{var e;return{href:(e=r.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const r=[];return this.options.autolink&&r.push(Cp({type:this.type,validate:this.options.validate})),this.options.openOnClick&&r.push(Ep({type:this.type})),this.options.linkOnPaste&&r.push(Sp({editor:this.editor,type:this.type})),r}}),xp=Ke.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["u",re(this.options.HTMLAttributes,r),0]},addCommands(){return{setUnderline:()=>({commands:r})=>r.setMark(this.name),toggleUnderline:()=>({commands:r})=>r.toggleMark(this.name),unsetUnderline:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),Mp=me.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:"left"}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:r=>r.style.textAlign||this.options.defaultAlignment,renderHTML:r=>r.textAlign===this.options.defaultAlignment?{}:{style:`text-align: ${r.textAlign}`}}}}]},addCommands(){return{setTextAlign:r=>({commands:e})=>this.options.alignments.includes(r)?this.options.types.every(t=>e.updateAttributes(t,{textAlign:r})):!1,unsetTextAlign:()=>({commands:r})=>this.options.types.every(e=>r.resetAttributes(e,"textAlign"))}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}});function Po(r){let e,t,n,i,s,o,l,a,u,c,d,f,h,p,m,g,y,b,x,w,I,J,H,S,$,Me,Lt,We,ie,pt,ke,ae,Re,Fn,K,V,De,ss,Pr,mt,gt,ls,Lr,yt,Dt,as,zr,bt,kt,us,_r,cs;return{c(){e=L("div"),t=L("select"),n=L("option"),i=Bn("Paragraph"),s=L("option"),o=Bn("Heading 1"),l=L("option"),a=Bn("Heading 2"),u=L("option"),c=Bn("Heading 3"),d=we(),f=L("button"),h=L("img"),m=we(),g=L("button"),y=L("img"),x=we(),w=L("button"),I=L("img"),H=we(),S=L("button"),$=L("img"),Lt=we(),We=L("button"),ie=L("img"),ke=we(),ae=L("button"),Re=L("img"),K=we(),V=L("button"),De=L("img"),Pr=we(),mt=L("button"),gt=L("img"),Lr=we(),yt=L("button"),Dt=L("img"),zr=we(),bt=L("button"),kt=L("img"),this.h()},l(Ct){e=z(Ct,"DIV",{style:!0,class:!0});var _=Z(e);t=z(_,"SELECT",{class:!0,"aria-label":!0,style:!0});var cn=Z(t);n=z(cn,"OPTION",{});var ds=Z(n);i=In(ds,"Paragraph"),ds.forEach(W),s=z(cn,"OPTION",{});var fs=Z(s);o=In(fs,"Heading 1"),fs.forEach(W),l=z(cn,"OPTION",{});var hs=Z(l);a=In(hs,"Heading 2"),hs.forEach(W),u=z(cn,"OPTION",{});var ps=Z(u);c=In(ps,"Heading 3"),ps.forEach(W),cn.forEach(W),d=ve(_),f=z(_,"BUTTON",{class:!0});var ms=Z(f);h=z(ms,"IMG",{src:!0,alt:!0,width:!0}),ms.forEach(W),m=ve(_),g=z(_,"BUTTON",{class:!0});var gs=Z(g);y=z(gs,"IMG",{src:!0,alt:!0,width:!0}),gs.forEach(W),x=ve(_),w=z(_,"BUTTON",{class:!0});var ys=Z(w);I=z(ys,"IMG",{src:!0,alt:!0,width:!0}),ys.forEach(W),H=ve(_),S=z(_,"BUTTON",{class:!0});var Ds=Z(S);$=z(Ds,"IMG",{src:!0,alt:!0,width:!0}),Ds.forEach(W),Lt=ve(_),We=z(_,"BUTTON",{class:!0});var bs=Z(We);ie=z(bs,"IMG",{src:!0,alt:!0,width:!0}),bs.forEach(W),ke=ve(_),ae=z(_,"BUTTON",{class:!0});var ks=Z(ae);Re=z(ks,"IMG",{src:!0,alt:!0,width:!0}),ks.forEach(W),K=ve(_),V=z(_,"BUTTON",{class:!0});var Cs=Z(V);De=z(Cs,"IMG",{src:!0,alt:!0,width:!0}),Cs.forEach(W),Pr=ve(_),mt=z(_,"BUTTON",{class:!0});var Es=Z(mt);gt=z(Es,"IMG",{src:!0,alt:!0,width:!0}),Es.forEach(W),Lr=ve(_),yt=z(_,"BUTTON",{class:!0});var Ss=Z(yt);Dt=z(Ss,"IMG",{src:!0,alt:!0,width:!0}),Ss.forEach(W),zr=ve(_),bt=z(_,"BUTTON",{class:!0});var As=Z(bt);kt=z(As,"IMG",{src:!0,alt:!0,width:!0}),As.forEach(W),_.forEach(W),this.h()},h(){n.selected=!0,n.__value="Paragraph",n.value=n.__value,s.__value="1",s.value=s.__value,l.__value="2",l.value=l.__value,u.__value="3",u.value=u.__value,v(t,"class","form-select"),v(t,"aria-label","Default select example"),Rn(t,"width","fit-content"),Pe(h.src,p="/Editor Icons/bold.png")||v(h,"src",p),v(h,"alt","bold"),v(h,"width","20"),v(f,"class","editor-icon"),Ms(f,"hidden",r[1].isActive("bold")?"active":""),Pe(y.src,b="/Editor Icons/italic.png")||v(y,"src",b),v(y,"alt","italic"),v(y,"width","20"),v(g,"class","editor-icon"),Pe(I.src,J="/Editor Icons/link.png")||v(I,"src",J),v(I,"alt","link"),v(I,"width","20"),v(w,"class","editor-icon"),Pe($.src,Me="/Editor Icons/underline.png")||v($,"src",Me),v($,"alt","underline"),v($,"width","20"),v(S,"class","editor-icon"),Pe(ie.src,pt="/Editor Icons/strikethrough.png")||v(ie,"src",pt),v(ie,"alt","strike-through"),v(ie,"width","20"),v(We,"class","editor-icon"),Pe(Re.src,Fn="/Editor Icons/numberedlist.png")||v(Re,"src",Fn),v(Re,"alt","numberedlist"),v(Re,"width","20"),v(ae,"class","editor-icon"),Pe(De.src,ss="/Editor Icons/bulletlist.png")||v(De,"src",ss),v(De,"alt","bulletlist"),v(De,"width","20"),v(V,"class","editor-icon"),Pe(gt.src,ls="/Editor Icons/left-align.png")||v(gt,"src",ls),v(gt,"alt","left-align"),v(gt,"width","20"),v(mt,"class","editor-icon"),Pe(Dt.src,as="/Editor Icons/center-align.png")||v(Dt,"src",as),v(Dt,"alt","center-align"),v(Dt,"width","20"),v(yt,"class","editor-icon"),Pe(kt.src,us="/Editor Icons/right-align.png")||v(kt,"src",us),v(kt,"alt","right-align"),v(kt,"width","20"),v(bt,"class","editor-icon"),Rn(e,"display","flex"),Rn(e,"background-color","rgb(248, 248, 248)"),Rn(e,"margin-top","1em"),v(e,"class","p-2")},m(Ct,_){ci(Ct,e,_),N(e,t),N(t,n),N(n,i),N(t,s),N(s,o),N(t,l),N(l,a),N(t,u),N(u,c),N(e,d),N(e,f),N(f,h),N(e,m),N(e,g),N(g,y),N(e,x),N(e,w),N(w,I),N(e,H),N(e,S),N(S,$),N(e,Lt),N(e,We),N(We,ie),N(e,ke),N(e,ae),N(ae,Re),N(e,K),N(e,V),N(V,De),N(e,Pr),N(e,mt),N(mt,gt),N(e,Lr),N(e,yt),N(yt,Dt),N(e,zr),N(e,bt),N(bt,kt),_r||(cs=[Ce(s,"click",r[5]),Ce(t,"change",r[3]),Ce(f,"click",r[6]),Ce(g,"click",r[7]),Ce(w,"click",r[8]),Ce(S,"click",function(){Oa(r[1].chain().focus().toggleUnderline().run())&&r[1].chain().focus().toggleUnderline().run().apply(this,arguments)}),Ce(We,"click",r[9]),Ce(ae,"click",r[10]),Ce(V,"click",r[11]),Ce(mt,"click",r[12]),Ce(yt,"click",r[13]),Ce(bt,"click",r[14])],_r=!0)},p(Ct,_){r=Ct,_&2&&Ms(f,"hidden",r[1].isActive("bold")?"active":"")},d(Ct){Ct&&W(e),_r=!1,Na(cs)}}}function wp(r){let e,t,n=r[1]&&Po(r);return{c(){n&&n.c(),e=we(),t=L("div"),this.h()},l(i){n&&n.l(i),e=ve(i),t=z(i,"DIV",{class:!0}),Z(t).forEach(W),this.h()},h(){v(t,"class","editor")},m(i,s){n&&n.m(i,s),ci(i,e,s),ci(i,t,s),r[15](t)},p(i,[s]){i[1]?n?n.p(i,s):(n=Po(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:xs,o:xs,d(i){n&&n.d(i),i&&W(e),i&&W(t),r[15](null)}}}function vp(r,e,t){let n,i,{content:s}=e;va(()=>{t(1,i=new yh({element:n,extensions:[aa,Da,ka,ma,ua,oa,Ap,xp,ba,ga,ya,la,Mp.configure({types:["heading","paragraph"]})],content:s}))});const o=()=>{const x=i.getAttributes("link").href,w=window.prompt("URL",x);if(w!==null){if(w===""){i.chain().focus().extendMarkRange("link").unsetLink().run();return}i.chain().focus().extendMarkRange("link").setLink({href:w}).run()}},l=()=>{console.log("Dd");const w=document.getElementsByClassName("form-select")[0].options.selectedIndex;console.log(n.children[0].innerHTML),w===0?i.chain().focus().setParagraph().run():w===1?i.chain().focus().toggleHeading({level:1}).run():w===2?i.chain().focus().toggleHeading({level:2}).run():w===3&&i.chain().focus().toggleHeading({level:3}).run()};Ta(()=>{i&&i.destroy()});const a=()=>console.log("ff"),u=()=>{i.chain().focus().toggleBold().run(),console.log(i.isActive("bold"))},c=()=>{i.chain().focus().toggleItalic().run()},d=()=>{i.isActive("link")?i.chain().focus().unsetLink().run():(i.chain().focus().setLink().run(),o())},f=()=>{i.chain().focus().toggleStrike().run(),console.log(i.chain().focus())},h=()=>{i.chain().focus().toggleOrderedList().run()},p=()=>i.chain().focus().toggleBulletList().run(),m=()=>i.chain().focus().setTextAlign("left").run(),g=()=>i.chain().focus().setTextAlign("center").run(),y=()=>i.chain().focus().setTextAlign("right").run();function b(x){Fa[x?"unshift":"push"](()=>{n=x,t(0,n)})}return r.$$set=x=>{"content"in x&&t(4,s=x.content)},[n,i,o,l,s,a,u,c,d,f,h,p,m,g,y,b]}class Bp extends xa{constructor(e){super(),Ma(this,e,vp,wp,wa,{content:4})}}export{Bp as T};
